"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const api_1 = require("../../../../utils/api");
const util_1 = require("../../../../utils/util");
Page({
    data: {
        tel: [],
        mail: []
    },
    onLoad: function () {
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on("alarm", ({ tel, mail }) => {
            this.setData({
                tel,
                mail
            });
        });
    },
    addTel() {
        const tel = [...this.data.tel, ''];
        this.setData({
            tel
        });
    },
    addMail() {
        const mail = [...this.data.mail, ''];
        this.setData({
            mail
        });
    },
    modifyTel(e) {
        const old = e.currentTarget.dataset.key;
        const newVal = e.detail.value;
        if ((0, util_1.RgexpTel)(newVal) || newVal.length === 0) {
            const i = this.data.tel.findIndex(el => el === old);
            this.data.tel.splice(i, 1, newVal);
            this.setData({
                tel: this.data.tel.filter(el => el)
            });
        }
        else {
            wx.showModal({
                content: `${newVal}不是正确的手机号格式`,
                title: "号码错误"
            });
        }
    },
    modifyMail(e) {
        const old = e.currentTarget.dataset.key;
        const newVal = e.detail.value;
        if ((0, util_1.RgexpMail)(newVal) || newVal.length === 0) {
            const i = this.data.mail.findIndex(el => el === old);
            this.data.mail.splice(i, 1, newVal);
            this.setData({
                mail: this.data.mail.filter(el => el)
            });
        }
        else {
            wx.showModal({
                content: `${newVal}不是正确的邮箱格式`,
                title: "邮箱错误"
            });
        }
    },
    submit() {
        const eventChannel = this.getOpenerEventChannel();
        const { tel, mail } = this.data;
        const tels = tel.filter(el => (0, util_1.RgexpTel)(el));
        const mails = mail.filter(el => (0, util_1.RgexpMail)(el));
        wx.showLoading({ title: '提交中' });
        api_1.default.modifyUserAlarmSetupTel([...new Set(tels)], [...new Set(mails)]).then((res) => {
            wx.hideLoading();
            if (res.code === 200) {
                wx.showModal({
                    title: '更新成功',
                    icon: 'success',
                    success() {
                        eventChannel.emit("modifyOk", { tel: tels, mail: mails });
                        wx.navigateBack();
                    }
                });
            }
            else {
                wx.showToast({
                    title: '更新失败',
                    icon: 'error'
                });
            }
        });
    },
    disbledSumbit() {
        return this.data.mail.every(el => (0, util_1.RgexpMail)(el)) && this.data.tel.every(el => (0, util_1.RgexpTel)(el));
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kaWZ5VGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9kaWZ5VGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0NBQXVDO0FBQ3ZDLGlEQUE0RDtBQUM1RCxJQUFJLENBQUM7SUFLSCxJQUFJLEVBQUU7UUFDSixHQUFHLEVBQUUsRUFBYztRQUNuQixJQUFJLEVBQUUsRUFBYztLQUNyQjtJQUtELE1BQU0sRUFBRTtRQUNOLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO1FBQ2pELFlBQVksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFxQyxFQUFFLEVBQUU7WUFDNUUsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxHQUFHO2dCQUNILElBQUk7YUFDTCxDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxHQUFHO1NBQ0osQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELE9BQU87UUFDTCxNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLElBQUk7U0FDTCxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsU0FBUyxDQUFDLENBQVk7UUFDcEIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFBO1FBQ3ZDLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBZSxDQUFBO1FBQ3ZDLElBQUksSUFBQSxlQUFRLEVBQUMsTUFBTSxDQUFDLElB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QUFJLEVBQUUsU0FBUztvQkFDZixPQUFPO3dCQUNMLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQTt3QkFDekQsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFBO29CQUNuQixDQUFDO2lCQUNGLENBQUMsQ0FBQTtZQUVKLENBQUM7aUJBQUksQ0FBQztnQkFDSixFQUFFLENBQUMsU0FBUyxDQUFDO29CQUNYLEtBQUssRUFBQyxNQUFNO29CQUNaLElBQUksRUFBQyxPQUFPO2lCQUNiLENBQUMsQ0FBQTtZQUNKLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQTtJQUVKLENBQUM7SUFFRCxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFBLGdCQUFTLEVBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFBLGVBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzdGLENBQUM7SUFLRCxPQUFPLEVBQUU7SUFFVCxDQUFDO0lBS0QsTUFBTSxFQUFFO0lBRVIsQ0FBQztJQUtELE1BQU0sRUFBRTtJQUVSLENBQUM7SUFLRCxRQUFRLEVBQUU7SUFFVixDQUFDO0lBS0QsaUJBQWlCLEVBQUU7SUFFbkIsQ0FBQztJQUtELGFBQWEsRUFBRTtJQUVmLENBQUM7SUFLRCxpQkFBaUIsRUFBRTtJQUVuQixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvaW5kZXgvYWxhcm1TZXR0aW5nL21vZGlmeVRlbC9tb2RpZnlUZWwuanNcbmltcG9ydCBhcGkgZnJvbSBcIi4uLy4uLy4uLy4uL3V0aWxzL2FwaVwiXG5pbXBvcnQgeyBSZ2V4cE1haWwsIFJnZXhwVGVsIH0gZnJvbSBcIi4uLy4uLy4uLy4uL3V0aWxzL3V0aWxcIlxuUGFnZSh7XG5cbiAgLyoqXG4gICAqIOmhtemdoueahOWIneWni+aVsOaNrlxuICAgKi9cbiAgZGF0YToge1xuICAgIHRlbDogW10gYXMgc3RyaW5nW10sXG4gICAgbWFpbDogW10gYXMgc3RyaW5nW11cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cbiAgICovXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGV2ZW50Q2hhbm5lbCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKClcbiAgICBldmVudENoYW5uZWwub24oXCJhbGFybVwiLCAoeyB0ZWwsIG1haWwgfTogeyB0ZWw6IHN0cmluZ1tdLCBtYWlsOiBzdHJpbmdbXSB9KSA9PiB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICB0ZWwsXG4gICAgICAgIG1haWxcbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcblxuICBhZGRUZWwoKSB7XG4gICAgY29uc3QgdGVsID0gWy4uLnRoaXMuZGF0YS50ZWwsICcnXVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICB0ZWxcbiAgICB9KVxuICB9LFxuXG4gIGFkZE1haWwoKSB7XG4gICAgY29uc3QgbWFpbCA9IFsuLi50aGlzLmRhdGEubWFpbCwgJyddXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG1haWxcbiAgICB9KVxuICB9LFxuXG4gIG1vZGlmeVRlbChlOiB2YW50RXZlbnQpIHtcbiAgICBjb25zdCBvbGQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5rZXlcbiAgICBjb25zdCBuZXdWYWwgPSBlLmRldGFpbC52YWx1ZSBhcyBzdHJpbmdcbiAgICBpZiAoUmdleHBUZWwobmV3VmFsKSB8fCBuZXdWYWwubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBpID0gdGhpcy5kYXRhLnRlbC5maW5kSW5kZXgoZWwgPT4gZWwgPT09IG9sZClcbiAgICAgIHRoaXMuZGF0YS50ZWwuc3BsaWNlKGksIDEsIG5ld1ZhbClcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHRlbDogdGhpcy5kYXRhLnRlbC5maWx0ZXIoZWwgPT4gZWwpXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICBjb250ZW50OiBgJHtuZXdWYWx95LiN5piv5q2j56Gu55qE5omL5py65Y+35qC85byPYCxcbiAgICAgICAgdGl0bGU6IFwi5Y+356CB6ZSZ6K+vXCJcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIG1vZGlmeU1haWwoZTogdmFudEV2ZW50KSB7XG4gICAgY29uc3Qgb2xkID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQua2V5XG4gICAgY29uc3QgbmV3VmFsID0gZS5kZXRhaWwudmFsdWUgYXMgc3RyaW5nXG4gICAgaWYgKFJnZXhwTWFpbChuZXdWYWwpIHx8IG5ld1ZhbC5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGkgPSB0aGlzLmRhdGEubWFpbC5maW5kSW5kZXgoZWwgPT4gZWwgPT09IG9sZClcbiAgICAgIHRoaXMuZGF0YS5tYWlsLnNwbGljZShpLCAxLCBuZXdWYWwpXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBtYWlsOiB0aGlzLmRhdGEubWFpbC5maWx0ZXIoZWwgPT4gZWwpXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICBjb250ZW50OiBgJHtuZXdWYWx95LiN5piv5q2j56Gu55qE6YKu566x5qC85byPYCxcbiAgICAgICAgdGl0bGU6IFwi6YKu566x6ZSZ6K+vXCJcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIHN1Ym1pdCgpIHtcbiAgICAvKiBpZighdGhpcy5kaXNibGVkU3VtYml0KCkpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOlwi6IGU57O75pa55byP5LiN6IO956m6XCIsXG4gICAgICAgIGljb246XCJlcnJvclwiXG4gICAgICB9KVxuICAgICAgcmV0dXJuXG4gICAgfSAqL1xuICAgIGNvbnN0IGV2ZW50Q2hhbm5lbCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKClcbiAgICBjb25zdCB7IHRlbCwgbWFpbCB9ID0gdGhpcy5kYXRhXG5cbiAgICBjb25zdCB0ZWxzID0gdGVsLmZpbHRlcihlbCA9PiBSZ2V4cFRlbChlbCkpXG4gICAgY29uc3QgbWFpbHMgPSBtYWlsLmZpbHRlcihlbCA9PiBSZ2V4cE1haWwoZWwpKVxuXG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+aPkOS6pOS4rScgfSlcbiAgICBhcGkubW9kaWZ5VXNlckFsYXJtU2V0dXBUZWwoWy4uLm5ldyBTZXQodGVscyldLCBbLi4ubmV3IFNldChtYWlscyldKS50aGVuKChyZXMpID0+IHtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgIGlmIChyZXMuY29kZSA9PT0gMjAwKSB7XG4gICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgdGl0bGU6J+abtOaWsOaIkOWKnycsXG4gICAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIHN1Y2Nlc3MoKXtcbiAgICAgICAgICAgIGV2ZW50Q2hhbm5lbC5lbWl0KFwibW9kaWZ5T2tcIiwgeyB0ZWw6IHRlbHMsIG1haWw6IG1haWxzIH0pXG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soKVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICB9ZWxzZXtcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTon5pu05paw5aSx6LSlJyxcbiAgICAgICAgICBpY29uOidlcnJvcidcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuXG4gIH0sXG5cbiAgZGlzYmxlZFN1bWJpdCgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLm1haWwuZXZlcnkoZWwgPT4gUmdleHBNYWlsKGVsKSkgJiYgdGhpcy5kYXRhLnRlbC5ldmVyeShlbCA9PiBSZ2V4cFRlbChlbCkpXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcbiAgICovXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcbiAgICovXG4gIG9uU2hhcmVBcHBNZXNzYWdlOiBmdW5jdGlvbiAoKSB7XG5cbiAgfVxufSkiXX0=