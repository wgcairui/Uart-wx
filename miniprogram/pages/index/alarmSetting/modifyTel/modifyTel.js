"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const api_1 = require("../../../../utils/api");
const util_1 = require("../../../../utils/util");
Page({
    data: {
        tel: [],
        mail: []
    },
    onLoad: function () {
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on("alarm", ({ tel, mail }) => {
            this.setData({
                tel,
                mail
            });
        });
    },
    addTel() {
        const tel = [...this.data.tel, ''];
        this.setData({
            tel
        });
    },
    addMail() {
        const mail = [...this.data.mail, ''];
        this.setData({
            mail
        });
    },
    modifyTel(e) {
        const old = e.currentTarget.dataset.key;
        const newVal = e.detail.value;
        if ((0, util_1.RgexpTel)(newVal) || newVal.length === 0) {
            const i = this.data.tel.findIndex(el => el === old);
            this.data.tel.splice(i, 1, newVal);
            this.setData({
                tel: this.data.tel.filter(el => el)
            });
        }
        else {
            wx.showModal({
                content: `${newVal}不是正确的手机号格式`,
                title: "号码错误"
            });
        }
    },
    modifyMail(e) {
        const old = e.currentTarget.dataset.key;
        const newVal = e.detail.value;
        if ((0, util_1.RgexpMail)(newVal) || newVal.length === 0) {
            const i = this.data.mail.findIndex(el => el === old);
            this.data.mail.splice(i, 1, newVal);
            this.setData({
                mail: this.data.mail.filter(el => el)
            });
        }
        else {
            wx.showModal({
                content: `${newVal}不是正确的邮箱格式`,
                title: "邮箱错误"
            });
        }
    },
    submit() {
        const eventChannel = this.getOpenerEventChannel();
        const { tel, mail } = this.data;
        const tels = tel.filter(el => (0, util_1.RgexpTel)(el));
        const mails = mail.filter(el => (0, util_1.RgexpMail)(el));
        wx.showLoading({ title: '提交中' });
        api_1.default.modifyUserAlarmSetupTel([...new Set(tels)], [...new Set(mails)]).then(() => {
            wx.hideLoading();
            eventChannel.emit("modifyOk", { tel: tels, mail: mails });
            wx.navigateBack();
        });
    },
    disbledSumbit() {
        return this.data.mail.every(el => (0, util_1.RgexpMail)(el)) && this.data.tel.every(el => (0, util_1.RgexpTel)(el));
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kaWZ5VGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9kaWZ5VGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0NBQXVDO0FBQ3ZDLGlEQUE0RDtBQUM1RCxJQUFJLENBQUM7SUFLSCxJQUFJLEVBQUU7UUFDSixHQUFHLEVBQUUsRUFBYztRQUNuQixJQUFJLEVBQUUsRUFBYztLQUNyQjtJQUtELE1BQU0sRUFBRTtRQUNOLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO1FBQ2pELFlBQVksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFxQyxFQUFFLEVBQUU7WUFDNUUsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxHQUFHO2dCQUNILElBQUk7YUFDTCxDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxHQUFHO1NBQ0osQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELE9BQU87UUFDTCxNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLElBQUk7U0FDTCxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsU0FBUyxDQUFDLENBQVk7UUFDcEIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFBO1FBQ3ZDLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBZSxDQUFBO1FBQ3ZDLElBQUksSUFBQSxlQUFRLEVBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDM0MsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFBO1lBQ25ELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1lBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1gsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQzthQUNwQyxDQUFDLENBQUE7U0FDSDthQUFNO1lBQ0wsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxPQUFPLEVBQUUsR0FBRyxNQUFNLFlBQVk7Z0JBQzlCLEtBQUssRUFBRSxNQUFNO2FBQ2QsQ0FBQyxDQUFBO1NBQ0g7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLENBQVk7UUFDckIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFBO1FBQ3ZDLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBZSxDQUFBO1FBQ3ZDLElBQUksSUFBQSxnQkFBUyxFQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzVDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQTtZQUNwRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQTtZQUNuQyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7YUFDdEMsQ0FBQyxDQUFBO1NBQ0g7YUFBTTtZQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsT0FBTyxFQUFFLEdBQUcsTUFBTSxXQUFXO2dCQUM3QixLQUFLLEVBQUUsTUFBTTthQUNkLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztJQUVELE1BQU07UUFRSixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQTtRQUNqRCxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFFL0IsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUEsZUFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDM0MsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUEsZ0JBQVMsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBRTlDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQTtRQUNoQyxhQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQzdFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7WUFDekQsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQ25CLENBQUMsQ0FBQyxDQUFBO0lBRUosQ0FBQztJQUVELGFBQWE7UUFDWCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUEsZ0JBQVMsRUFBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUEsZUFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDN0YsQ0FBQztJQUtELE9BQU8sRUFBRTtJQUVULENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsTUFBTSxFQUFFO0lBRVIsQ0FBQztJQUtELFFBQVEsRUFBRTtJQUVWLENBQUM7SUFLRCxpQkFBaUIsRUFBRTtJQUVuQixDQUFDO0lBS0QsYUFBYSxFQUFFO0lBRWYsQ0FBQztJQUtELGlCQUFpQixFQUFFO0lBRW5CLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9pbmRleC9hbGFybVNldHRpbmcvbW9kaWZ5VGVsL21vZGlmeVRlbC5qc1xuaW1wb3J0IGFwaSBmcm9tIFwiLi4vLi4vLi4vLi4vdXRpbHMvYXBpXCJcbmltcG9ydCB7IFJnZXhwTWFpbCwgUmdleHBUZWwgfSBmcm9tIFwiLi4vLi4vLi4vLi4vdXRpbHMvdXRpbFwiXG5QYWdlKHtcblxuICAvKipcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXG4gICAqL1xuICBkYXRhOiB7XG4gICAgdGVsOiBbXSBhcyBzdHJpbmdbXSxcbiAgICBtYWlsOiBbXSBhcyBzdHJpbmdbXVxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgZXZlbnRDaGFubmVsID0gdGhpcy5nZXRPcGVuZXJFdmVudENoYW5uZWwoKVxuICAgIGV2ZW50Q2hhbm5lbC5vbihcImFsYXJtXCIsICh7IHRlbCwgbWFpbCB9OiB7IHRlbDogc3RyaW5nW10sIG1haWw6IHN0cmluZ1tdIH0pID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHRlbCxcbiAgICAgICAgbWFpbFxuICAgICAgfSlcbiAgICB9KVxuICB9LFxuXG4gIGFkZFRlbCgpIHtcbiAgICBjb25zdCB0ZWwgPSBbLi4udGhpcy5kYXRhLnRlbCwgJyddXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHRlbFxuICAgIH0pXG4gIH0sXG5cbiAgYWRkTWFpbCgpIHtcbiAgICBjb25zdCBtYWlsID0gWy4uLnRoaXMuZGF0YS5tYWlsLCAnJ11cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgbWFpbFxuICAgIH0pXG4gIH0sXG5cbiAgbW9kaWZ5VGVsKGU6IHZhbnRFdmVudCkge1xuICAgIGNvbnN0IG9sZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmtleVxuICAgIGNvbnN0IG5ld1ZhbCA9IGUuZGV0YWlsLnZhbHVlIGFzIHN0cmluZ1xuICAgIGlmIChSZ2V4cFRlbChuZXdWYWwpIHx8IG5ld1ZhbC5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGkgPSB0aGlzLmRhdGEudGVsLmZpbmRJbmRleChlbCA9PiBlbCA9PT0gb2xkKVxuICAgICAgdGhpcy5kYXRhLnRlbC5zcGxpY2UoaSwgMSwgbmV3VmFsKVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgdGVsOiB0aGlzLmRhdGEudGVsLmZpbHRlcihlbCA9PiBlbClcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIGNvbnRlbnQ6IGAke25ld1ZhbH3kuI3mmK/mraPnoa7nmoTmiYvmnLrlj7fmoLzlvI9gLFxuICAgICAgICB0aXRsZTogXCLlj7fnoIHplJnor69cIlxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgbW9kaWZ5TWFpbChlOiB2YW50RXZlbnQpIHtcbiAgICBjb25zdCBvbGQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5rZXlcbiAgICBjb25zdCBuZXdWYWwgPSBlLmRldGFpbC52YWx1ZSBhcyBzdHJpbmdcbiAgICBpZiAoUmdleHBNYWlsKG5ld1ZhbCkgfHwgbmV3VmFsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3QgaSA9IHRoaXMuZGF0YS5tYWlsLmZpbmRJbmRleChlbCA9PiBlbCA9PT0gb2xkKVxuICAgICAgdGhpcy5kYXRhLm1haWwuc3BsaWNlKGksIDEsIG5ld1ZhbClcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIG1haWw6IHRoaXMuZGF0YS5tYWlsLmZpbHRlcihlbCA9PiBlbClcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIGNvbnRlbnQ6IGAke25ld1ZhbH3kuI3mmK/mraPnoa7nmoTpgq7nrrHmoLzlvI9gLFxuICAgICAgICB0aXRsZTogXCLpgq7nrrHplJnor69cIlxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgc3VibWl0KCkge1xuICAgIC8qIGlmKCF0aGlzLmRpc2JsZWRTdW1iaXQoKSkge1xuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6XCLogZTns7vmlrnlvI/kuI3og73nqbpcIixcbiAgICAgICAgaWNvbjpcImVycm9yXCJcbiAgICAgIH0pXG4gICAgICByZXR1cm5cbiAgICB9ICovXG4gICAgY29uc3QgZXZlbnRDaGFubmVsID0gdGhpcy5nZXRPcGVuZXJFdmVudENoYW5uZWwoKVxuICAgIGNvbnN0IHsgdGVsLCBtYWlsIH0gPSB0aGlzLmRhdGFcblxuICAgIGNvbnN0IHRlbHMgPSB0ZWwuZmlsdGVyKGVsID0+IFJnZXhwVGVsKGVsKSlcbiAgICBjb25zdCBtYWlscyA9IG1haWwuZmlsdGVyKGVsID0+IFJnZXhwTWFpbChlbCkpXG5cbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5o+Q5Lqk5LitJyB9KVxuICAgIGFwaS5tb2RpZnlVc2VyQWxhcm1TZXR1cFRlbChbLi4ubmV3IFNldCh0ZWxzKV0sIFsuLi5uZXcgU2V0KG1haWxzKV0pLnRoZW4oKCkgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgZXZlbnRDaGFubmVsLmVtaXQoXCJtb2RpZnlPa1wiLCB7IHRlbDogdGVscywgbWFpbDogbWFpbHMgfSlcbiAgICAgIHd4Lm5hdmlnYXRlQmFjaygpXG4gICAgfSlcblxuICB9LFxuXG4gIGRpc2JsZWRTdW1iaXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5tYWlsLmV2ZXJ5KGVsID0+IFJnZXhwTWFpbChlbCkpICYmIHRoaXMuZGF0YS50ZWwuZXZlcnkoZWwgPT4gUmdleHBUZWwoZWwpKVxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWIneasoea4suafk+WujOaIkFxuICAgKi9cbiAgb25SZWFkeTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XG4gICAqL1xuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdoumakOiXj1xuICAgKi9cbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLljbjovb1cbiAgICovXG4gIG9uVW5sb2FkOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcbiAgICovXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAqL1xuICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKCkge1xuXG4gIH1cbn0pIl19