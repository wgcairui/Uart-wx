"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../../../utils/util");
const api_1 = require("../../../utils/api");
Page({
    data: {
        devs: [],
        tels: '',
        mails: ''
    },
    onLoad: function () {
        this.sortDevslist();
        this.getuserTels();
    },
    sortDevslist() {
        api_1.default.BindDev().then(el => {
            if (el.code) {
                this.setData({
                    devs: el.data.UTs
                });
            }
        });
    },
    async getuserTels() {
        const el = await api_1.default.getUserAlarmSetup();
        this.setData({
            tels: el.data.tels.join('\n'),
            mails: el.data.mails.join('\n')
        });
    },
    modifyTell(event) {
        const { detail, currentTarget: { dataset } } = event;
        const value = Array.from(new Set(detail.value.replace(/(\,|\，)/g, '\n').split('\n').filter(el => el)));
        const key = dataset.key;
        console.log(value);
        switch (key) {
            case 'tel':
                {
                    const ok = value.every(el => util_1.RgexpTel(el));
                    if (value.length > 3) {
                        wx.showModal({
                            title: "错误",
                            content: "最多只能保存3个号码！！"
                        });
                        return;
                    }
                    if (ok) {
                        this.pushuserTels(value, null);
                    }
                    else {
                        wx.showModal({
                            title: '格式错误',
                            content: '手机号码格式不正确'
                        });
                    }
                }
                break;
            case "mail":
                {
                    const ok = value.every(el => util_1.RgexpMail(el));
                    if (ok) {
                        this.pushuserTels(null, value);
                    }
                    else {
                        wx.showModal({
                            title: '格式错误',
                            content: '邮箱格式不正确'
                        });
                    }
                }
                break;
        }
    },
    pushuserTels(tels, mails) {
        this.setData({
            tels: tels ? tels.join('\n') : this.data.tels,
            mails: mails ? mails.join('\n') : this.data.mails
        });
        api_1.default.modifyUserAlarmSetupTel(this.data.tels.split('\n'), this.data.mails.split('\n')).then(() => {
            wx.startPullDownRefresh();
        });
    },
    async subMessage() {
        const url = encodeURIComponent('http://mp.weixin.qq.com/s?__biz=MjM5MjA1MTgxOQ==&mid=304819939&idx=1&sn=d0bcd922033075afa2b5219fc95ebb1e&chksm=3173a9e7060420f1a98d0040d964a2f82af25289a731d1400c5224ca9bb3d225d737700700a8#rd');
        wx.navigateTo({ url: '/pages/index/web/web?url=' + url });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: async function () {
        await this.getuserTels();
        wx.stopPullDownRefresh();
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUF5RDtBQUN6RCw0Q0FBb0M7QUFHcEMsSUFBSSxDQUFDO0lBS0gsSUFBSSxFQUFFO1FBQ0osSUFBSSxFQUFFLEVBQXFCO1FBQzNCLElBQUksRUFBRSxFQUFFO1FBQ1IsS0FBSyxFQUFFLEVBQUU7S0FDVjtJQUtELE1BQU0sRUFBRTtRQUNOLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUNuQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDcEIsQ0FBQztJQUVELFlBQVk7UUFDVixhQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3RCLElBQUksRUFBRSxDQUFDLElBQUksRUFBRTtnQkFDWCxJQUFJLENBQUMsT0FBTyxDQUFDO29CQUNYLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUc7aUJBQ2xCLENBQUMsQ0FBQTthQUNIO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsS0FBSyxDQUFDLFdBQVc7UUFDZixNQUFNLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFBO1FBQ3hDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM3QixLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUNoQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQWdCO1FBQ3pCLE1BQU0sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsR0FBRyxLQUFLLENBQUE7UUFDcEQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElB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S0QsaUJBQWlCLEVBQUUsS0FBSztRQUN0QixNQUFNLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUN4QixFQUFFLENBQUMsbUJBQW1CLEVBQUUsQ0FBQTtJQUMxQixDQUFDO0lBS0QsYUFBYSxFQUFFO0lBRWYsQ0FBQztJQUtELGlCQUFpQixFQUFFO0lBRW5CLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZ2V4cE1haWwsIFJnZXhwVGVsIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3V0aWxcIlxuaW1wb3J0IGFwaSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvYXBpXCJcblxuLy8gbWluaXByb2dyYW0vcGFnZXMvaW5kZXgvYWxhcm1TZXR0aW5nL2luZGV4LmpzXG5QYWdlKHtcblxuICAvKipcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXG4gICAqL1xuICBkYXRhOiB7XG4gICAgZGV2czogW10gYXMgVWFydC5UZXJtaW5hbFtdLFxuICAgIHRlbHM6ICcnLFxuICAgIG1haWxzOiAnJ1xuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zb3J0RGV2c2xpc3QoKVxuICAgIHRoaXMuZ2V0dXNlclRlbHMoKVxuICB9LFxuXG4gIHNvcnREZXZzbGlzdCgpIHtcbiAgICBhcGkuQmluZERldigpLnRoZW4oZWwgPT4ge1xuICAgICAgaWYgKGVsLmNvZGUpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBkZXZzOiBlbC5kYXRhLlVUc1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGFzeW5jIGdldHVzZXJUZWxzKCkge1xuICAgIGNvbnN0IGVsID0gYXdhaXQgYXBpLmdldFVzZXJBbGFybVNldHVwKClcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdGVsczogZWwuZGF0YS50ZWxzLmpvaW4oJ1xcbicpLFxuICAgICAgbWFpbHM6IGVsLmRhdGEubWFpbHMuam9pbignXFxuJylcbiAgICB9KVxuICB9LFxuICAvLyDkv67mlLnnlKjmiLfogZTns7vmlrnlvI9cbiAgbW9kaWZ5VGVsbChldmVudDogdmFudEV2ZW50KSB7XG4gICAgY29uc3QgeyBkZXRhaWwsIGN1cnJlbnRUYXJnZXQ6IHsgZGF0YXNldCB9IH0gPSBldmVudFxuICAgIGNvbnN0IHZhbHVlID0gQXJyYXkuZnJvbShuZXcgU2V0KChkZXRhaWwudmFsdWUgYXMgc3RyaW5nKS5yZXBsYWNlKC8oXFwsfFxc77yMKS9nLCAnXFxuJykuc3BsaXQoJ1xcbicpLmZpbHRlcihlbCA9PiBlbCkpKVxuICAgIGNvbnN0IGtleSA9IGRhdGFzZXQua2V5IGFzIHN0cmluZ1xuICAgIGNvbnNvbGUubG9nKHZhbHVlKTtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgY2FzZSAndGVsJzpcbiAgICAgICAge1xuICAgICAgICAgIGNvbnN0IG9rID0gdmFsdWUuZXZlcnkoZWwgPT4gUmdleHBUZWwoZWwpKVxuICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICB0aXRsZTogXCLplJnor69cIixcbiAgICAgICAgICAgICAgY29udGVudDogXCLmnIDlpJrlj6rog73kv53lrZgz5Liq5Y+356CB77yB77yBXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9rKSB7XG4gICAgICAgICAgICB0aGlzLnB1c2h1c2VyVGVscyh2YWx1ZSwgbnVsbClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgdGl0bGU6ICfmoLzlvI/plJnor68nLFxuICAgICAgICAgICAgICBjb250ZW50OiAn5omL5py65Y+356CB5qC85byP5LiN5q2j56GuJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgXCJtYWlsXCI6XG4gICAgICAgIHtcbiAgICAgICAgICBjb25zdCBvayA9IHZhbHVlLmV2ZXJ5KGVsID0+IFJnZXhwTWFpbChlbCkpXG4gICAgICAgICAgaWYgKG9rKSB7XG4gICAgICAgICAgICB0aGlzLnB1c2h1c2VyVGVscyhudWxsLCB2YWx1ZSlcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgdGl0bGU6ICfmoLzlvI/plJnor68nLFxuICAgICAgICAgICAgICBjb250ZW50OiAn6YKu566x5qC85byP5LiN5q2j56GuJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICB9XG4gIH0sXG4gIC8vIOaPkOS6pOS/ruaUueiBlOezu+aWueW8j1xuICBwdXNodXNlclRlbHModGVsczogc3RyaW5nW10gfCBudWxsLCBtYWlsczogc3RyaW5nW10gfCBudWxsKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHRlbHM6IHRlbHMgPyB0ZWxzLmpvaW4oJ1xcbicpIDogdGhpcy5kYXRhLnRlbHMsXG4gICAgICBtYWlsczogbWFpbHMgPyBtYWlscy5qb2luKCdcXG4nKSA6IHRoaXMuZGF0YS5tYWlsc1xuICAgIH0pXG4gICAgYXBpLm1vZGlmeVVzZXJBbGFybVNldHVwVGVsKHRoaXMuZGF0YS50ZWxzLnNwbGl0KCdcXG4nKSwgdGhpcy5kYXRhLm1haWxzLnNwbGl0KCdcXG4nKSkudGhlbigoKSA9PiB7XG4gICAgICB3eC5zdGFydFB1bGxEb3duUmVmcmVzaCgpXG4gICAgfSlcblxuICB9LFxuXG4gIC8qKlxuICAgKiDorqLpmIXkuIvmrKHlkYroraZcbiAgICovXG4gIGFzeW5jIHN1Yk1lc3NhZ2UoKSB7XG4gICAgY29uc3QgdXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KCdodHRwOi8vbXAud2VpeGluLnFxLmNvbS9zP19fYml6PU1qTTVNakExTVRneE9RPT0mbWlkPTMwNDgxOTkzOSZpZHg9MSZzbj1kMGJjZDkyMjAzMzA3NWFmYTJiNTIxOWZjOTVlYmIxZSZjaGtzbT0zMTczYTllNzA2MDQyMGYxYTk4ZDAwNDBkOTY0YTJmODJhZjI1Mjg5YTczMWQxNDAwYzUyMjRjYTliYjNkMjI1ZDczNzcwMDcwMGE4I3JkJylcbiAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiAnL3BhZ2VzL2luZGV4L3dlYi93ZWI/dXJsPScgKyB1cmwgfSlcbiAgfSxcbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCB0aGlzLmdldHVzZXJUZWxzKClcbiAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKClcbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAqL1xuICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKCkge1xuXG4gIH1cbn0pIl19