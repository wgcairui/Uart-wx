"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../../../utils/util");
const api_1 = require("../../../utils/api");
Page({
    data: {
        devs: []
    },
    onLoad: function () {
        this.sortDevslist();
    },
    sortDevslist() {
        wx.getStorage({
            key: 'Uts'
        }).then(({ data }) => {
            this.setData({
                devs: data
            });
        }).catch(() => {
            wx.showModal({
                title: '设备错误',
                content: '缓存被清理或没有绑定设备,请在首页下拉刷新',
                success() {
                    wx.switchTab({ url: '/pages/index/index' });
                }
            });
        });
    },
    async deleteMountDev(event) {
        const { item, key } = event.currentTarget.dataset;
        wx.showModal({
            title: '解除挂载！！',
            content: `确定解除挂载设备：${item.mountDev} ？？`,
            success(res) {
                if (res.confirm) {
                    api_1.default.delTerminalMountDev(key, item.mountDev, item.pid).then(el => {
                        wx.startPullDownRefresh();
                    });
                }
            }
        });
    },
    addMonutDev(event) {
        const { item } = event.currentTarget.dataset;
        wx.navigateTo({
            url: '/pages/index/manageDev/addMountDev/addMountDev' + util_1.ObjectToStrquery({ item: JSON.stringify(item) }),
            events: {
                addSuccess() {
                    wx.nextTick(() => {
                        setTimeout(() => {
                            wx.startPullDownRefresh();
                        }, 500);
                    });
                }
            }
        });
    },
    async deleteDTU(event) {
        const { item: { DevMac, mountDevs, name } } = event.currentTarget.dataset;
        const del = await wx.showModal({
            title: `删除DTU`,
            content: `是否删除DTU:${name}?`,
        });
        if (del.confirm) {
            if (mountDevs.length > 0) {
                wx.showModal({
                    title: 'Tip',
                    content: `是否删除DTU绑定的所有设备?`,
                    success: async (res) => {
                        if (res.confirm) {
                            for (let dev of mountDevs) {
                                await this.deleteMountDev({ currentTarget: { dataset: { item: dev, key: DevMac } } });
                            }
                        }
                        else {
                            api_1.default.delUserTerminal(DevMac).then(() => {
                                wx.startPullDownRefresh();
                            });
                        }
                    }
                });
            }
            else {
                api_1.default.delUserTerminal(DevMac).then(() => {
                    wx.startPullDownRefresh();
                });
            }
        }
    },
    showDTUInfo(event) {
        wx.navigateTo({ url: `/pages/index/dtu/dtu?id=${event.currentTarget.dataset.item}` });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: async function () {
        const { arg } = await api_1.default.getuserMountDev();
        arg.UTs.forEach(el => {
            wx.setStorage({
                key: el._id,
                data: el
            });
        });
        wx.setStorage({
            key: 'Uts',
            data: arg.UTs
        });
        this.sortDevslist();
        wx.stopPullDownRefresh();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlRGV2LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFuYWdlRGV2LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQXNEO0FBQ3RELDRDQUFvQztBQUdwQyxJQUFJLENBQUM7SUFLSCxJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUUsRUFBZ0I7S0FDdkI7SUFLRCxNQUFNLEVBQUU7UUFDTixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDckIsQ0FBQztJQUVELFlBQVk7UUFDVixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLEtBQUs7U0FDWCxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQXdCLEVBQUUsRUFBRTtZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRTtZQUNaLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLE1BQU07Z0JBQ2IsT0FBTyxFQUFFLHVCQUF1QjtnQkFDaEMsT0FBTztvQkFDTCxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQTtnQkFDN0MsQ0FBQzthQUNGLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxjQUFjLENBQUMsS0FBbUM7UUFDdEQsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQTtRQUNqRCxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1gsS0FBSyxFQUFFLFFBQVE7WUFDZixPQUFPLEVBQUUsWUFBWSxJQUFJLENBQUMsUUFBUSxLQUFLO1lBQ3ZDLE9BQU8sQ0FBQyxHQUFHO2dCQUNULElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRTtvQkFD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QkFBaUIsRUFBRSxLQUFLO1FBQ3RCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUMzQyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUNuQixFQUFFLENBQUMsVUFBVSxDQUFDO2dCQUNaLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRztnQkFDWCxJQUFJLEVBQUUsRUFBRTthQUNULENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSxLQUFLO1lBQ1YsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHO1NBQ2QsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQ25CLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFBO0lBQzFCLENBQUM7Q0FHRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYmplY3RUb1N0cnF1ZXJ5IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3V0aWxcIlxuaW1wb3J0IGFwaSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvYXBpXCJcblxuLy8gbWluaXByb2dyYW0vcGFnZXMvaW5kZXgvYWxhcm1TZXR0aW5nL2luZGV4LmpzXG5QYWdlKHtcblxuICAvKipcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXG4gICAqL1xuICBkYXRhOiB7XG4gICAgZGV2czogW10gYXMgVGVybWluYWxbXVxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zb3J0RGV2c2xpc3QoKVxuICB9LFxuXG4gIHNvcnREZXZzbGlzdCgpIHtcbiAgICB3eC5nZXRTdG9yYWdlKHtcbiAgICAgIGtleTogJ1V0cydcbiAgICB9KS50aGVuKCh7IGRhdGEgfTogeyBkYXRhOiBUZXJtaW5hbFtdIH0pID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGRldnM6IGRhdGFcbiAgICAgIH0pXG4gICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6ICforr7lpIfplJnor68nLFxuICAgICAgICBjb250ZW50OiAn57yT5a2Y6KKr5riF55CG5oiW5rKh5pyJ57uR5a6a6K6+5aSHLOivt+WcqOmmlumhteS4i+aLieWIt+aWsCcsXG4gICAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgd3guc3dpdGNoVGFiKHsgdXJsOiAnL3BhZ2VzL2luZGV4L2luZGV4JyB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG4gIC8vIOWIoOmZpERUVeaMgui9veiuvuWkh1xuICBhc3luYyBkZWxldGVNb3VudERldihldmVudDogdmFudEV2ZW50PFRlcm1pbmFsTW91bnREZXZzPikge1xuICAgIGNvbnN0IHsgaXRlbSwga2V5IH0gPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXRcbiAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgdGl0bGU6ICfop6PpmaTmjILovb3vvIHvvIEnLFxuICAgICAgY29udGVudDogYOehruWumuino+mZpOaMgui9veiuvuWkh++8miR7aXRlbS5tb3VudERldn0g77yf77yfYCxcbiAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgIGFwaS5kZWxUZXJtaW5hbE1vdW50RGV2KGtleSwgaXRlbS5tb3VudERldiwgKGl0ZW0ucGlkIGFzIGFueSkpLnRoZW4oZWwgPT4ge1xuICAgICAgICAgICAgd3guc3RhcnRQdWxsRG93blJlZnJlc2goKVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gIH0sXG4gIC8vIOa3u+WKoOe7keWumuiuvuWkh1xuICBhZGRNb251dERldihldmVudDogdmFudEV2ZW50PFRlcm1pbmFsPikge1xuICAgIGNvbnN0IHsgaXRlbSB9ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6ICcvcGFnZXMvaW5kZXgvbWFuYWdlRGV2L2FkZE1vdW50RGV2L2FkZE1vdW50RGV2JyArIE9iamVjdFRvU3RycXVlcnkoeyBpdGVtOiBKU09OLnN0cmluZ2lmeShpdGVtKSB9KSxcbiAgICAgIGV2ZW50czoge1xuICAgICAgICBhZGRTdWNjZXNzKCkge1xuICAgICAgICAgIHd4Lm5leHRUaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICB3eC5zdGFydFB1bGxEb3duUmVmcmVzaCgpXG4gICAgICAgICAgICB9LCA1MDApXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIC8vIOWIoOmZpERUVVxuICBhc3luYyBkZWxldGVEVFUoZXZlbnQ6IHZhbnRFdmVudDxUZXJtaW5hbD4pIHtcbiAgICBjb25zdCB7IGl0ZW06IHsgRGV2TWFjLCBtb3VudERldnMsIG5hbWUgfSB9ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0XG4gICAgY29uc3QgZGVsID0gYXdhaXQgd3guc2hvd01vZGFsKHtcbiAgICAgIHRpdGxlOiBg5Yig6ZmkRFRVYCxcbiAgICAgIGNvbnRlbnQ6IGDmmK/lkKbliKDpmaREVFU6JHtuYW1lfT9gLFxuICAgIH0pXG5cbiAgICBpZiAoZGVsLmNvbmZpcm0pIHtcbiAgICAgIGlmIChtb3VudERldnMubGVuZ3RoID4gMCkge1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgIHRpdGxlOiAnVGlwJyxcbiAgICAgICAgICBjb250ZW50OiBg5piv5ZCm5Yig6ZmkRFRV57uR5a6a55qE5omA5pyJ6K6+5aSHP2AsXG4gICAgICAgICAgc3VjY2VzczogYXN5bmMgKHJlcykgPT4ge1xuICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgIGZvciAobGV0IGRldiBvZiBtb3VudERldnMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZU1vdW50RGV2KHsgY3VycmVudFRhcmdldDogeyBkYXRhc2V0OiB7IGl0ZW06IGRldiwga2V5OiBEZXZNYWMgfSB9IH0gYXMgYW55KVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhcGkuZGVsVXNlclRlcm1pbmFsKERldk1hYykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgd3guc3RhcnRQdWxsRG93blJlZnJlc2goKVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwaS5kZWxVc2VyVGVybWluYWwoRGV2TWFjKS50aGVuKCgpID0+IHtcbiAgICAgICAgICB3eC5zdGFydFB1bGxEb3duUmVmcmVzaCgpXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8vIOaYvuekuueUqOaIt0RUVeWPguaVsFxuICBzaG93RFRVSW5mbyhldmVudDogdmFudEV2ZW50PHN0cmluZz4pIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBgL3BhZ2VzL2luZGV4L2R0dS9kdHU/aWQ9JHtldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbX1gIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB7IGFyZyB9ID0gYXdhaXQgYXBpLmdldHVzZXJNb3VudERldigpXG4gICAgYXJnLlVUcy5mb3JFYWNoKGVsID0+IHtcbiAgICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAgICBrZXk6IGVsLl9pZCxcbiAgICAgICAgZGF0YTogZWxcbiAgICAgIH0pXG4gICAgfSlcbiAgICB3eC5zZXRTdG9yYWdlKHtcbiAgICAgIGtleTogJ1V0cycsXG4gICAgICBkYXRhOiBhcmcuVVRzXG4gICAgfSlcbiAgICB0aGlzLnNvcnREZXZzbGlzdCgpXG4gICAgd3guc3RvcFB1bGxEb3duUmVmcmVzaCgpXG4gIH0sXG5cblxufSkiXX0=