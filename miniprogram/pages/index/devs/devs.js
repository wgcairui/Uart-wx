"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../../../utils/util");
const api_1 = require("../../../utils/api");
Page({
    data: {
        mac: '',
        pid: '',
        mountDev: "",
        result: {},
        filter: '',
        protocol: '',
        Type: '',
        Constant: {},
        upsPic: 'http://www.ladishb.com/upload/342021__ups.gif',
        th: {
            temperature: '0',
            humidity: '0',
        },
        _oprateStat: false
    },
    onLoad: function (options) {
        wx.setNavigationBarTitle({ title: options.mountDev || options.mac || '' });
        this.setData({
            mac: options.DevMac,
            pid: options.pid,
            protocol: options.protocol,
            mountDev: options.mountDev,
            Type: options.Type
        });
        api_1.default.onMessage('MacDateUpdate' + options.DevMac + options.pid, () => {
            console.log('获取运行数据');
            this.GetDevsRunInfo();
        });
    },
    async onReady() {
        wx.showLoading({ title: '获取运行数据' });
        const sys = await api_1.default.getAlarmProtocol(this.data.protocol);
        const user = await api_1.default.getUserAlarmProtocol(this.data.protocol);
        if (sys.code) {
            this.setData({
                "Constant.sys": sys.data
            });
        }
        if (user.code) {
            this.setData({
                "Constant.user": user.data,
                "Constant.show": new Set([sys.data || [], user.data])
            });
        }
        this.setData({
            "Constant.show": new Set([sys.data?.ShowTag || [], user.data?.ShowTag || []].flat())
        });
        await this.GetDevsRunInfo();
        wx.hideLoading();
    },
    onShow: function () {
    },
    onHide: function () {
        api_1.default.offWs('MacDateUpdate' + this.options.DevMac + this.options.pid);
    },
    onUnload: function () {
        api_1.default.offWs('MacDateUpdate' + this.options.DevMac + this.options.pid);
    },
    onPullDownRefresh: async function () {
        await this.GetDevsRunInfo();
        wx.stopPullDownRefresh();
    },
    async GetDevsRunInfo() {
        const { mac, pid, filter } = this.data;
        const { code, data, msg } = await api_1.default.getTerminalData(mac, pid);
        if (code && data.result) {
            const regStr = new RegExp(filter);
            data.result = data.result.filter(el => this.data.Constant.show.has(el.name) && (!filter || regStr.test(el.name)));
            data.time = (0, util_1.parseTime)(data.time);
            this.setData({
                result: data,
                interval: setTimeout(() => {
                    this.GetDevsRunInfo();
                }, data.Interval && data.Interval >= 2000 ? data.Interval : 5000)
            });
            switch (this.data.Type) {
                case "UPS":
                    const workMode = data.result.find(el => el.name === this.data.Constant.sys.Constant.WorkMode)?.parseValue;
                    switch (workMode) {
                        case "电池模式":
                            this.setData({
                                upsPic: 'http://www.ladishb.com/upload/342021__ups1.gif'
                            });
                            break;
                        case "旁路模式":
                            this.setData({
                                upsPic: 'http://www.ladishb.com/upload/342021__ups2.gif'
                            });
                            break;
                        case "在线模式":
                            this.setData({
                                upsPic: 'http://www.ladishb.com/upload/342021__ups3.gif'
                            });
                            break;
                        default:
                            this.setData({
                                upsPic: 'http://www.ladishb.com/upload/342021__ups.gif'
                            });
                            break;
                    }
                    break;
                case "温湿度":
                    const { Temperature, Humidity } = this.data.Constant.sys.Constant;
                    this.setData({
                        th: {
                            temperature: data.result.find(el => el.name === Temperature)?.parseValue,
                            humidity: data.result.find(el => el.name === Humidity)?.parseValue
                        }
                    });
                    break;
            }
        }
        else {
            api_1.default.offWs('MacDateUpdate' + this.options.DevMac + this.options.pid);
            wx.showModal({
                title: 'Error',
                content: msg,
                success: () => {
                    api_1.default.offWs('MacDateUpdate' + this.options.DevMac + this.options.pid);
                }
            });
        }
    },
    filter(e) {
        const filter = e.detail.filter;
        const regStr = new RegExp(filter);
        const result = this.data.result.result?.filter(el => regStr.test(el.name));
        this.setData({
            filter,
            "result.result": result
        });
    },
    toline(e) {
        const url = '/pages/index/line/line' + (0, util_1.ObjectToStrquery)({ name: e.detail.name, mac: this.data.mac, pid: this.data.pid, protocol: this.data.protocol });
        console.log(url);
        wx.navigateTo({
            url
        });
    },
    async oprate(e) {
        if (this.data._oprateStat)
            return;
        const item = e.detail;
        if (item.value.includes("%i") && !item.val && item.val !== 0) {
            wx.navigateTo({
                url: '/pages/util/setVal/setVal' + (0, util_1.ObjectToStrquery)({ item }),
                events: {
                    valueOk: (value) => {
                        item.val = value.val;
                        this.oprate({ detail: item });
                    }
                }
            });
            return;
        }
        wx.showLoading({ title: '正在发送' });
        this.setData({
            _oprateStat: true
        });
        const { code, data, msg } = await api_1.default.SendProcotolInstructSet({ mountDev: this.data.mountDev, pid: Number(this.data.pid), protocol: this.data.protocol, DevMac: this.data.mac }, item);
        this.setData({
            _oprateStat: false
        });
        wx.hideLoading();
        wx.showModal({
            title: code ? 'Success' : 'Error',
            content: code ? data.msg : msg
        });
    },
    alarm(e) {
        const type = e.detail.type;
        wx.navigateTo({
            url: '/pages/index/alarmSetting/alarmSetting' + (0, util_1.ObjectToStrquery)({ type, protocol: this.data.protocol })
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRldnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw4Q0FBaUU7QUFDakUsNENBQW9DO0FBQ3BDLElBQUksQ0FBQztJQU1ILElBQUksRUFBRTtRQUNKLEdBQUcsRUFBRSxFQUFFO1FBQ1AsR0FBRyxFQUFFLEVBQUU7UUFDUCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU0sRUFBRSxFQUEwQjtRQUNsQyxNQUFNLEVBQUUsRUFBRTtRQUVWLFFBQVEsRUFBRSxFQUFFO1FBQ1osSUFBSSxFQUFFLEVBQUU7UUFDUixRQUFRLEVBQUUsRUFJVDtRQUNELE1BQU0sRUFBRSwrQ0FBK0M7UUFDdkQsRUFBRSxFQUFFO1lBQ0YsV0FBVyxFQUFFLEdBQUc7WUFDaEIsUUFBUSxFQUFFLEdBQUc7U0FDZDtRQUNELFdBQVcsRUFBRSxLQUFLO0tBQ25CO0lBS0QsTUFBTSxFQUFFLFVBQVUsT0FBcUY7UUFDckcsRUFBRSxDQUFDLHFCQUFxQixDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksT0FBTyxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQzFFLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxHQUFHLEVBQUUsT0FBTyxDQUFDLE1BQU07WUFDbkIsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHO1lBQ2hCLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7WUFDMUIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJO1NBQ25CLENBQUMsQ0FBQTtRQUVGLGFBQUcsQ0FBQyxTQUFTLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDakUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV0QixJQUFJLENBQUMsY0FBYyxFQUFFLENB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Q0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsd0NBQXdDLEdBQUcsSUFBQSx1QkFBZ0IsRUFBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUN6RyxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gbWluaXByb2dyYW0vcGFnZXMvaW5kZXgvZGV2cy9kZXZzLmpzXG5pbXBvcnQgeyBPYmplY3RUb1N0cnF1ZXJ5LCBwYXJzZVRpbWUgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvdXRpbFwiXG5pbXBvcnQgYXBpIGZyb20gXCIuLi8uLi8uLi91dGlscy9hcGlcIlxuUGFnZSh7XG5cbiAgLyoqXG4gICAqIOmhtemdoueahOWIneWni+aVsOaNrlxuICAgKi9cblxuICBkYXRhOiB7XG4gICAgbWFjOiAnJyxcbiAgICBwaWQ6ICcnLFxuICAgIG1vdW50RGV2OiBcIlwiLFxuICAgIHJlc3VsdDoge30gYXMgVWFydC5xdWVyeVJlc3VsdFNhdmUsXG4gICAgZmlsdGVyOiAnJyxcbiAgICAvL2ludGVydmFsOiAwIGFzIGFueSxcbiAgICBwcm90b2NvbDogJycsXG4gICAgVHlwZTogJycsXG4gICAgQ29uc3RhbnQ6IHt9IGFzIHtcbiAgICAgIHN5czogVWFydC5Qcm90b2NvbENvbnN0YW50VGhyZXNob2xkLFxuICAgICAgdXNlcjogVWFydC5Qcm90b2NvbENvbnN0YW50VGhyZXNob2xkLFxuICAgICAgc2hvdzogU2V0PHN0cmluZz5cbiAgICB9LFxuICAgIHVwc1BpYzogJ2h0dHA6Ly93d3cubGFkaXNoYi5jb20vdXBsb2FkLzM0MjAyMV9fdXBzLmdpZicsXG4gICAgdGg6IHtcbiAgICAgIHRlbXBlcmF0dXJlOiAnMCcsXG4gICAgICBodW1pZGl0eTogJzAnLFxuICAgIH0sXG4gICAgX29wcmF0ZVN0YXQ6IGZhbHNlXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yqg6L29XG4gICAqL1xuICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zOiB7IG1vdW50RGV2OiBhbnk7IG1hYzogYW55OyBEZXZNYWM6IGFueTsgcGlkOiBhbnk7IHByb3RvY29sOiBhbnk7IFR5cGU6IGFueSB9KSB7XG4gICAgd3guc2V0TmF2aWdhdGlvbkJhclRpdGxlKHsgdGl0bGU6IG9wdGlvbnMubW91bnREZXYgfHwgb3B0aW9ucy5tYWMgfHwgJycgfSlcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgbWFjOiBvcHRpb25zLkRldk1hYyxcbiAgICAgIHBpZDogb3B0aW9ucy5waWQsXG4gICAgICBwcm90b2NvbDogb3B0aW9ucy5wcm90b2NvbCxcbiAgICAgIG1vdW50RGV2OiBvcHRpb25zLm1vdW50RGV2LFxuICAgICAgVHlwZTogb3B0aW9ucy5UeXBlXG4gICAgfSlcblxuICAgIGFwaS5vbk1lc3NhZ2UoJ01hY0RhdGVVcGRhdGUnICsgb3B0aW9ucy5EZXZNYWMgKyBvcHRpb25zLnBpZCwgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ+iOt+WPlui/kOihjOaVsOaNricpO1xuICAgICAgXG4gICAgICB0aGlzLkdldERldnNSdW5JbmZvKClcbiAgICB9KVxuICB9LFxuICBhc3luYyBvblJlYWR5KCkge1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfojrflj5bov5DooYzmlbDmja4nIH0pXG4gICAgY29uc3Qgc3lzID0gYXdhaXQgYXBpLmdldEFsYXJtUHJvdG9jb2wodGhpcy5kYXRhLnByb3RvY29sKVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhcGkuZ2V0VXNlckFsYXJtUHJvdG9jb2wodGhpcy5kYXRhLnByb3RvY29sKVxuICAgIGlmIChzeXMuY29kZSkge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgXCJDb25zdGFudC5zeXNcIjogc3lzLmRhdGFcbiAgICAgIH0pXG4gICAgfVxuICAgIGlmICh1c2VyLmNvZGUpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIFwiQ29uc3RhbnQudXNlclwiOiB1c2VyLmRhdGEsXG4gICAgICAgIFwiQ29uc3RhbnQuc2hvd1wiOiBuZXcgU2V0KFtzeXMuZGF0YSB8fCBbXSwgdXNlci5kYXRhXSlcbiAgICAgIH0pXG4gICAgfVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBcIkNvbnN0YW50LnNob3dcIjogbmV3IFNldChbc3lzLmRhdGE/LlNob3dUYWcgfHwgW10sIHVzZXIuZGF0YT8uU2hvd1RhZyB8fCBbXV0uZmxhdCgpKVxuICAgIH0pXG5cbiAgICBhd2FpdCB0aGlzLkdldERldnNSdW5JbmZvKClcbiAgICB3eC5oaWRlTG9hZGluZygpXG4gIH0sXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxuICAgKi9cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgLyogdGhpcy5zZXREYXRhKHtcbiAgICAgIGludGVydmFsOiBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLkdldERldnNSdW5JbmZvKCksIDUwMDApXG4gICAgfSkgKi9cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuICAgIC8vY2xlYXJJbnRlcnZhbCh0aGlzLmRhdGEuaW50ZXJ2YWwpXG4gICAgYXBpLm9mZldzKCdNYWNEYXRlVXBkYXRlJyArIHRoaXMub3B0aW9ucy5EZXZNYWMgKyB0aGlzLm9wdGlvbnMucGlkKVxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvL2NsZWFySW50ZXJ2YWwodGhpcy5kYXRhLmludGVydmFsKVxuICAgIGFwaS5vZmZXcygnTWFjRGF0ZVVwZGF0ZScgKyB0aGlzLm9wdGlvbnMuRGV2TWFjICsgdGhpcy5vcHRpb25zLnBpZClcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCB0aGlzLkdldERldnNSdW5JbmZvKClcbiAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKClcbiAgfSxcblxuXG4gIGFzeW5jIEdldERldnNSdW5JbmZvKCkge1xuICAgIGNvbnN0IHsgbWFjLCBwaWQsIGZpbHRlciB9ID0gdGhpcy5kYXRhXG4gICAgY29uc3QgeyBjb2RlLCBkYXRhLCBtc2cgfSA9IGF3YWl0IGFwaS5nZXRUZXJtaW5hbERhdGEobWFjLCBwaWQpXG4gICAgaWYgKGNvZGUgJiYgZGF0YS5yZXN1bHQpIHtcbiAgICAgIGNvbnN0IHJlZ1N0ciA9IG5ldyBSZWdFeHAoZmlsdGVyKVxuICAgICAgZGF0YS5yZXN1bHQgPSBkYXRhLnJlc3VsdC5maWx0ZXIoZWwgPT4gdGhpcy5kYXRhLkNvbnN0YW50LnNob3cuaGFzKGVsLm5hbWUpICYmICghZmlsdGVyIHx8IHJlZ1N0ci50ZXN0KGVsLm5hbWUpKSlcbiAgICAgIGRhdGEudGltZSA9IHBhcnNlVGltZShkYXRhLnRpbWUpXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICByZXN1bHQ6IGRhdGEsXG4gICAgICAgIGludGVydmFsOiBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLkdldERldnNSdW5JbmZvKClcbiAgICAgICAgfSwgZGF0YS5JbnRlcnZhbCAmJiBkYXRhLkludGVydmFsID49IDIwMDAgPyBkYXRhLkludGVydmFsIDogNTAwMClcbiAgICAgIH0pXG4gICAgICAvL1xuXG4gICAgICBzd2l0Y2ggKHRoaXMuZGF0YS5UeXBlKSB7XG4gICAgICAgIGNhc2UgXCJVUFNcIjpcbiAgICAgICAgICBjb25zdCB3b3JrTW9kZSA9IGRhdGEucmVzdWx0LmZpbmQoZWwgPT4gZWwubmFtZSA9PT0gdGhpcy5kYXRhLkNvbnN0YW50LnN5cy5Db25zdGFudC5Xb3JrTW9kZSk/LnBhcnNlVmFsdWUgYXMgc3RyaW5nXG4gICAgICAgICAgc3dpdGNoICh3b3JrTW9kZSkge1xuICAgICAgICAgICAgY2FzZSBcIueUteaxoOaooeW8j1wiOlxuICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIHVwc1BpYzogJ2h0dHA6Ly93d3cubGFkaXNoYi5jb20vdXBsb2FkLzM0MjAyMV9fdXBzMS5naWYnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBjYXNlIFwi5peB6Lev5qih5byPXCI6XG4gICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgdXBzUGljOiAnaHR0cDovL3d3dy5sYWRpc2hiLmNvbS91cGxvYWQvMzQyMDIxX191cHMyLmdpZidcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIGNhc2UgXCLlnKjnur/mqKHlvI9cIjpcbiAgICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICB1cHNQaWM6ICdodHRwOi8vd3d3LmxhZGlzaGIuY29tL3VwbG9hZC8zNDIwMjFfX3VwczMuZ2lmJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICB1cHNQaWM6ICdodHRwOi8vd3d3LmxhZGlzaGIuY29tL3VwbG9hZC8zNDIwMjFfX3Vwcy5naWYnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIFwi5rip5rm/5bqmXCI6XG4gICAgICAgICAgY29uc3QgeyBUZW1wZXJhdHVyZSwgSHVtaWRpdHkgfSA9IHRoaXMuZGF0YS5Db25zdGFudC5zeXMuQ29uc3RhbnRcbiAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgdGg6IHtcbiAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IGRhdGEucmVzdWx0LmZpbmQoZWwgPT4gZWwubmFtZSA9PT0gVGVtcGVyYXR1cmUpPy5wYXJzZVZhbHVlISxcbiAgICAgICAgICAgICAgaHVtaWRpdHk6IGRhdGEucmVzdWx0LmZpbmQoZWwgPT4gZWwubmFtZSA9PT0gSHVtaWRpdHkpPy5wYXJzZVZhbHVlIVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY2xlYXJJbnRlcnZhbCh0aGlzLmRhdGEuaW50ZXJ2YWwpXG4gICAgICBhcGkub2ZmV3MoJ01hY0RhdGVVcGRhdGUnICsgdGhpcy5vcHRpb25zLkRldk1hYyArIHRoaXMub3B0aW9ucy5waWQpXG5cbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIHRpdGxlOiAnRXJyb3InLFxuICAgICAgICBjb250ZW50OiBtc2csXG4gICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAvLyBjbGVhckludGVydmFsKHRoaXMuZGF0YS5pbnRlcnZhbClcbiAgICAgICAgICBhcGkub2ZmV3MoJ01hY0RhdGVVcGRhdGUnICsgdGhpcy5vcHRpb25zLkRldk1hYyArIHRoaXMub3B0aW9ucy5waWQpXG4gICAgICAgICAgLy93eC5uYXZpZ2F0ZUJhY2soKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcbiAgLy8g5Yi36YCJ5Y+C5pWwXG4gIGZpbHRlcihlOiB2YW50RXZlbnQpIHtcbiAgICBjb25zdCBmaWx0ZXIgPSBlLmRldGFpbC5maWx0ZXJcbiAgICBjb25zdCByZWdTdHIgPSBuZXcgUmVnRXhwKGZpbHRlcilcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLmRhdGEucmVzdWx0LnJlc3VsdD8uZmlsdGVyKGVsID0+IHJlZ1N0ci50ZXN0KGVsLm5hbWUpKVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBmaWx0ZXIsXG4gICAgICBcInJlc3VsdC5yZXN1bHRcIjogcmVzdWx0XG4gICAgfSlcbiAgfSxcbiAgLy8g5a+86Iiq5Yiw5Zu+6KGoXG4gIHRvbGluZShlOiB2YW50RXZlbnQpIHtcbiAgICBjb25zdCB1cmwgPSAnL3BhZ2VzL2luZGV4L2xpbmUvbGluZScgKyBPYmplY3RUb1N0cnF1ZXJ5KHsgbmFtZTogZS5kZXRhaWwubmFtZSwgbWFjOiB0aGlzLmRhdGEubWFjLCBwaWQ6IHRoaXMuZGF0YS5waWQsIHByb3RvY29sOiB0aGlzLmRhdGEucHJvdG9jb2wgfSlcbiAgICBjb25zb2xlLmxvZyh1cmwpO1xuXG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmxcbiAgICB9KVxuICB9LFxuXG4gIC8vIOWPkemAgeaTjeS9nOaMh+S7pFxuICBhc3luYyBvcHJhdGUoZTogUGljazx2YW50RXZlbnQ8VWFydC5PcHJhdGVJbnN0cnVjdD4sICdkZXRhaWwnPikge1xuICAgIGlmICh0aGlzLmRhdGEuX29wcmF0ZVN0YXQpIHJldHVyblxuICAgIGNvbnN0IGl0ZW06IFVhcnQuT3ByYXRlSW5zdHJ1Y3QgPSBlLmRldGFpbFxuICAgIGlmIChpdGVtLnZhbHVlLmluY2x1ZGVzKFwiJWlcIikgJiYgIWl0ZW0udmFsICYmIGl0ZW0udmFsICE9PSAwKSB7XG4gICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgdXJsOiAnL3BhZ2VzL3V0aWwvc2V0VmFsL3NldFZhbCcgKyBPYmplY3RUb1N0cnF1ZXJ5KHsgaXRlbSB9KSxcbiAgICAgICAgZXZlbnRzOiB7XG4gICAgICAgICAgdmFsdWVPazogKHZhbHVlOiB7IHZhbDogbnVtYmVyIH0pID0+IHtcbiAgICAgICAgICAgIGl0ZW0udmFsID0gdmFsdWUudmFsXG4gICAgICAgICAgICB0aGlzLm9wcmF0ZSh7IGRldGFpbDogaXRlbSB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5q2j5Zyo5Y+R6YCBJyB9KVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBfb3ByYXRlU3RhdDogdHJ1ZVxuICAgIH0pXG4gICAgY29uc3QgeyBjb2RlLCBkYXRhLCBtc2cgfSA9IGF3YWl0IGFwaS5TZW5kUHJvY290b2xJbnN0cnVjdFNldCh7IG1vdW50RGV2OiB0aGlzLmRhdGEubW91bnREZXYsIHBpZDogTnVtYmVyKHRoaXMuZGF0YS5waWQpLCBwcm90b2NvbDogdGhpcy5kYXRhLnByb3RvY29sLCBEZXZNYWM6IHRoaXMuZGF0YS5tYWMgfSBhcyBhbnksIGl0ZW0pXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIF9vcHJhdGVTdGF0OiBmYWxzZVxuICAgIH0pXG4gICAgd3guaGlkZUxvYWRpbmcoKVxuICAgIC8vIOWmguaenOiuvuWkh+acqumAmui/h+agoemqjO+8jOWImei3s+i9rOWIsOagoemqjOefreS/oemqjOivgeeggemhtemdolxuICAgIC8qIGlmIChvayA9PT0gNCkge1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6ICfmnYPpmZDpqozor4EnLFxuICAgICAgICBjb250ZW50OiAn5pON5L2c5oyH5Luk6ZyA6KaB6aqM6K+B5oKo55qE6K6+5aSHLOaYr+WQpumAmui/h+efreS/oeW8gOWni+mqjOivge+8nycsXG4gICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvdXRpbC9zbXNWYWxpZGF0aW9uL3Ntc1ZhbGlkYXRpb24nLFxuICAgICAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uU3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NtcyB2YWxpZGF0aW9uIHN1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMub3ByYXRlKHsgZGV0YWlsOiBpdGVtIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9ICAqL1xuICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICB0aXRsZTogY29kZSA/ICdTdWNjZXNzJyA6ICdFcnJvcicsXG4gICAgICBjb250ZW50OiBjb2RlID8gZGF0YS5tc2cgOiBtc2dcbiAgICB9KVxuXG4gIH0sXG4gIC8vIOi3s+i9rOWRiuitpuiuvue9rlxuICBhbGFybShlOiB2YW50RXZlbnQpIHtcbiAgICBjb25zdCB0eXBlID0gZS5kZXRhaWwudHlwZSBhcyBzdHJpbmdcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy9wYWdlcy9pbmRleC9hbGFybVNldHRpbmcvYWxhcm1TZXR0aW5nJyArIE9iamVjdFRvU3RycXVlcnkoeyB0eXBlLCBwcm90b2NvbDogdGhpcy5kYXRhLnByb3RvY29sIH0pXG4gICAgfSlcbiAgfVxufSkiXX0=