"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../../utils/util");
const api_1 = require("../../utils/api");
Page({
    data: {
        ready: false,
        DTUs: [],
        dtuItem: [],
        state: '',
        alarm: '',
        alarmNum: 0,
        alarmData: [],
        Vm: [],
        confirm: false,
        sub: false
    },
    devPics: {
        "UPS": 'https://besiv-uart.oss-cn-hangzhou.aliyuncs.com/png/99daa3e07c7b60ef7e16ed8b9fe7cf33.png',
        "温湿度": 'https://besiv-uart.oss-cn-hangzhou.aliyuncs.com/png/5fc7d6fe0571b714d5a3395a8c7a9f12.png',
        "电量仪": 'https://besiv-uart.oss-cn-hangzhou.aliyuncs.com/png/ab52d9fccdddc0fa5b0386ea0b5cbc7f.png',
        "空调": 'https://besiv-uart.oss-cn-hangzhou.aliyuncs.com/png/c3c1852270ca35fd56135d8fda2a9977.png'
    },
    onLoad(query) {
        wx.showLoading({ title: 'login' });
        wx.login({
            success: async (login) => {
                const { code, data } = await api_1.default.login({ js_code: login.code, scene: query.scene ? decodeURIComponent(query.scene) : '' });
                if (code) {
                    const user = await api_1.default.userInfo();
                    wx.hideLoading();
                    switch (user.data.userGroup) {
                        case "admin":
                        case "root":
                            wx.reLaunch({ url: "/pages/admin/index" });
                            break;
                        default:
                            this.setData({ ready: true, sub: Boolean(user.data.wxId) });
                            await this.start();
                            break;
                    }
                }
                else {
                    wx.hideLoading();
                    wx.reLaunch({ url: "/pages/login/login?openid=" + data.openid + "&unionid=" + data.unionid });
                }
            }
        });
    },
    async start() {
        await this.bindDev();
        this.data.DTUs.forEach(dtu => {
            api_1.default.onMessage('MacUpdate' + dtu.DevMac, () => {
                console.log(`listen MacUpdate,mac:${dtu.DevMac}`);
                this.bindDev();
            });
        });
    },
    async subMessage() {
        const url = encodeURIComponent('http://mp.weixin.qq.com/s?__biz=MjM5MjA1MTgxOQ==&mid=304819939&idx=1&sn=d0bcd922033075afa2b5219fc95ebb1e&chksm=3173a9e7060420f1a98d0040d964a2f82af25289a731d1400c5224ca9bb3d225d737700700a8#rd');
        wx.navigateTo({ url: '/pages/index/web/web?url=' + url });
    },
    async bindDev() {
        wx.showLoading({ title: '获取DTU' });
        const { code, data } = await api_1.default.BindDev();
        wx.hideLoading();
        wx.stopPullDownRefresh();
        if (code) {
            if (data.UTs.length === 0) {
                this.setData({
                    DTUs: [],
                    dtuItem: []
                });
                if (!this.data.confirm) {
                    wx.showModal({
                        title: '添加设备',
                        content: '您还没有任何设备，是否添加设备?',
                        success: (res) => {
                            if (res.confirm) {
                                wx.navigateTo({
                                    url: '/pages/index/bindDev/bindDev'
                                });
                            }
                            else {
                                this.setData({
                                    confirm: true
                                });
                            }
                        }
                    });
                }
            }
            else {
                this.sortDevs(data.UTs);
                api_1.default.getAlarmunconfirmed().then(({ data: len }) => {
                    if (Number(len) > 0) {
                        this.setData({
                            alarm: `有${len}条未确认的告警信息，点击查看?`,
                            alarmNum: Number(len)
                        });
                    }
                    else {
                        this.setData({
                            alarm: ``,
                            alarmNum: Number(len),
                            alarmData: []
                        });
                    }
                });
            }
        }
    },
    sortDevs(UTs) {
        wx.setStorage({
            key: 'Uts',
            data: UTs
        });
        this.countDev(UTs);
        const devs = UTs.map(dtu => {
            return dtu.mountDevs.map(dev => ({ ...dev, pic: this.devPics[dev.Type], dtu: dtu.name, online: dev.online && dtu.online }));
        }).flat();
        this.setData({
            DTUs: UTs,
            dtuItem: devs
        });
    },
    toDev(event) {
        const { DevMac } = event.currentTarget.dataset.item;
        wx.navigateTo({
            url: '/pages/index/dtu/dtu' + (0, util_1.ObjectToStrquery)({ mac: DevMac })
        });
    },
    showMountDevData(event) {
        const { pid, mountDev, protocol, dtu, Type } = event.currentTarget.dataset.item;
        const { DevMac } = this.data.DTUs.find(el => el.name === dtu);
        wx.navigateTo({
            url: '/pages/index/devs/devs' + (0, util_1.ObjectToStrquery)({ pid: String(pid), mountDev, protocol, DevMac, Type })
        });
    },
    seeAlarm() {
        wx.switchTab({ url: '/pages/index/alarm/alarm' });
    },
    countDev(terminals) {
        const terminal_all = terminals.length;
        const terminal_on = terminals.map(el => el.online).filter(el => el).length;
        const monutDev_all = terminals.map(el => el.mountDevs.length).reduce((pre, cur) => pre + cur);
        const mountDev_on = terminals.map(el => el.mountDevs.filter(el2 => el2.online)).reduce((pre, cur) => [...pre, ...cur]).length;
        const state = `DTU:(全部${terminal_all}/在线${terminal_on}),挂载设备:(全部${monutDev_all}/在线${mountDev_on})`;
        this.setData({
            state
        });
    },
    async onPullDownRefresh() {
        await this.bindDev();
        this.countDev(this.data.DTUs);
        this.start();
        wx.stopPullDownRefresh();
    },
    bindload(event) {
        console.log(`公众号加载success,状态:${event.detail.errMsg}`);
    },
    binderror(event) {
        console.log(`公众号加载error,状态:${event.detail.errMsg}`);
    },
    trial() {
        wx.showLoading({ title: 'login' });
        wx.login({
            success: async (login) => {
                const { code } = await api_1.default.trial({ js_code: login.code });
                if (code) {
                    this.start();
                    wx.hideLoading();
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDJDQUFvRDtBQUNwRCx5Q0FBa0M7QUFFbEMsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLEtBQUs7UUFFWixJQUFJLEVBQUUsRUFBcUI7UUFFM0IsT0FBTyxFQUFFLEVBQThCO1FBRXZDLEtBQUssRUFBRSxFQUFFO1FBRVQsS0FBSyxFQUFFLEVBQUU7UUFFVCxRQUFRLEVBQUUsQ0FBQztRQUVYLFNBQVMsRUFBRSxFQUE0QjtRQUV2QyxFQUFFLEVBQUUsRUFBcUI7UUFDekIsT0FBTyxFQUFFLEtBQUs7UUFFZCxHQUFHLEVBQUUsS0FBSztLQUNYO0lBRUQsT0FBTyxFQUFFO1FBQ1AsS0FBSyxFQUFFLDBGQUEwRjtRQUNqRyxLQUFLLEVBQUUsMEZBQTBGO1FBQ2pHLEtBQUssRUFBRSwwRkFBMEY7UUFDakcsSUFBSSxFQUFFLDBGQUEwRjtLQUN2RTtJQUMzQixNQUFNLENBQUMsS0FBVTtRQUNmLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUNsQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ1AsT0FBTyxFQUFFLEtBQUssRUFBQyxLQUFLLEVBQUMsRUFBRTtnQkFFckIsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO2dCQUMxSCxJQUFJLElBQUksRUFBRTtvQkFDUixNQUFNLElBQUksR0FBRyxNQUFNLGFBQUcsQ0FBQyxRQUFRLEVBQUUs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QUMxQixDQUFDO0lBRUQsUUFBUSxDQUFDLEtBQWdCO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBQ0QsU0FBUyxDQUFDLEtBQWdCO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsS0FBSztRQUNILEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUNsQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ1AsT0FBTyxFQUFFLEtBQUssRUFBQyxLQUFLLEVBQUMsRUFBRTtnQkFFckIsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sYUFBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQTtnQkFDeEQsSUFBSSxJQUFJLEVBQUU7b0JBQ1IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO29CQUNaLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtpQkFDakI7WUFDSCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQWlCRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbmRleC50c1xuaW1wb3J0IHsgT2JqZWN0VG9TdHJxdWVyeSB9IGZyb20gXCIuLi8uLi91dGlscy91dGlsXCI7XG5pbXBvcnQgYXBpIGZyb20gXCIuLi8uLi91dGlscy9hcGlcIjtcbi8vIOiOt+WPluW6lOeUqOWunuS+i1xuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICByZWFkeTogZmFsc2UsXG4gICAgLyoqIERUVeiuvuWkh+S/oeaBryAqL1xuICAgIERUVXM6IFtdIGFzIFVhcnQuVGVybWluYWxbXSxcbiAgICAvLyDliLfpgInmjILovb3orr7lpIfliJfooahcbiAgICBkdHVJdGVtOiBbXSBhcyBVYXJ0LlRlcm1pbmFsTW91bnREZXZzW10sXG4gICAgLy8g5oyC6L2954q25oCB5L+h5oGvXG4gICAgc3RhdGU6ICcnLFxuICAgIC8vIOWRiuitpueKtuaAgeS/oeaBr1xuICAgIGFsYXJtOiAnJyxcbiAgICAvLyDmnKrnoa7orqTlkYrorabmlbDph49cbiAgICBhbGFybU51bTogMCxcbiAgICAvLyDkupTmnaHlhoXlkYrorabmlbDmja5cbiAgICBhbGFybURhdGE6IFtdIGFzIFVhcnQudWFydEFsYXJtT2JqZWN0W10sXG4gICAgLy8g6Jma5ouf6K6+5aSHXG4gICAgVm06IFtdIGFzIFVhcnQuVGVybWluYWxbXSxcbiAgICBjb25maXJtOiBmYWxzZSxcbiAgICAvLyDmmK/lkKborqLpmIVcbiAgICBzdWI6IGZhbHNlXG4gIH0sXG5cbiAgZGV2UGljczoge1xuICAgIFwiVVBTXCI6ICdodHRwczovL2Jlc2l2LXVhcnQub3NzLWNuLWhhbmd6aG91LmFsaXl1bmNzLmNvbS9wbmcvOTlkYWEzZTA3YzdiNjBlZjdlMTZlZDhiOWZlN2NmMzMucG5nJyxcbiAgICBcIua4qea5v+W6plwiOiAnaHR0cHM6Ly9iZXNpdi11YXJ0Lm9zcy1jbi1oYW5nemhvdS5hbGl5dW5jcy5jb20vcG5nLzVmYzdkNmZlMDU3MWI3MTRkNWEzMzk1YThjN2E5ZjEyLnBuZycsXG4gICAgXCLnlLXph4/ku6pcIjogJ2h0dHBzOi8vYmVzaXYtdWFydC5vc3MtY24taGFuZ3pob3UuYWxpeXVuY3MuY29tL3BuZy9hYjUyZDlmY2NkZGRjMGZhNWIwMzg2ZWEwYjVjYmM3Zi5wbmcnLFxuICAgIFwi56m66LCDXCI6ICdodHRwczovL2Jlc2l2LXVhcnQub3NzLWNuLWhhbmd6aG91LmFsaXl1bmNzLmNvbS9wbmcvYzNjMTg1MjI3MGNhMzVmZDU2MTM1ZDhmZGEyYTk5NzcucG5nJ1xuICB9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gIG9uTG9hZChxdWVyeTogYW55KSB7XG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ2xvZ2luJyB9KVxuICAgIHd4LmxvZ2luKHtcbiAgICAgIHN1Y2Nlc3M6IGFzeW5jIGxvZ2luID0+IHtcbiAgICAgICAgLy8g5Y+R6YCB572R57uc6K+35rGC77yM6I635Y+W5Zyo57q/6LSm5oi3XG4gICAgICAgIGNvbnN0IHsgY29kZSwgZGF0YSB9ID0gYXdhaXQgYXBpLmxvZ2luKHsganNfY29kZTogbG9naW4uY29kZSwgc2NlbmU6IHF1ZXJ5LnNjZW5lID8gZGVjb2RlVVJJQ29tcG9uZW50KHF1ZXJ5LnNjZW5lKSA6ICcnIH0pXG4gICAgICAgIGlmIChjb2RlKSB7XG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFwaS51c2VySW5mbygpXG4gICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuXG4gICAgICAgICAgLy8g5Yik5patdXNlcueUqOaIt+e7hCzlpoLmnpzmmK9hZG1pbuWImei3s+i9rOWIsOS4k+aciemhtemdolxuICAgICAgICAgIHN3aXRjaCAodXNlci5kYXRhLnVzZXJHcm91cCkge1xuICAgICAgICAgICAgY2FzZSBcImFkbWluXCI6XG4gICAgICAgICAgICBjYXNlIFwicm9vdFwiOlxuICAgICAgICAgICAgICB3eC5yZUxhdW5jaCh7IHVybDogXCIvcGFnZXMvYWRtaW4vaW5kZXhcIiB9KVxuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7IHJlYWR5OiB0cnVlLCBzdWI6IEJvb2xlYW4odXNlci5kYXRhLnd4SWQpIH0pXG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnQoKVxuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICAgICAgd3gucmVMYXVuY2goeyB1cmw6IFwiL3BhZ2VzL2xvZ2luL2xvZ2luP29wZW5pZD1cIiArIChkYXRhIGFzIGFueSkub3BlbmlkICsgXCImdW5pb25pZD1cIiArIChkYXRhIGFzIGFueSkudW5pb25pZCB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICAvLyDnmbvlvZXov5DooYxcbiAgYXN5bmMgc3RhcnQoKSB7XG4gICAgYXdhaXQgdGhpcy5iaW5kRGV2KClcbiAgICAvLyDnm5HlkKznlKjmiLfnu5HlrprnmoTorr7lpIfnirbmgIHlj5jmm7Tkuovku7Ys5Y+K5pe25Yi35paw6K6+5aSH54q25oCBXG4gICAgdGhpcy5kYXRhLkRUVXMuZm9yRWFjaChkdHU9PntcbiAgICAgIGFwaS5vbk1lc3NhZ2U8c3RyaW5nPignTWFjVXBkYXRlJytkdHUuRGV2TWFjLCAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBsaXN0ZW4gTWFjVXBkYXRlLG1hYzoke2R0dS5EZXZNYWN9YCk7XG4gICAgICAgIHRoaXMuYmluZERldigpXG4gICAgICB9KVxuICAgIH0pXG4gICAgXG4gIH0sXG5cbiAgLyoqXG4gICAqIOiuoumYheS4i+asoeWRiuitplxuICAgKi9cbiAgYXN5bmMgc3ViTWVzc2FnZSgpIHtcbiAgICBjb25zdCB1cmwgPSBlbmNvZGVVUklDb21wb25lbnQoJ2h0dHA6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TWpNNU1qQTFNVGd4T1E9PSZtaWQ9MzA0ODE5OTM5JmlkeD0xJnNuPWQwYmNkOTIyMDMzMDc1YWZhMmI1MjE5ZmM5NWViYjFlJmNoa3NtPTMxNzNhOWU3MDYwNDIwZjFhOThkMDA0MGQ5NjRhMmY4MmFmMjUyODlhNzMxZDE0MDBjNTIyNGNhOWJiM2QyMjVkNzM3NzAwNzAwYTgjcmQnKVxuICAgIHd4Lm5hdmlnYXRlVG8oeyB1cmw6ICcvcGFnZXMvaW5kZXgvd2ViL3dlYj91cmw9JyArIHVybCB9KVxuICB9LFxuXG4gIC8vIOiOt+WPlueUqOaIt+e7keWumuiuvuWkh1xuICBhc3luYyBiaW5kRGV2KCkge1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfojrflj5ZEVFUnIH0pXG4gICAgY29uc3QgeyBjb2RlLCBkYXRhIH0gPSBhd2FpdCBhcGkuQmluZERldigpXG4gICAgd3guaGlkZUxvYWRpbmcoKVxuICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goKVxuICAgIGlmIChjb2RlKSB7XG5cbiAgICAgIGlmIChkYXRhLlVUcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBEVFVzOiBbXSxcbiAgICAgICAgICBkdHVJdGVtOiBbXVxuICAgICAgICB9KVxuICAgICAgICBpZiAoIXRoaXMuZGF0YS5jb25maXJtKSB7XG4gICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgIHRpdGxlOiAn5re75Yqg6K6+5aSHJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICfmgqjov5jmsqHmnInku7vkvZXorr7lpIfvvIzmmK/lkKbmt7vliqDorr7lpIc/JyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvaW5kZXgvYmluZERldi9iaW5kRGV2J1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICAgIGNvbmZpcm06IHRydWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC8vdGhpcy5hZGRWbSgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNvcnREZXZzKGRhdGEuVVRzKVxuICAgICAgICAvLyDojrflj5bmnKror7vlj5bnmoRhbGFybeaVsOmHj1xuICAgICAgICBhcGkuZ2V0QWxhcm11bmNvbmZpcm1lZCgpLnRoZW4oKHsgZGF0YTogbGVuIH0pID0+IHtcbiAgICAgICAgICBpZiAoTnVtYmVyKGxlbikgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICBhbGFybTogYOaciSR7bGVufeadoeacquehruiupOeahOWRiuitpuS/oeaBr++8jOeCueWHu+afpeeciz9gLFxuICAgICAgICAgICAgICBhbGFybU51bTogTnVtYmVyKGxlbilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgIGFsYXJtOiBgYCxcbiAgICAgICAgICAgICAgYWxhcm1OdW06IE51bWJlcihsZW4pLFxuICAgICAgICAgICAgICBhbGFybURhdGE6IFtdXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLy8g5aSE55CG6K6+5aSH5YiG57G7XG4gIHNvcnREZXZzKFVUczogVWFydC5UZXJtaW5hbFtdKSB7XG4gICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICBrZXk6ICdVdHMnLFxuICAgICAgZGF0YTogVVRzXG4gICAgfSlcbiAgICB0aGlzLmNvdW50RGV2KFVUcylcbiAgICBjb25zdCBkZXZzID0gVVRzLm1hcChkdHUgPT4ge1xuICAgICAgcmV0dXJuIGR0dS5tb3VudERldnMubWFwKGRldiA9PiAoeyAuLi5kZXYsIHBpYzogdGhpcy5kZXZQaWNzW2Rldi5UeXBlXSwgZHR1OiBkdHUubmFtZSwgb25saW5lOiBkZXYub25saW5lICYmIGR0dS5vbmxpbmUgfSkpXG4gICAgfSkuZmxhdCgpXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIERUVXM6IFVUcyxcbiAgICAgIGR0dUl0ZW06IGRldnNcbiAgICB9KVxuICB9LFxuXG4gIC8vIOafpeeci+aMgui9vVxuICB0b0RldihldmVudDogdmFudEV2ZW50PFVhcnQuVGVybWluYWw+KSB7XG4gICAgY29uc3QgeyBEZXZNYWMgfSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pdGVtXG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6ICcvcGFnZXMvaW5kZXgvZHR1L2R0dScgKyBPYmplY3RUb1N0cnF1ZXJ5KHsgbWFjOiBEZXZNYWMgfSlcbiAgICB9KVxuICB9LFxuXG4gIC8vIOafpeeci+iuvuWkh+aVsOaNrlxuICBzaG93TW91bnREZXZEYXRhKGV2ZW50OiB2YW50RXZlbnQ8VWFydC5UZXJtaW5hbE1vdW50RGV2cyAmIHsgZHR1OiBzdHJpbmcgfT4pIHtcbiAgICBjb25zdCB7IHBpZCwgbW91bnREZXYsIHByb3RvY29sLCBkdHUsIFR5cGUgfSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pdGVtXG4gICAgY29uc3QgeyBEZXZNYWMgfSA9IHRoaXMuZGF0YS5EVFVzLmZpbmQoZWwgPT4gZWwubmFtZSA9PT0gZHR1KSFcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy9wYWdlcy9pbmRleC9kZXZzL2RldnMnICsgT2JqZWN0VG9TdHJxdWVyeSh7IHBpZDogU3RyaW5nKHBpZCksIG1vdW50RGV2LCBwcm90b2NvbCwgRGV2TWFjLCBUeXBlIH0pXG4gICAgfSlcbiAgfSxcbiAgLy8g5p+l55yL5ZGK6K2mXG4gIHNlZUFsYXJtKCkge1xuICAgIHd4LnN3aXRjaFRhYih7IHVybDogJy9wYWdlcy9pbmRleC9hbGFybS9hbGFybScgfSlcbiAgfSxcbiAgLy8g57uf6K6h5omA5pyJ6K6+5aSH54q25oCBXG4gIGNvdW50RGV2KHRlcm1pbmFsczogVWFydC5UZXJtaW5hbFtdKSB7XG5cbiAgICBjb25zdCB0ZXJtaW5hbF9hbGwgPSB0ZXJtaW5hbHMubGVuZ3RoXG4gICAgY29uc3QgdGVybWluYWxfb24gPSB0ZXJtaW5hbHMubWFwKGVsID0+IGVsLm9ubGluZSkuZmlsdGVyKGVsID0+IGVsKS5sZW5ndGhcbiAgICBjb25zdCBtb251dERldl9hbGwgPSB0ZXJtaW5hbHMubWFwKGVsID0+IGVsLm1vdW50RGV2cy5sZW5ndGgpLnJlZHVjZSgocHJlLCBjdXIpID0+IHByZSArIGN1cilcbiAgICBjb25zdCBtb3VudERldl9vbiA9IHRlcm1pbmFscy5tYXAoZWwgPT4gZWwubW91bnREZXZzLmZpbHRlcihlbDIgPT4gZWwyLm9ubGluZSkpLnJlZHVjZSgocHJlLCBjdXIpID0+IFsuLi5wcmUsIC4uLmN1cl0pLmxlbmd0aFxuICAgIC8vIGNvbnNvbGUubG9nKHsgdGVybWluYWxfYWxsLCB0ZXJtaW5hbF9vbiwgbW9udXREZXZfYWxsLCBtb3VudERldl9vbiB9KTtcbiAgICBjb25zdCBzdGF0ZSA9IGBEVFU6KOWFqOmDqCR7dGVybWluYWxfYWxsfS/lnKjnur8ke3Rlcm1pbmFsX29ufSks5oyC6L296K6+5aSHOijlhajpg6gke21vbnV0RGV2X2FsbH0v5Zyo57q/JHttb3VudERldl9vbn0pYFxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzdGF0ZVxuICAgIH0pXG4gIH0sXG4gIC8vbWFjPTk4RDg2M0NDODcwRCZwaWQ9MCZtb3VudERldj1HMktcbiAgYXN5bmMgb25QdWxsRG93blJlZnJlc2goKSB7XG4gICAgYXdhaXQgdGhpcy5iaW5kRGV2KClcbiAgICB0aGlzLmNvdW50RGV2KHRoaXMuZGF0YS5EVFVzKVxuICAgIHRoaXMuc3RhcnQoKVxuICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goKVxuICB9LFxuICAvL1xuICBiaW5kbG9hZChldmVudDogdmFudEV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coYOWFrOS8l+WPt+WKoOi9vXN1Y2Nlc3Ms54q25oCBOiR7ZXZlbnQuZGV0YWlsLmVyck1zZ31gKTtcbiAgfSxcbiAgYmluZGVycm9yKGV2ZW50OiB2YW50RXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhg5YWs5LyX5Y+35Yqg6L29ZXJyb3Is54q25oCBOiR7ZXZlbnQuZGV0YWlsLmVyck1zZ31gKTtcbiAgfSxcblxuICB0cmlhbCgpe1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICdsb2dpbicgfSlcbiAgICB3eC5sb2dpbih7XG4gICAgICBzdWNjZXNzOiBhc3luYyBsb2dpbiA9PiB7XG4gICAgICAgIC8vIOWPkemAgee9kee7nOivt+axgu+8jOiOt+WPluWcqOe6v+i0puaIt1xuICAgICAgICBjb25zdCB7IGNvZGUgfSA9IGF3YWl0IGFwaS50cmlhbCh7IGpzX2NvZGU6IGxvZ2luLmNvZGV9KVxuICAgICAgICBpZiAoY29kZSkge1xuICAgICAgICAgIHRoaXMuc3RhcnQoKVxuICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICAvLyDmt7vliqDomZrmi5/orr7lpIdcbiAgLyogYXN5bmMgYWRkVm0oKSB7XG4gICAgY29uc3QgeyBvaywgYXJnIH0gPSBhd2FpdCBhcGkuYWRkVm0oKVxuICAgIGlmIChvaykge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgVm06IGFyZ1xuICAgICAgfSlcbiAgICAgIHRoaXMuc29ydERldnMoYXJnKVxuICAgIH1cbiAgfSwgXG4gICBvblNob3coKSB7XG4gICAgaWYgKHRoaXMuZGF0YS5yZWFkeSkge1xuICAgICAgdGhpcy5iaW5kRGV2KClcbiAgICB9XG4gIH0gKi9cbn0pXG4iXX0=