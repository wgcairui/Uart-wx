"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const api_1 = require("../../../utils/api");
Page({
    data: {
        tel: '',
        sms: '',
        senddisable: false,
        sendtext: '发送验证码'
    },
    onLoad: function () {
        this.getTel();
    },
    async getTel() {
        wx.showLoading({ title: '获取用户手机号码' });
        const { arg } = await api_1.default.getUserTel();
        wx.hideLoading();
        this.setData({
            tel: arg
        });
    },
    async sendValidation() {
        wx.showLoading({ title: '正在发送' });
        const { ok, msg } = await api_1.default.sendValidation();
        wx.hideLoading();
        if (!ok)
            wx.showModal({ title: '发送失败', content: msg });
        this.setData({
            senddisable: true,
            sendtext: '60秒后再试'
        });
        setTimeout(() => {
            this.setData({
                senddisable: false,
                sendtext: '发送验证码'
            });
        }, 1000 * 60);
    },
    checkSms(_event) {
        if (this.data.sms.length > 3) {
            api_1.default.ValidationCode(Number(this.data.sms)).then(el => {
                if (el.ok) {
                    const event = this.getOpenerEventChannel();
                    event.emit("validationSuccess", { code: this.data.sms });
                    wx.navigateBack();
                }
                else {
                    wx.showModal({
                        title: '检验失败',
                        content: el.msg
                    });
                }
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21zVmFsaWRhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNtc1ZhbGlkYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBb0M7QUFHcEMsSUFBSSxDQUFDO0lBS0gsSUFBSSxFQUFFO1FBQ0osR0FBRyxFQUFFLEVBQUU7UUFDUCxHQUFHLEVBQUUsRUFBRTtRQUNQLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLFFBQVEsRUFBRSxPQUFPO0tBQ2xCO0lBS0QsTUFBTSxFQUFFO1FBQ04sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFBO0lBQ2YsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNO1FBQ1YsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFBO1FBQ3JDLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQTtRQUN0QyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLEdBQUcsRUFBRSxHQUFHO1NBQ1QsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxjQUFjO1FBQ2xCLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUNqQyxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLE1BQU0sYUFBRyxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBQzlDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUNoQixJQUFJLENBQUMsRUFBRTtZQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFBO1FBQ3RELElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxXQUFXLEVBQUUsSUFBSTtZQUNqQixRQUFRLEVBQUUsUUFBUTtTQUNuQixDQUFDLENBQUE7UUFDRixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxXQUFXLEVBQUUsS0FBSztnQkFDbEIsUUFBUSxFQUFFLE9BQU87YUFDbEIsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxFQUFFLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQTtJQUNmLENBQUM7SUFFRCxRQUFRLENBQUMsTUFBaUI7UUFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzVCLGFBQUcsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ2xELElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRTtvQkFDVCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQTtvQkFDMUMsS0FBSyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUE7b0JBQ3hELEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtpQkFDbEI7cUJBQU07b0JBQ0wsRUFBRSxDQUFDLFNBQVMsQ0FBQzt3QkFDWCxLQUFLLEVBQUUsTUFBTTt3QkFDYixPQUFPLEVBQUUsRUFBRSxDQUFDLEdBQUc7cUJBQ2hCLENBQUMsQ0FBQTtpQkFDSDtZQUNILENBQUMsQ0FBQyxDQUFBO1NBQ0g7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFwaSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvYXBpXCJcblxuLy8gbWluaXByb2dyYW0vcGFnZXMvdXRpbC9zbXNWYWxpZGF0aW9uL3Ntc1ZhbGlkYXRpb24uanNcblBhZ2Uoe1xuXG4gIC8qKlxuICAgKiDpobXpnaLnmoTliJ3lp4vmlbDmja5cbiAgICovXG4gIGRhdGE6IHtcbiAgICB0ZWw6ICcnLFxuICAgIHNtczogJycsXG4gICAgc2VuZGRpc2FibGU6IGZhbHNlLFxuICAgIHNlbmR0ZXh0OiAn5Y+R6YCB6aqM6K+B56CBJ1xuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nZXRUZWwoKVxuICB9LFxuICAvLyDojrflj5bnlKjmiLfmiYvmnLrlj7fnoIFcbiAgYXN5bmMgZ2V0VGVsKCkge1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfojrflj5bnlKjmiLfmiYvmnLrlj7fnoIEnIH0pXG4gICAgY29uc3QgeyBhcmcgfSA9IGF3YWl0IGFwaS5nZXRVc2VyVGVsKClcbiAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHRlbDogYXJnXG4gICAgfSlcbiAgfSxcbiAgLy8g5Y+R6YCB55+t5L+h6aqM6K+B56CBXG4gIGFzeW5jIHNlbmRWYWxpZGF0aW9uKCkge1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfmraPlnKjlj5HpgIEnIH0pXG4gICAgY29uc3QgeyBvaywgbXNnIH0gPSBhd2FpdCBhcGkuc2VuZFZhbGlkYXRpb24oKVxuICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICBpZiAoIW9rKSB3eC5zaG93TW9kYWwoeyB0aXRsZTogJ+WPkemAgeWksei0pScsIGNvbnRlbnQ6IG1zZyB9KVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzZW5kZGlzYWJsZTogdHJ1ZSxcbiAgICAgIHNlbmR0ZXh0OiAnNjDnp5LlkI7lho3or5UnXG4gICAgfSlcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHNlbmRkaXNhYmxlOiBmYWxzZSxcbiAgICAgICAgc2VuZHRleHQ6ICflj5HpgIHpqozor4HnoIEnXG4gICAgICB9KVxuICAgIH0sIDEwMDAgKiA2MClcbiAgfSxcbiAgLy8g5qOA5p+l6aqM6K+B56CB77yM5aaC5p6c5pivNOS9jeWImeS4iuS8oOmqjOivgVxuICBjaGVja1NtcyhfZXZlbnQ6IHZhbnRFdmVudCkge1xuICAgIGlmICh0aGlzLmRhdGEuc21zLmxlbmd0aCA+IDMpIHtcbiAgICAgIGFwaS5WYWxpZGF0aW9uQ29kZShOdW1iZXIodGhpcy5kYXRhLnNtcykpLnRoZW4oZWwgPT4ge1xuICAgICAgICBpZiAoZWwub2spIHtcbiAgICAgICAgICBjb25zdCBldmVudCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKClcbiAgICAgICAgICBldmVudC5lbWl0KFwidmFsaWRhdGlvblN1Y2Nlc3NcIiwgeyBjb2RlOiB0aGlzLmRhdGEuc21zIH0pXG4gICAgICAgICAgd3gubmF2aWdhdGVCYWNrKClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6ICfmo4DpqozlpLHotKUnLFxuICAgICAgICAgICAgY29udGVudDogZWwubXNnXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pIl19