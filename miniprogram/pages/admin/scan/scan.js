"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../../../utils/util");
const api_1 = require("../../../utils/api");
Page({
    data: {
        mac: '',
        macs: [],
        terminal: {
            name: '',
            mountNode: '',
            mountDevs: [],
            uptime: ''
        },
        remoteUrl: '',
        uarts: ['2400,8,1,NONE,NFC', '4800,8,1,NONE,HD', '9600,8,1,NONE,HD', '19200,8,1,NONE,HD', '115200,8,1,NONE,HD'],
        qrReady: false
    },
    onLoad() {
        wx.getStorage({
            key: "macHis",
            success: (res) => {
                console.log(res.data);
                this.setData({
                    macs: res.data
                });
            }
        });
    },
    async scanMac() {
        const scanResult = await wx.scanCode({});
        this.setData({
            mac: scanResult.result
        });
        this.scanRequst();
    },
    async scanRequst() {
        wx.showLoading({ title: '查询中' });
        const { code, data } = await api_1.default.getRootTerminal(this.data.mac);
        wx.hideLoading();
        if (code && data) {
            this.setData({
                mac: data.DevMac,
                terminal: data
            });
            this.addHis(data.DevMac);
            api_1.default.onMessage('MacUpdate' + data.DevMac, () => {
                console.log(`listen MacUpdate,mac:${data.DevMac}`);
                this.scanMac();
            });
        }
        else {
            wx.showModal({
                title: 'search',
                content: '此设备没有注册，请核对设备是否在我司渠道购买'
            });
        }
    },
    search(e) {
        this.setData({
            mac: e.target.id
        });
        this.scanRequst();
    },
    addHis(mac) {
        if (this.data.macs.length > 5) {
            this.data.macs.pop();
        }
        const macSet = new Set(this.data.macs);
        macSet.add(mac);
        this.setData({
            macs: [...macSet]
        });
        wx.setStorage({
            key: 'macHis',
            data: [...macSet]
        });
    },
    async initTerminal() {
        const { confirm } = await wx.showModal({
            title: '初始化' + this.data.terminal.name,
            content: '初始化操作不可逆,会清除dtu绑定的设备信息,告警信息,且只能清除未被绑定的dtu!!!'
        });
        if (confirm) {
            wx.showLoading({ title: 'loading' });
            const { code, data, msg } = await api_1.default.initTerminal(this.data.terminal.DevMac);
            if (code) {
                wx.showModal({
                    title: 'success',
                    content: `耗时${data}ms`
                });
                this.scanRequst();
            }
            else {
                wx.showModal({
                    title: 'error',
                    content: msg
                });
            }
        }
    },
    async modifyUart() {
        const d = await wx.showActionSheet({
            itemList: this.data.uarts
        });
        if (this.data.terminal.DevMac && d.errMsg === 'showActionSheet:ok') {
            const uart = `+++AT+UART=1,` + this.data.uarts[d.tapIndex];
            wx.showLoading({ title: '正在修改' });
            const { code, data } = await api_1.default.sendATInstruct(this.data.terminal.DevMac, uart);
            wx.hideLoading();
            if (code && data.ok) {
                wx.showToast({
                    title: 'success',
                    content: data.msg
                });
                this.setData({
                    "terminal.uart": this.data.uarts[d.tapIndex]
                });
            }
            else {
                wx.showModal({
                    title: '操作失败',
                    content: data.msg
                });
            }
        }
    },
    async resetDtu() {
        wx.showModal({
            title: "重启Dtu",
            content: "确定现在重启Dtu吗?",
            success: async () => {
                const uart = `+++AT+Z`;
                wx.showLoading({ title: '正在修改' });
                const { code, data } = await api_1.default.sendATInstruct(this.data.terminal.DevMac, uart);
                wx.hideLoading();
                if (code) {
                    wx.showToast({
                        title: 'success',
                        content: data.msg
                    });
                }
            }
        });
    },
    async bindDevId() {
        const scanResult = await wx.scanCode({});
        wx.showLoading({ title: 'loading' });
        const t = await api_1.default.getTerminal(scanResult.result);
        if (t.data) {
            wx.hideLoading();
            wx.showModal({
                title: 'error',
                content: `${scanResult.result}已被dtu:${t.data.DevMac} 绑定`
            });
            return;
        }
        const { data } = await api_1.default.getRegisterDev(scanResult.result);
        wx.hideLoading();
        if (data) {
            const { confirm } = await wx.showModal({
                title: '确认绑定信息',
                content: `类型:${data.Type}\n 设备:${data.mountDev}\n 协议:${data.protocol}\n 地址:${data.pid}`
            });
            if (confirm) {
                wx.showLoading({ title: '正在绑定设备' });
                const r = await api_1.default.addTerminalMountDev(this.data.terminal.DevMac, { mountDev: data.mountDev, Type: data.Type, protocol: data.protocol, pid: data.pid, bindDev: scanResult.result });
                wx.hideLoading();
                if (r.code) {
                    wx.showToast({
                        title: '设备绑定成功'
                    });
                    this.scanRequst();
                }
            }
        }
        else {
            wx.showModal({
                title: '流程出错',
                content: `${scanResult.result}未注册,请先注册后绑定`
            });
        }
    },
    see(event) {
        const { pid, mountDev, protocol, Type } = event.currentTarget.dataset.item;
        wx.navigateTo({
            url: '/pages/admin/devs/devs' + (0, util_1.ObjectToStrquery)({ pid: String(pid), mountDev, protocol, DevMac: this.data.terminal.DevMac, Type })
        });
    },
    async rmBind(e) {
        const item = e.currentTarget.dataset.item;
        const { confirm } = await wx.showModal({
            title: '删除绑定设备',
            content: `确定删除 ${item.mountDev} ???`
        });
        if (confirm) {
            api_1.default.delTerminalMountDev(this.data.terminal.DevMac, item.pid).then(() => {
                this.scanRequst();
            });
        }
    },
    async iotRemoteUrl() {
        const { code, data } = await api_1.default.iotRemoteUrl(this.data.mac);
        if (!code) {
            wx.showModal({
                title: '获取失败',
                content: '设备未绑定到IOT账号'
            });
        }
        else {
            if (!/remote_code=$/.test(data)) {
                wx.showModal({
                    title: '调试地址',
                    content: data,
                    success() {
                        wx.setClipboardData({
                            data,
                            success() {
                                wx.showToast({
                                    title: '已复制网址到剪切板'
                                });
                            }
                        });
                    }
                });
            }
            else {
                wx.showModal({
                    title: '获取失败',
                    content: '设备未连接到iot server中心'
                });
            }
        }
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nhbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjYW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw4Q0FBc0Q7QUFDdEQsNENBQW9DO0FBQ3BDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLEdBQUcsRUFBRSxFQUFFO1FBQ1AsSUFBSSxFQUFFLEVBQWM7UUFDcEIsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLEVBQUU7WUFDUixTQUFTLEVBQUUsRUFBRTtZQUNiLFNBQVMsRUFBRSxFQUE4QjtZQUN6QyxNQUFNLEVBQUUsRUFBRTtTQUNNO1FBQ2xCLFNBQVMsRUFBRSxFQUFFO1FBQ2IsS0FBSyxFQUFFLENBQUMsbUJBQW1CLEVBQUUsa0JBQWtCLEVBQUUsa0JBQWtCLEVBQUUsbUJBQW1CLEVBQUUsb0JBQW9CLENBQUM7UUFDL0csT0FBTyxFQUFFLEtBQUs7S0FDZjtJQUVELE1BQU07UUFDSixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLFFBQVE7WUFDYixPQUFPLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDZixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztvQkFDWCxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUk7aUJBQ2YsQ0FBQyxDQUFBO1lBQ0osQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTztRQUNYLE1BQU0sVUFBVSxHQUFHLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN4QyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsR0FBRyxFQUFFLFVBQVUsQ0FBQyxNQUFNO1NBQ3ZCLENBQUMsQ0FBQTtRQUNGLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUNuQixDQUFDO0lBRUQsS0FBSyxDQUFDLFVBQVU7UUFDZCxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7UUFDaEMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvRCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDaEIsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1gsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNO2dCQUNoQixRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQTtZQUNGLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBQ3hCLGFBQUcsQ0FBQyxTQUFTLENBQVMsV0FBVyxHQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFO2dCQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDbkQsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO1lBQ2hCLENBQUMsQ0FBQyxDQUFBO1NBQ0g7YUFBTTtZQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsT0FBTyxFQUFFLHdCQUF3QjthQUNsQyxDQUFDLENBQUE7U0FDSDtJQUNILENBQUM7SUFNRCxNQUFNLENBQUMsQ0FBVztRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsR0FBRyxFQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRTtTQUNoQixDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7SUFDbkIsQ0FBQztJQU1ELE1BQU0sQ0FBQyxHQUFXO1FBQ2hCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUM3QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQTtTQUNyQjtRQUNELE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNmLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxJQUFJLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQztTQUNsQixDQUFDLENBQUE7UUFDRixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLFFBQVE7WUFDYixJQUFJLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQztTQUNsQixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsS0FBSyxDQUFDLFlBQVk7UUFDaEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNyQyxLQUFLLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7WUFDdEMsT0FBTyxFQUFFLDhDQUE4QztTQUN4RCxDQUFDLENBQUE7UUFDRixJQUFJLE9BQU8sRUFBRTtZQUNYLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQTtZQUNwQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDN0UsSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsU0FBUztvQkFDaEIsT0FBTyxFQUFFLEtBQUssSUFBSSxJQUFJO2lCQUN2QixDQUFDLENBQUE7Z0JBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO2FBQ2xCO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1gsS0FBSyxFQUFFLE9BQU87b0JBQ2QsT0FBTyxFQUFFLEdBQUc7aUJBQ2IsQ0FBQyxDQUFBO2FBQ0g7U0FDRjtJQUNILENBQUM7SUFLRCxLQUFLLENBQUMsVUFBVTtRQUNkLE1BQU0sQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLGVBQWUsQ0FBQztZQUNqQyxRQUFRLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO1NBQzFCLENBQUMsQ0FBQTtRQUNGLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssb0JBQW9CLEVBQUU7WUFDbEUsTUFBTSxJQUFJLEdBQUcsZUFBZSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUMxRCxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUE7WUFDakMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGFBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFBO1lBQ2hGLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNuQixFQUFFLENBQUMsU0FBUyxDQUFDO29CQUNYLEtBQUssRUFBRSxTQUFTO29CQUNoQixPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUc7aUJBQ2xCLENBQUMsQ0FBQTtnQkFDRixJQUFJLENBQUMsT0FBTyxDQUFDO29CQUNYLGVBQWUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO2lCQUM3QyxDQUFDLENBQUE7YUFDSDtpQkFBTTtnQkFDTCxFQUFFLENBQUMsU0FBUyxDQUFDO29CQUNYLEtBQUssRUFBRSxNQUFNO29CQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsR0FBRztpQkFDbEIsQ0FBQyxDQUFBO2FBQ0g7U0FDRjtJQUVILENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUTtRQUNaLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDWCxLQUFLLEVBQUUsT0FBTztZQUNkLE9BQU8sRUFBRSxhQUFhO1lBQ3RCLE9BQU8sRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDbEIsTUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFBO2dCQUN0QixFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUE7Z0JBQ2pDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxhQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQTtnQkFDaEYsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO2dCQUNoQixJQUFJLElBQUksRUFBRTtvQkFDUixFQUFFLENBQUMsU0FBUyxDQUFDO3dCQUNYLEtBQUssRUFBRSxTQUFTO3dCQUNoQixPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUc7cUJBQ2xCLENBQUMsQ0FBQTtpQkFDSDtZQUNILENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBSUQsS0FBSyxDQUFDLFNBQVM7UUFDYixNQUFNLFVBQVUsR0FBRyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDeEMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFBO1FBQ3BDLE1BQU0sQ0FBQyxHQUFHLE1BQU0sYUFBRyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDbEQsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFO1lBQ1YsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBQ2hCLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLE1BQU0sU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSzthQUN6RCxDQUFDLENBQUE7WUFDRixPQUFNO1NBQ1A7UUFDRCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxhQUFHLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUM1RCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDaEIsSUFBSSxJQUFJLEVBQUU7WUFDUixNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNyQyxLQUFLLEVBQUUsUUFBUTtnQkFDZixPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUMsSUFBSSxTQUFTLElBQUksQ0FBQyxRQUFRLFNBQVMsSUFBSSxDQUFDLFFBQVEsU0FBUyxJQUFJLENBQUMsR0FBRyxFQUFFO2FBQ3hGLENBQUMsQ0FBQTtZQUNGLElBQUksT0FBTyxFQUFFO2dCQUNYLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQTtnQkFDbkMsTUFBTSxDQUFDLEdBQUcsTUFBTSxhQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO2dCQUNwTCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7Z0JBQ2hCLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtvQkFDVixFQUFFLENBQUMsU0FBUyxDQUFDO3dCQUNYLEtBQUssRUFBRSxRQUFRO3FCQUNoQixDQUFDLENBQUE7b0JBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO2lCQUNsQjthQUNGO1NBQ0Y7YUFBTTtZQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLE1BQU07Z0JBQ2IsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLE1BQU0sYUFBYTthQUMzQyxDQUFDLENBQUE7U0FDSDtJQUVILENBQUM7SUFHRCxHQUFHLENBQUMsS0FBd0M7UUFDMUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQTtRQUMxRSxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLHdCQUF3QixHQUFHLElBQUEsdUJBQWdCLEVBQUMsRUFBRSxHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUNwSSxDQUFDLENBQUE7SUFDSixDQUFDO0lBR0QsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUE4QjtRQUN6QyxNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUE7UUFDekMsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNyQyxLQUFLLEVBQUUsUUFBUTtZQUNmLE9BQU8sRUFBRSxRQUFRLElBQUksQ0FBQyxRQUFRLE1BQU07U0FDckMsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxPQUFPLEVBQUU7WUFDWCxhQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO2dCQUNyRSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7WUFDbkIsQ0FBQyxDQUFDLENBQUE7U0FDSDtJQUdILENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNoQixNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sYUFBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQzVELElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNYLEtBQUssRUFBRSxNQUFNO2dCQUNiLE9BQU8sRUFBRSxhQUFhO2FBQ3ZCLENBQUMsQ0FBQTtTQUNIO2FBQU07WUFDTCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDL0IsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsTUFBTTtvQkFDYixPQUFPLEVBQUUsSUFBSTtvQkFDYixPQUFPO3dCQUNMLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQzs0QkFDbEIsSUFBSTs0QkFDSixPQUFPO2dDQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0NBQ1gsS0FBSyxFQUFFLFdBQVc7aUNBQ25CLENBQUMsQ0FBQTs0QkFDSixDQUFDO3lCQUNGLENBQUMsQ0FBQTtvQkFDSixDQUFDO2lCQUNGLENBQUMsQ0FBQTthQUNIO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1gsS0FBSyxFQUFFLE1BQU07b0JBQ2IsT0FBTyxFQUFFLG9CQUFvQjtpQkFDOUIsQ0FBQyxDQUFBO2FBQ0g7U0FDRjtJQUNILENBQUM7Q0FzSkYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JqZWN0VG9TdHJxdWVyeSB9IGZyb20gXCIuLi8uLi8uLi91dGlscy91dGlsXCJcbmltcG9ydCBhcGkgZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2FwaVwiXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIG1hYzogJycsXG4gICAgbWFjczogW10gYXMgc3RyaW5nW10sXG4gICAgdGVybWluYWw6IHtcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgbW91bnROb2RlOiAnJyxcbiAgICAgIG1vdW50RGV2czogW10gYXMgVWFydC5UZXJtaW5hbE1vdW50RGV2c1tdLFxuICAgICAgdXB0aW1lOiAnJ1xuICAgIH0gYXMgVWFydC5UZXJtaW5hbCxcbiAgICByZW1vdGVVcmw6ICcnLFxuICAgIHVhcnRzOiBbJzI0MDAsOCwxLE5PTkUsTkZDJywgJzQ4MDAsOCwxLE5PTkUsSEQnLCAnOTYwMCw4LDEsTk9ORSxIRCcsICcxOTIwMCw4LDEsTk9ORSxIRCcsICcxMTUyMDAsOCwxLE5PTkUsSEQnXSxcbiAgICBxclJlYWR5OiBmYWxzZVxuICB9LFxuXG4gIG9uTG9hZCgpIHtcbiAgICB3eC5nZXRTdG9yYWdlKHtcbiAgICAgIGtleTogXCJtYWNIaXNcIixcbiAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIG1hY3M6IHJlcy5kYXRhXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgLy8g6LCD55So5b6u5L+hYXBp77yM5omr5o+PRFRV5p2h5b2i56CBXG4gIGFzeW5jIHNjYW5NYWMoKSB7XG4gICAgY29uc3Qgc2NhblJlc3VsdCA9IGF3YWl0IHd4LnNjYW5Db2RlKHt9KVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBtYWM6IHNjYW5SZXN1bHQucmVzdWx0XG4gICAgfSlcbiAgICB0aGlzLnNjYW5SZXF1c3QoKVxuICB9LFxuICAvLyDmn6Xor6JEVFXorr7lpIfkv6Hmga9cbiAgYXN5bmMgc2NhblJlcXVzdCgpIHtcbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5p+l6K+i5LitJyB9KVxuICAgIGNvbnN0IHsgY29kZSwgZGF0YSB9ID0gYXdhaXQgYXBpLmdldFJvb3RUZXJtaW5hbCh0aGlzLmRhdGEubWFjKVxuICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICBpZiAoY29kZSAmJiBkYXRhKSB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBtYWM6IGRhdGEuRGV2TWFjLFxuICAgICAgICB0ZXJtaW5hbDogZGF0YVxuICAgICAgfSlcbiAgICAgIHRoaXMuYWRkSGlzKGRhdGEuRGV2TWFjKVxuICAgICAgYXBpLm9uTWVzc2FnZTxzdHJpbmc+KCdNYWNVcGRhdGUnK2RhdGEuRGV2TWFjLCAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBsaXN0ZW4gTWFjVXBkYXRlLG1hYzoke2RhdGEuRGV2TWFjfWApO1xuICAgICAgICB0aGlzLnNjYW5NYWMoKVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6ICdzZWFyY2gnLFxuICAgICAgICBjb250ZW50OiAn5q2k6K6+5aSH5rKh5pyJ5rOo5YaM77yM6K+35qC45a+56K6+5aSH5piv5ZCm5Zyo5oiR5Y+45rig6YGT6LSt5LmwJ1xuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeCueWHu+WOhuWPsuiusOW9leafpeivolxuICAgKiBAcGFyYW0gZSBcbiAgICovXG4gIHNlYXJjaChlOnZhbnRFdmVudCl7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG1hYzplLnRhcmdldC5pZFxuICAgIH0pXG4gICAgdGhpcy5zY2FuUmVxdXN0KClcbiAgfSxcblxuICAvKipcbiAgICog5re75Yqg5Y6G5Y+y6K6w5b2VXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqL1xuICBhZGRIaXMobWFjOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5kYXRhLm1hY3MubGVuZ3RoID4gNSkge1xuICAgICAgdGhpcy5kYXRhLm1hY3MucG9wKClcbiAgICB9XG4gICAgY29uc3QgbWFjU2V0ID0gbmV3IFNldCh0aGlzLmRhdGEubWFjcylcbiAgICBtYWNTZXQuYWRkKG1hYylcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgbWFjczogWy4uLm1hY1NldF1cbiAgICB9KVxuICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAga2V5OiAnbWFjSGlzJyxcbiAgICAgIGRhdGE6IFsuLi5tYWNTZXRdXG4gICAgfSlcbiAgfSxcblxuICBhc3luYyBpbml0VGVybWluYWwoKSB7XG4gICAgY29uc3QgeyBjb25maXJtIH0gPSBhd2FpdCB3eC5zaG93TW9kYWwoe1xuICAgICAgdGl0bGU6ICfliJ3lp4vljJYnICsgdGhpcy5kYXRhLnRlcm1pbmFsLm5hbWUsXG4gICAgICBjb250ZW50OiAn5Yid5aeL5YyW5pON5L2c5LiN5Y+v6YCGLOS8mua4hemZpGR0dee7keWumueahOiuvuWkh+S/oeaBryzlkYrorabkv6Hmga8s5LiU5Y+q6IO95riF6Zmk5pyq6KKr57uR5a6a55qEZHR1ISEhJ1xuICAgIH0pXG4gICAgaWYgKGNvbmZpcm0pIHtcbiAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICdsb2FkaW5nJyB9KVxuICAgICAgY29uc3QgeyBjb2RlLCBkYXRhLCBtc2cgfSA9IGF3YWl0IGFwaS5pbml0VGVybWluYWwodGhpcy5kYXRhLnRlcm1pbmFsLkRldk1hYylcbiAgICAgIGlmIChjb2RlKSB7XG4gICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgdGl0bGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBjb250ZW50OiBg6ICX5pe2JHtkYXRhfW1zYFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNjYW5SZXF1c3QoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ2Vycm9yJyxcbiAgICAgICAgICBjb250ZW50OiBtc2dcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOS/ruaUueazoueJueeOh1xuICAgKi9cbiAgYXN5bmMgbW9kaWZ5VWFydCgpIHtcbiAgICBjb25zdCBkID0gYXdhaXQgd3guc2hvd0FjdGlvblNoZWV0KHtcbiAgICAgIGl0ZW1MaXN0OiB0aGlzLmRhdGEudWFydHNcbiAgICB9KVxuICAgIGlmICh0aGlzLmRhdGEudGVybWluYWwuRGV2TWFjICYmIGQuZXJyTXNnID09PSAnc2hvd0FjdGlvblNoZWV0Om9rJykge1xuICAgICAgY29uc3QgdWFydCA9IGArKytBVCtVQVJUPTEsYCArIHRoaXMuZGF0YS51YXJ0c1tkLnRhcEluZGV4XVxuICAgICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+ato+WcqOS/ruaUuScgfSlcbiAgICAgIGNvbnN0IHsgY29kZSwgZGF0YSB9ID0gYXdhaXQgYXBpLnNlbmRBVEluc3RydWN0KHRoaXMuZGF0YS50ZXJtaW5hbC5EZXZNYWMsIHVhcnQpXG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICBpZiAoY29kZSAmJiBkYXRhLm9rKSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBjb250ZW50OiBkYXRhLm1zZ1xuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIFwidGVybWluYWwudWFydFwiOiB0aGlzLmRhdGEudWFydHNbZC50YXBJbmRleF1cbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgdGl0bGU6ICfmk43kvZzlpLHotKUnLFxuICAgICAgICAgIGNvbnRlbnQ6IGRhdGEubXNnXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuXG4gIH0sXG5cbiAgYXN5bmMgcmVzZXREdHUoKSB7XG4gICAgd3guc2hvd01vZGFsKHtcbiAgICAgIHRpdGxlOiBcIumHjeWQr0R0dVwiLFxuICAgICAgY29udGVudDogXCLnoa7lrprnjrDlnKjph43lkK9EdHXlkJc/XCIsXG4gICAgICBzdWNjZXNzOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVhcnQgPSBgKysrQVQrWmBcbiAgICAgICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+ato+WcqOS/ruaUuScgfSlcbiAgICAgICAgY29uc3QgeyBjb2RlLCBkYXRhIH0gPSBhd2FpdCBhcGkuc2VuZEFUSW5zdHJ1Y3QodGhpcy5kYXRhLnRlcm1pbmFsLkRldk1hYywgdWFydClcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICBpZiAoY29kZSkge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgY29udGVudDogZGF0YS5tc2dcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgLyoqXG4gICAqIOe7keWumuiuvuWkh2lkXG4gICAqL1xuICBhc3luYyBiaW5kRGV2SWQoKSB7XG4gICAgY29uc3Qgc2NhblJlc3VsdCA9IGF3YWl0IHd4LnNjYW5Db2RlKHt9KVxuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICdsb2FkaW5nJyB9KVxuICAgIGNvbnN0IHQgPSBhd2FpdCBhcGkuZ2V0VGVybWluYWwoc2NhblJlc3VsdC5yZXN1bHQpXG4gICAgaWYgKHQuZGF0YSkge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6ICdlcnJvcicsXG4gICAgICAgIGNvbnRlbnQ6IGAke3NjYW5SZXN1bHQucmVzdWx0feW3suiiq2R0dToke3QuZGF0YS5EZXZNYWN9IOe7keWummBcbiAgICAgIH0pXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcGkuZ2V0UmVnaXN0ZXJEZXYoc2NhblJlc3VsdC5yZXN1bHQpXG4gICAgd3guaGlkZUxvYWRpbmcoKVxuICAgIGlmIChkYXRhKSB7XG4gICAgICBjb25zdCB7IGNvbmZpcm0gfSA9IGF3YWl0IHd4LnNob3dNb2RhbCh7XG4gICAgICAgIHRpdGxlOiAn56Gu6K6k57uR5a6a5L+h5oGvJyxcbiAgICAgICAgY29udGVudDogYOexu+Weizoke2RhdGEuVHlwZX1cXG4g6K6+5aSHOiR7ZGF0YS5tb3VudERldn1cXG4g5Y2P6K6uOiR7ZGF0YS5wcm90b2NvbH1cXG4g5Zyw5Z2AOiR7ZGF0YS5waWR9YFxuICAgICAgfSlcbiAgICAgIGlmIChjb25maXJtKSB7XG4gICAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfmraPlnKjnu5Hlrprorr7lpIcnIH0pXG4gICAgICAgIGNvbnN0IHIgPSBhd2FpdCBhcGkuYWRkVGVybWluYWxNb3VudERldih0aGlzLmRhdGEudGVybWluYWwuRGV2TWFjLCB7IG1vdW50RGV2OiBkYXRhLm1vdW50RGV2LCBUeXBlOiBkYXRhLlR5cGUsIHByb3RvY29sOiBkYXRhLnByb3RvY29sLCBwaWQ6IGRhdGEucGlkLCBiaW5kRGV2OiBzY2FuUmVzdWx0LnJlc3VsdCB9KVxuICAgICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICAgIGlmIChyLmNvZGUpIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICforr7lpIfnu5HlrprmiJDlip8nXG4gICAgICAgICAgfSlcbiAgICAgICAgICB0aGlzLnNjYW5SZXF1c3QoKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIHRpdGxlOiAn5rWB56iL5Ye66ZSZJyxcbiAgICAgICAgY29udGVudDogYCR7c2NhblJlc3VsdC5yZXN1bHR95pyq5rOo5YaMLOivt+WFiOazqOWGjOWQjue7keWummBcbiAgICAgIH0pXG4gICAgfVxuXG4gIH0sXG5cbiAgLy8g5p+l55yL6K6+5aSH5pWw5o2uXG4gIHNlZShldmVudDogdmFudEV2ZW50PFVhcnQuVGVybWluYWxNb3VudERldnM+KSB7XG4gICAgY29uc3QgeyBwaWQsIG1vdW50RGV2LCBwcm90b2NvbCwgVHlwZSB9ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW1cbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy9wYWdlcy9hZG1pbi9kZXZzL2RldnMnICsgT2JqZWN0VG9TdHJxdWVyeSh7IHBpZDogU3RyaW5nKHBpZCksIG1vdW50RGV2LCBwcm90b2NvbCwgRGV2TWFjOiB0aGlzLmRhdGEudGVybWluYWwuRGV2TWFjLCBUeXBlIH0pXG4gICAgfSlcbiAgfSxcblxuICAvLyDliKDpmaTnu5Hlrprorr7lpIdcbiAgYXN5bmMgcm1CaW5kKGU6IHZhbnRFdmVudDxVYXJ0LnJlZ2lzdGVyRGV2Pikge1xuICAgIGNvbnN0IGl0ZW0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pdGVtXG4gICAgY29uc3QgeyBjb25maXJtIH0gPSBhd2FpdCB3eC5zaG93TW9kYWwoe1xuICAgICAgdGl0bGU6ICfliKDpmaTnu5Hlrprorr7lpIcnLFxuICAgICAgY29udGVudDogYOehruWumuWIoOmZpCAke2l0ZW0ubW91bnREZXZ9ID8/P2BcbiAgICB9KVxuICAgIGlmIChjb25maXJtKSB7XG4gICAgICBhcGkuZGVsVGVybWluYWxNb3VudERldih0aGlzLmRhdGEudGVybWluYWwuRGV2TWFjLCBpdGVtLnBpZCkudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMuc2NhblJlcXVzdCgpXG4gICAgICB9KVxuICAgIH1cblxuXG4gIH0sXG4gIC8v6L+c56iL6LCD6K+V6K6+5aSHXG4gIGFzeW5jIGlvdFJlbW90ZVVybCgpIHtcbiAgICBjb25zdCB7IGNvZGUsIGRhdGEgfSA9IGF3YWl0IGFwaS5pb3RSZW1vdGVVcmwodGhpcy5kYXRhLm1hYylcbiAgICBpZiAoIWNvZGUpIHtcbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIHRpdGxlOiAn6I635Y+W5aSx6LSlJyxcbiAgICAgICAgY29udGVudDogJ+iuvuWkh+acque7keWumuWIsElPVOi0puWPtydcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghL3JlbW90ZV9jb2RlPSQvLnRlc3QoZGF0YSkpIHtcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ+iwg+ivleWcsOWdgCcsXG4gICAgICAgICAgY29udGVudDogZGF0YSxcbiAgICAgICAgICBzdWNjZXNzKCkge1xuICAgICAgICAgICAgd3guc2V0Q2xpcGJvYXJkRGF0YSh7XG4gICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5bey5aSN5Yi2572R5Z2A5Yiw5Ymq5YiH5p2/J1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ+iOt+WPluWksei0pScsXG4gICAgICAgICAgY29udGVudDogJ+iuvuWkh+acqui/nuaOpeWIsGlvdCBzZXJ2ZXLkuK3lv4MnXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG5cblxuICAvKipcbiAgICog55Sf5oiQ5qCH562+XG4gICAqL1xuICAvKiBhc3luYyBnZW5lcmF0ZUxhYmVsKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBxclJlYWR5OiBmYWxzZVxuICAgIH0pXG4gICAgY29uc3QgbWFjID0gdGhpcy5kYXRhLnRlcm1pbmFsLkRldk1hY1xuICAgIGNvbnN0IHBpY19yZWFkbWVxciA9IGF3YWl0IHRoaXMuZG93bVBpYyhcImh0dHBzOi8vd3d3LmxhZGlzaGIuY29tL3VwbG9hZC85XzE4XzIwMjFfcXJjb2RlX3d3dy55dXF1ZS5jb20ucG5nXCIpXG4gICAgY29uc3QgcGljX3dwcXIgPSBhd2FpdCB0aGlzLmRvd21QaWMoXCJodHRwczovL3d3dy5sYWRpc2hiLmNvbS91cGxvYWQvMzMxMjAyMV9fTEFEU19VYXJ0LjVkZjJjYzYucG5nXCIpXG4gICAgY29uc3QgcGljX21hYyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVGaWxlKG1hYylcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcXJSZWFkeTogdHJ1ZVxuICAgIH0pXG4gICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IFByb21pc2U8YW55PihyZXNvbHZlID0+IHtcbiAgICAgIHd4LmNyZWF0ZVNlbGVjdG9yUXVlcnkoKVxuICAgICAgICAuc2VsZWN0KFwiI2NhbnZhczFcIilcbiAgICAgICAgLmZpZWxkcyh7IG5vZGU6IHRydWUsIHNpemU6IHRydWUgfSlcbiAgICAgICAgLmV4ZWMocmVzID0+IHJlc29sdmUocmVzKSlcbiAgICB9KVxuICAgIGNvbnN0IGNhbnZhcyA9IHJlc1swXS5ub2RlIGFzIFdlY2hhdE1pbmlwcm9ncmFtLkNhbnZhc1xuICAgIGNhbnZhcy5oZWlnaHQgPSAxODBcbiAgICBjYW52YXMud2lkdGggPSAzODBcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpIGFzIFdlY2hhdE1pbmlwcm9ncmFtLkNhbnZhc0NvbnRleHRcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjRkZGRkZGXCI7XG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIDM1MCwgMjAwKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjMDAwMDAwXCI7XG4gICAgY3R4LmRyYXdJbWFnZShhd2FpdCB0aGlzLmdlbmVyYXRlQ2FudmFzSW1nKGNhbnZhcywgcGljX3JlYWRtZXFyKSwgMTAsIDUsIDExMCwgOTUpXG4gICAgY3R4LmZpbGxUZXh0KCfmk43kvZzor7TmmI4nLCA1MCwgMTEwKVxuICAgIGN0eC5kcmF3SW1hZ2UoYXdhaXQgdGhpcy5nZW5lcmF0ZUNhbnZhc0ltZyhjYW52YXMsIHBpY193cHFyKSwgMTIwLCA1LCAxMTAsIDk1KVxuICAgIGN0eC5maWxsVGV4dCgn5bCP56iL5bqPJywgMTY1LCAxMTApXG4gICAgY3R4LmRyYXdJbWFnZShhd2FpdCB0aGlzLmdlbmVyYXRlQ2FudmFzSW1nKGNhbnZhcywgcGljX21hYyksIDIzMCwgNSwgMTEwLCA5NSlcbiAgICBjdHguZmlsbFRleHQoJ21hYzonICsgbWFjLCAyNDAsIDExMClcbiAgfSwgKi9cblxuICAvKipcbiAgICog5LiL6L295qCH562+XG4gICAqL1xuICAvKiBhc3luYyBkb3duTGFiZWwoKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IFByb21pc2U8YW55PihyZXNvbHZlID0+IHtcbiAgICAgIHd4LmNyZWF0ZVNlbGVjdG9yUXVlcnkoKVxuICAgICAgICAuc2VsZWN0KFwiI2NhbnZhczFcIilcbiAgICAgICAgLmZpZWxkcyh7IG5vZGU6IHRydWUsIHNpemU6IHRydWUgfSlcbiAgICAgICAgLmV4ZWMocmVzID0+IHJlc29sdmUocmVzKSlcbiAgICB9KVxuICAgIGNvbnN0IGNhbnZhcyA9IHJlc1swXS5ub2RlIGFzIFdlY2hhdE1pbmlwcm9ncmFtLkNhbnZhc1xuICAgIHd4LmNhbnZhc1RvVGVtcEZpbGVQYXRoKHtcbiAgICAgIGNhbnZhc0lkOiBcImNhbnZhczFcIixcbiAgICAgIHF1YWxpdHk6IDEsXG4gICAgICBjYW52YXMsXG4gICAgICBmaWxlVHlwZTogXCJqcGdcIixcbiAgICAgIGRlc3RIZWlnaHQ6IDMwMCxcbiAgICAgIGRlc3RXaWR0aDogNzAwLFxuICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgd3guc2F2ZUltYWdlVG9QaG90b3NBbGJ1bSh7XG4gICAgICAgICAgZmlsZVBhdGg6IHJlcy50ZW1wRmlsZVBhdGgsXG4gICAgICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgICAgIGlmIChyZXMuZXJyTXNnID0gXCJzYXZlSW1hZ2VUb1Bob3Rvc0FsYnVtOm9rXCIpIHtcbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCLlt7Lkv53lrZjliLDnhafniYflupNcIixcbiAgICAgICAgICAgICAgICBpY29uOiBcInN1Y2Nlc3NcIlxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIGFzeW5jIGdlbmVyYXRlRmlsZShjb2RlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBiYXNlID0gYXdhaXQgYXBpLnFyKGNvZGUpXG4gICAgY29uc3QgZmlsZVBhdGggPSBgJHt3eC5lbnYuVVNFUl9EQVRBX1BBVEh9LyR7Y29kZX0ucG5nYFxuICAgIGNvbnN0IG0gPSB3eC5nZXRGaWxlU3lzdGVtTWFuYWdlcigpXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHN0cmluZz4ocmVzb2x2ZSA9PiB7XG4gICAgICBtLndyaXRlRmlsZSh7XG4gICAgICAgIGZpbGVQYXRoLFxuICAgICAgICBkYXRhOiBiYXNlLmRhdGEucmVwbGFjZSgvW1xcclxcbl0vZywgJycpLnNsaWNlKDIyKSxcbiAgICAgICAgZW5jb2Rpbmc6IFwiYmFzZTY0XCIsXG4gICAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgcmVzb2x2ZShmaWxlUGF0aClcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbChlKSB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBlLmVyck1zZyxcbiAgICAgICAgICAgIGljb246IFwiZXJyb3JcIlxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcbiAqL1xuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSBjYW52YXMgXG4gICAqIEBwYXJhbSBwYXRoIFxuICAgKi9cbiAgLyogZ2VuZXJhdGVDYW52YXNJbWcoY2FudmFzOiBXZWNoYXRNaW5pcHJvZ3JhbS5DYW52YXMsIHBhdGg6IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KHJlc29sdmUgPT4ge1xuICAgICAgY29uc3QgaW1nID0gY2FudmFzLmNyZWF0ZUltYWdlKClcbiAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKGltZyBhcyBhbnkpXG4gICAgICBpbWcub25lcnJvciA9IChlKSA9PiB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6IGUuZXJyTXNnLFxuICAgICAgICAgIGljb246IFwiZXJyb3JcIlxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgaW1nLnNyYyA9IHBhdGhcbiAgICB9KVxuICB9LFxuICovXG4gIC8qKlxuICAgKiDkuIvovb3mlofku7ZcbiAgICovXG4gIC8qIGRvd21QaWModXJsOiBzdHJpbmcpIHtcbiAgICBjb25zdCBuQXJyID0gdXJsLnNwbGl0KFwiL1wiKVxuICAgIGNvbnN0IG5hbWUgPSBuQXJyW25BcnIubGVuZ3RoIC0gMV1cbiAgICBjb25zdCBmaWxlbmFtZSA9IGAke3d4LmVudi5VU0VSX0RBVEFfUEFUSH0vJHtuYW1lfWBcbiAgICAvL2NvbnNvbGUubG9nKHsgbkFyciwgbmFtZSwgZmlsZW5hbWUgfSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPihyZXNvbHZlID0+IHtcbiAgICAgIC8vIOWIpOaWreaWh+S7tuaYr+WQpuWtmOWcqCzkuI3lrZjlnKjlsLHkuIvovb3mlofku7ZcbiAgICAgIGNvbnN0IG0gPSB3eC5nZXRGaWxlU3lzdGVtTWFuYWdlcigpXG4gICAgICBtLnN0YXQoe1xuICAgICAgICBwYXRoOiBmaWxlbmFtZSxcbiAgICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgICByZXNvbHZlKGZpbGVuYW1lKVxuICAgICAgICB9LFxuICAgICAgICBmYWlsKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlLmVyck1zZyk7XG4gICAgICAgICAgd3guZG93bmxvYWRGaWxlKHtcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIGZpbGVQYXRoOiBmaWxlbmFtZSxcbiAgICAgICAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUocmVzLmZpbGVQYXRoKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWwoZSkge1xuICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBlLmVyck1zZyxcbiAgICAgICAgICAgICAgICBpY29uOiBcImVycm9yXCJcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH0sICovXG59KSJdfQ==