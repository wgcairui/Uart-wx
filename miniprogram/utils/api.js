"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("../config");
class api {
    constructor() {
        this.url = config_1.urlRequest + "/api/wx/";
        this.token = "";
    }
    async login(data) {
        const el = await this.RequestUart({ url: "code2Session", data });
        if (el.ok) {
            this.token = el.arg.token;
            wx.setBackgroundFetchToken({
                token: this.token
            });
            wx.setStorage({ key: 'token', data: el.arg.token });
            const ws = wx.connectSocket({
                url: config_1.urlWs,
                header: {
                    'content-type': 'application/json'
                }
            });
            ws.onOpen(() => {
                ws.send({
                    data: JSON.stringify({ token: el.arg.token }),
                    success: () => {
                        this.wsInter = setInterval(() => {
                            ws.send({ data: 'time' });
                        }, 1000 * 30);
                    }
                });
                ws.onMessage((msg) => {
                    wx.vibrateLong();
                    wx.showModal({
                        title: '新的告警信息',
                        content: msg.data.toString(),
                        success() {
                            wx.switchTab({
                                url: '/pages/index/alarm/alarm'
                            });
                        }
                    });
                });
                wx.onSocketClose(() => {
                    console.log(new Date().toLocaleString() + "socket close");
                    clearInterval(this.wsInter);
                });
            });
        }
        return el;
    }
    userlogin(data) {
        return this.RequestUart({ url: 'userlogin', data });
    }
    async unbindwx() {
        const el = await this.RequestUart({ url: 'unbindwx', data: {} });
        this.token = "";
        return el;
    }
    getphonenumber(data) {
        return this.RequestUart({ url: "getphonenumber", data });
    }
    registerUser(data) {
        return this.RequestUart({ url: "register", data });
    }
    getuserMountDev() {
        return this.RequestUart({ url: 'getuserMountDev', data: {} });
    }
    getDTUInfo(mac) {
        return this.RequestUart({ url: 'getDTUInfo', data: { mac } });
    }
    getUserInfo() {
        return this.RequestUart({ url: 'getUserInfo', data: {} });
    }
    bindDev(mac) {
        return this.RequestUart({ url: 'bindDev', data: { mac } });
    }
    getAlarmunconfirmed() {
        return this.RequestUart({ url: 'getAlarmunconfirmed', data: {} });
    }
    getAlarm(start, end) {
        return this.RequestUart({ url: 'getAlarm', data: { start, end } });
    }
    alarmConfirmed(id) {
        return this.RequestUart({ url: 'alarmConfirmed', data: id ? { id } : {} });
    }
    getDevsRunInfo(mac, pid) {
        return this.RequestUart({ url: "getDevsRunInfo", data: { mac, pid } });
    }
    getDevsHistoryInfo(mac, pid, name, datatime = '') {
        return this.RequestUart({ url: 'getDevsHistoryInfo', data: { mac, pid, name, datatime } });
    }
    getDevOprate(protocol) {
        return this.RequestUart({ url: 'getDevOprate', data: { protocol } });
    }
    SendProcotolInstructSet(query, item) {
        return this.RequestUart({ url: 'SendProcotolInstructSet', data: { query, item }, method: 'POST' });
    }
    getUserDevConstant(protocol) {
        return this.RequestUart({ url: 'getUserDevConstant', data: { protocol } });
    }
    pushThreshold(arg, type, Protocol) {
        return this.RequestUart({ url: "pushThreshold", data: { type, arg, Protocol }, method: "POST" });
    }
    getUserAlarmTels() {
        return this.RequestUart({ url: 'getUserAlarmTels', data: {} });
    }
    setUserSetupContact(tels, mails) {
        return this.RequestUart({ url: 'setUserSetupContact', data: { tels, mails }, method: "POST" });
    }
    addTerminalMountDe(DevMac, Type, mountDev, protocol, pid) {
        return this.RequestUart({ url: 'addTerminalMountDev', data: { DevMac, Type, mountDev, protocol, pid }, method: "POST" });
    }
    delTerminalMountDev(DevMac, mountDev, pid) {
        return this.RequestUart({ url: 'delTerminalMountDev', data: { DevMac, mountDev, pid }, method: "POST" });
    }
    delUserTerminal(mac) {
        return this.RequestUart({ url: 'delUserTerminal', data: { mac } });
    }
    DevTypes(Type) {
        return this.RequestUart({ url: 'DevTypes', data: { Type } });
    }
    modifyUserInfo(type, value) {
        return this.RequestUart({ url: 'modifyUserInfo', data: { type, value } });
    }
    getGPSaddress(location) {
        return this.RequestUart({ url: 'getGPSaddress', data: { location } });
    }
    async cancelwx() {
        const el = await this.RequestUart({ url: 'cancelwx', data: {} });
        this.token = "";
        return el;
    }
    getUserTel() {
        return this.RequestUart({ url: 'getUserTel', data: {} });
    }
    sendValidation() {
        return this.RequestUart({ url: 'sendValidation', data: {} });
    }
    ValidationCode(code) {
        return this.RequestUart({ url: 'ValidationCode', data: { code } });
    }
    getNodes() {
        return this.RequestUart({ url: 'getNodes', data: {} });
    }
    bacthRegisterDTU(node, dtus) {
        return this.RequestUart({ url: 'bacthRegisterDTU', data: { node, dtus }, method: "POST" });
    }
    addVm() {
        return this.RequestUart({ url: 'addVm', data: {} });
    }
    modifyDTUName(dtu, name) {
        return this.RequestUart({ url: 'modifyDTUName', data: { dtu, name } });
    }
    updateGps(dtu, jw) {
        return this.RequestUart({ url: 'updateGps', data: { dtu, jw } });
    }
    webLogin(code) {
        return this.RequestUart({ url: 'webLogin', data: { code, token: this.token } });
    }
    iotRemoteUrl(mac) {
        return this.RequestUart({ url: 'iotRemoteUrl', data: { mac } });
    }
    async RequestUart(object) {
        const token = this.token || await wx.getStorage({ key: 'token' }).then(el => el.data).catch(() => "");
        return await new Promise((resolve, reject) => {
            wx.request({
                timeout: 1000 * 60,
                url: this.url + object.url,
                data: object.data,
                method: object.method || "GET",
                header: { token: token },
                success: res => {
                    if (res.statusCode !== 200) {
                        wx.showModal({
                            title: String(res.statusCode),
                            content: res.data.toString() || res.errMsg,
                            success() {
                                wx.reLaunch({ url: '/pages/index/index' });
                            }
                        });
                        reject(res);
                    }
                    else {
                        setTimeout(() => {
                            resolve(res.data);
                        }, 0);
                    }
                },
                fail: e => {
                    wx.showModal({ title: '服务器错误', content: e.errMsg });
                    reject(e);
                },
                complete: () => {
                }
            });
        });
    }
}
exports.default = new api();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTZDO0FBMEQ3QyxNQUFNLEdBQUc7SUFJUDtRQUNFLElBQUksQ0FBQyxHQUFHLEdBQUcsbUJBQVUsR0FBRyxVQUFVLENBQUE7UUFDbEMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUE7SUFDakIsQ0FBQztJQU1ELEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBeUI7UUFDbkMsTUFBTSxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFNLEVBQUUsR0FBRyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ3JFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUE7WUFDekIsRUFBRSxDQUFDLHVCQUF1QixDQUFDO2dCQUN6QixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7YUFDbEIsQ0FBQyxDQUFBO1lBQ0YsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQTtZQUVuRCxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDO2dCQUMxQixHQUFHLEVBQUUsY0FBSztnQkFDVixNQUFNLEVBQUU7b0JBQ04sY0FBYyxFQUFFLGtCQUFrQjtpQkFDbkM7YUFDRixDQUFDLENBQUE7WUFDRixFQUFFLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtnQkFDYixFQUFFLENBQUMsSUFBSSxDQUFDO29CQUNOLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBZSxFQUFFLENBQUM7b0JBQ3ZELE9BQU8sRUFBRSxHQUFHLEVBQUU7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QU0sRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7Z0JBQ3hCLE9BQU8sRUFBRSxHQUFHLENBQUMsRUFBRTtvQkFHYixJQUFJLEdBQUcsQ0FBQyxVQUFVLEtBQUssR0FBRyxFQUFFO3dCQUMxQixFQUFFLENBQUMsU0FBUyxDQUFDOzRCQUNYLEtBQUssRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQzs0QkFDN0IsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLE1BQU07NEJBQzFDLE9BQU87Z0NBQ0wsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxvQkFBb0IsRUFBRSxDQUFDLENBQUE7NEJBQzVDLENBQUM7eUJBQ0YsQ0FBQyxDQUFBO3dCQUNGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtxQkFDWjt5QkFBTTt3QkFDTCxVQUFVLENBQUMsR0FBRyxFQUFFOzRCQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBVyxDQUFDLENBQUE7d0JBQzFCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtxQkFDTjtnQkFDSCxDQUFDO2dCQUNELElBQUksRUFBRSxDQUFDLENBQUMsRUFBRTtvQkFDUixFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7b0JBRW5ELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDWCxDQUFDO2dCQUNELFFBQVEsRUFBRSxHQUFHLEVBQUU7Z0JBR2YsQ0FBQzthQUNGLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGO0FBRUQsa0JBQWUsSUFBSSxHQUFHLEVBQUUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVybFJlcXVlc3QsIHVybFdzIH0gZnJvbSBcIi4uL2NvbmZpZ1wiXG5cbmludGVyZmFjZSB0ZW5jZXRNYXAge1xuICAvKiDnirbmgIHnoIHvvIww5Li65q2j5bi4LFxuMzEw6K+35rGC5Y+C5pWw5L+h5oGv5pyJ6K+v77yMXG4zMTFLZXnmoLzlvI/plJnor68sXG4zMDbor7fmsYLmnInmiqTmjIHkv6Hmga/or7fmo4Dmn6XlrZfnrKbkuLIsXG4xMTDor7fmsYLmnaXmupDmnKrooqvmjojmnYMgKi9cbiAgc3RhdHVzOiBudW1iZXIsXG4gIHJlcXVlc3RfaWQ6IHN0cmluZyxcbiAgbWVzc2FnZTogc3RyaW5nXG4gIHJlc3VsdDogYW55XG59XG5cbi8qKlxuICogYXBp6K+35rGC6Lev5b6EXG4gKi9cbnR5cGUgdXJsID0gJ2dldHVzZXJNb3VudERldidcbiAgfCAnY29kZTJTZXNzaW9uJ1xuICB8ICdnZXRwaG9uZW51bWJlcidcbiAgfCAncmVnaXN0ZXInXG4gIHwgJ2dldERUVUluZm8nXG4gIHwgJ2JpbmREZXYnXG4gIHwgJ2dldEFsYXJtJ1xuICB8ICdnZXREZXZzUnVuSW5mbydcbiAgfCAnZ2V0RGV2c0hpc3RvcnlJbmZvJ1xuICB8ICd1c2VybG9naW4nXG4gIHwgJ2dldFVzZXJJbmZvJ1xuICB8ICd1bmJpbmR3eCdcbiAgfCAnZ2V0QWxhcm11bmNvbmZpcm1lZCdcbiAgfCAnYWxhcm1Db25maXJtZWQnXG4gIHwgJ2dldERldk9wcmF0ZSdcbiAgfCAnU2VuZFByb2NvdG9sSW5zdHJ1Y3RTZXQnXG4gIHwgJ2dldFVzZXJEZXZDb25zdGFudCdcbiAgfCAncHVzaFRocmVzaG9sZCdcbiAgfCAnZ2V0VXNlckFsYXJtVGVscydcbiAgfCAnc2V0VXNlclNldHVwQ29udGFjdCdcbiAgfCAnYWRkVGVybWluYWxNb3VudERldidcbiAgfCAnZGVsVGVybWluYWxNb3VudERldidcbiAgfCAnZGVsVXNlclRlcm1pbmFsJ1xuICB8ICdEZXZUeXBlcydcbiAgfCAnbW9kaWZ5VXNlckluZm8nXG4gIHwgJ2dldEdQU2FkZHJlc3MnXG4gIHwgJ2NhbmNlbHd4J1xuICB8ICdnZXRVc2VyVGVsJ1xuICB8ICdzZW5kVmFsaWRhdGlvbidcbiAgfCAnVmFsaWRhdGlvbkNvZGUnXG4gIHwgJ2dldE5vZGVzJ1xuICB8ICdiYWN0aFJlZ2lzdGVyRFRVJ1xuICB8ICdhZGRWbSdcbiAgfCAnbW9kaWZ5RFRVTmFtZSdcbiAgfCAndXBkYXRlR3BzJ1xuICB8ICd3ZWJMb2dpbidcbiAgfCAnaW90UmVtb3RlVXJsJ1xuXG4vKipcbiAqIEBjbGFzcyB3cOWuouaIt+err+e7n+S4gOivt+axgmFwaVxuICovXG5jbGFzcyBhcGkge1xuICByZWFkb25seSB1cmw6IHN0cmluZ1xuICB0b2tlbjogc3RyaW5nXG4gIHByaXZhdGUgd3NJbnRlcj86IG51bWJlclxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnVybCA9IHVybFJlcXVlc3QgKyBcIi9hcGkvd3gvXCJcbiAgICB0aGlzLnRva2VuID0gXCJcIlxuICB9XG5cbiAgLyoqXG4gICAqIOeZu+W9lS0g5Z+f5ZCNXG4gICAqIEBwYXJhbSBkYXRhIFxuICAgKi9cbiAgYXN5bmMgbG9naW4oZGF0YTogeyBqc19jb2RlOiBzdHJpbmcgfSkge1xuICAgIGNvbnN0IGVsID0gYXdhaXQgdGhpcy5SZXF1ZXN0VWFydDxhbnk+KHsgdXJsOiBcImNvZGUyU2Vzc2lvblwiLCBkYXRhIH0pXG4gICAgaWYgKGVsLm9rKSB7XG4gICAgICB0aGlzLnRva2VuID0gZWwuYXJnLnRva2VuXG4gICAgICB3eC5zZXRCYWNrZ3JvdW5kRmV0Y2hUb2tlbih7XG4gICAgICAgIHRva2VuOiB0aGlzLnRva2VuXG4gICAgICB9KVxuICAgICAgd3guc2V0U3RvcmFnZSh7IGtleTogJ3Rva2VuJywgZGF0YTogZWwuYXJnLnRva2VuIH0pXG4gICAgICAvLyDlkK/nlKhzb2NrZXRcbiAgICAgIGNvbnN0IHdzID0gd3guY29ubmVjdFNvY2tldCh7XG4gICAgICAgIHVybDogdXJsV3MsXG4gICAgICAgIGhlYWRlcjoge1xuICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHdzLm9uT3BlbigoKSA9PiB7XG4gICAgICAgIHdzLnNlbmQoe1xuICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgdG9rZW46IGVsLmFyZy50b2tlbiBhcyBzdHJpbmcgfSksXG4gICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy53c0ludGVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICB3cy5zZW5kKHsgZGF0YTogJ3RpbWUnIH0pXG4gICAgICAgICAgICB9LCAxMDAwICogMzApXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICB3cy5vbk1lc3NhZ2UoKG1zZykgPT4ge1xuICAgICAgICAgIHd4LnZpYnJhdGVMb25nKClcbiAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6ICfmlrDnmoTlkYrorabkv6Hmga8nLFxuICAgICAgICAgICAgY29udGVudDogbXNnLmRhdGEudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgIHd4LnN3aXRjaFRhYih7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3BhZ2VzL2luZGV4L2FsYXJtL2FsYXJtJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIHd4Lm9uU29ja2V0Q2xvc2UoKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKSArIFwic29ja2V0IGNsb3NlXCIpO1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy53c0ludGVyKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9XG4gICAgcmV0dXJuIGVsXG4gIH1cblxuICAvKipcbiAgICog55m75b2VLeeUqOS6juWwj+eoi+W6j+eZu+W9lemhtemdoueZu+W9lVxuICAgKiBAcGFyYW0gZGF0YSBcbiAgICovXG4gIHVzZXJsb2dpbihkYXRhOiB7IG9wZW5pZDogc3RyaW5nLCBhdmFudGVyOiBzdHJpbmcsIHVzZXI6IHN0cmluZywgcGFzc3dkOiBzdHJpbmcgfSkge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PGFueT4oeyB1cmw6ICd1c2VybG9naW4nLCBkYXRhIH0pXG4gIH1cblxuICAvKipcbiAgICog55So5LqO6Kej57uR5b6u5L+h5ZKM6YCP5Lyg6LSm5Y+355qE57uR5a6a5YWz57O7XG4gICAqL1xuICBhc3luYyB1bmJpbmR3eCgpIHtcbiAgICBjb25zdCBlbCA9IGF3YWl0IHRoaXMuUmVxdWVzdFVhcnQ8YW55Pih7IHVybDogJ3VuYmluZHd4JywgZGF0YToge30gfSlcbiAgICB0aGlzLnRva2VuID0gXCJcIlxuICAgIHJldHVybiBlbFxuICB9XG5cbiAgLyoqXG4gICAqIOino+WvhueUteivneWtl+espuS4slxuICAgKiBAcGFyYW0gZGF0YSBcbiAgICovXG4gIGdldHBob25lbnVtYmVyPFQ+KGRhdGE6IHsgb3BlbmlkOiBzdHJpbmcsIGVuY3J5cHRlZERhdGE6IHN0cmluZywgaXY6IHN0cmluZyB9KSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8VD4oeyB1cmw6IFwiZ2V0cGhvbmVudW1iZXJcIiwgZGF0YSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjFxuICAgKiBAcGFyYW0gZGF0YSBcbiAgICovXG4gIHJlZ2lzdGVyVXNlcihkYXRhOiB7IHVzZXI6IHN0cmluZywgbmFtZTogc3RyaW5nLCB0ZWw6IHN0cmluZywgYXZhbnRlcjogc3RyaW5nIH0pIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydCh7IHVybDogXCJyZWdpc3RlclwiLCBkYXRhIH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi357uR5a6a6K6+5aSHXG4gICAqL1xuICBnZXR1c2VyTW91bnREZXYoKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8eyBVVHM6IFRlcm1pbmFsW10gfT4oeyB1cmw6ICdnZXR1c2VyTW91bnREZXYnLCBkYXRhOiB7fSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlkRUVeS/oeaBr1xuICAgKiBAcGFyYW0gbWFjIFxuICAgKi9cbiAgZ2V0RFRVSW5mbyhtYWM6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PFRlcm1pbmFsPih7IHVybDogJ2dldERUVUluZm8nLCBkYXRhOiB7IG1hYyB9IH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi35L+h5oGvXG4gICAqL1xuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDxVc2VySW5mbz4oeyB1cmw6ICdnZXRVc2VySW5mbycsIGRhdGE6IHt9IH0pXG4gIH1cblxuICAvKipcbiAgICog57uR5a6aRFRVXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqL1xuICBiaW5kRGV2KG1hYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8YW55Pih7IHVybDogJ2JpbmREZXYnLCBkYXRhOiB7IG1hYyB9IH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pyq56Gu6K6k5ZGK6K2m5pWw6YePXG4gICAqL1xuICBnZXRBbGFybXVuY29uZmlybWVkKCkge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PHsgbGVuOiBudW1iZXIsIGFsYXJtOiB1YXJ0QWxhcm1PYmplY3RbXSB9Pih7IHVybDogJ2dldEFsYXJtdW5jb25maXJtZWQnLCBkYXRhOiB7fSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWRiuitpuS/oeaBr1xuICAgKiBAcGFyYW0gc3RhcnQgXG4gICAqIEBwYXJhbSBlbmQgXG4gICAqL1xuICBnZXRBbGFybShzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PHVhcnRBbGFybU9iamVjdFtdPih7IHVybDogJ2dldEFsYXJtJywgZGF0YTogeyBzdGFydCwgZW5kIH0gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDnoa7orqTlkYrorabkv6Hmga8s5pu05pawYmFyXG4gICAqIEBwYXJhbSBpZCBcbiAgICovXG4gIGFsYXJtQ29uZmlybWVkKGlkPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQoeyB1cmw6ICdhbGFybUNvbmZpcm1lZCcsIGRhdGE6IGlkID8geyBpZCB9IDoge30gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5borr7lpIflrp7ml7bov5DooYzkv6Hmga9cbiAgICogQHBhcmFtIG1hYyBcbiAgICogQHBhcmFtIHBpZCBcbiAgICovXG4gIGdldERldnNSdW5JbmZvKG1hYzogc3RyaW5nLCBwaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PHF1ZXJ5UmVzdWx0Pih7IHVybDogXCJnZXREZXZzUnVuSW5mb1wiLCBkYXRhOiB7IG1hYywgcGlkIH0gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5borr7lpIfljoblj7Lov5DooYzmlbDmja5cbiAgICogQHBhcmFtIG1hYyBcbiAgICogQHBhcmFtIHBpZCBcbiAgICogQHBhcmFtIG5hbWUgXG4gICAqIEBwYXJhbSBkYXRhdGltZSBcbiAgICovXG4gIGdldERldnNIaXN0b3J5SW5mbyhtYWM6IHN0cmluZywgcGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgZGF0YXRpbWU6IHN0cmluZyA9ICcnKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8YW55Pih7IHVybDogJ2dldERldnNIaXN0b3J5SW5mbycsIGRhdGE6IHsgbWFjLCBwaWQsIG5hbWUsIGRhdGF0aW1lIH0gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5borr7lpIfmk43mjqfmjIfku6RcbiAgICogQHBhcmFtIHByb3RvY29sIFxuICAgKi9cbiAgZ2V0RGV2T3ByYXRlKHByb3RvY29sOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDxQaWNrPFByb3RvY29sQ29uc3RhbnRUaHJlc2hvbGQsICdPcHJhdGVJbnN0cnVjdCc+Pih7IHVybDogJ2dldERldk9wcmF0ZScsIGRhdGE6IHsgcHJvdG9jb2wgfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOWbuuWumuWPkemAgeiuvuWkh+aTjeS9nOaMh+S7pFxuICAgKiBAcGFyYW0gcXVlcnkgXG4gICAqIEBwYXJhbSBpdGVtIFxuICAgKi9cbiAgU2VuZFByb2NvdG9sSW5zdHJ1Y3RTZXQocXVlcnk6IFBhcnRpYWw8aW5zdHJ1Y3RRdWVyeUFyZz4sIGl0ZW06IE9wcmF0ZUluc3RydWN0KSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8YW55Pih7IHVybDogJ1NlbmRQcm9jb3RvbEluc3RydWN0U2V0JywgZGF0YTogeyBxdWVyeSwgaXRlbSB9LCBtZXRob2Q6ICdQT1NUJyB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlueUqOaIt+iHquWumuS5ieWNj+iurumFjee9rlxuICAgKiBAcGFyYW0gcHJvdG9jb2wgXG4gICAqL1xuICBnZXRVc2VyRGV2Q29uc3RhbnQocHJvdG9jb2w6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PHsgdXNlcjogUHJvdG9jb2xDb25zdGFudFRocmVzaG9sZCwgc3lzOiBQcm90b2NvbENvbnN0YW50VGhyZXNob2xkLCBwcm90b2NvbDogcHJvdG9jb2wgfT4oeyB1cmw6ICdnZXRVc2VyRGV2Q29uc3RhbnQnLCBkYXRhOiB7IHByb3RvY29sIH0gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDnu5/kuIDmj5DkuqTphY3nva5cbiAgICogQHBhcmFtIGFyZyBcbiAgICogQHBhcmFtIHR5cGUgXG4gICAqIEBwYXJhbSBQcm90b2NvbCBcbiAgICovXG4gIHB1c2hUaHJlc2hvbGQoYXJnOiBDb25zdGFudEFsYXJtU3RhdFtdIHwgVGhyZXNob2xkW10gfCBzdHJpbmdbXSwgdHlwZTogQ29uc3RhbnRUaHJlc2hvbGRUeXBlLCBQcm90b2NvbDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8YW55Pih7IHVybDogXCJwdXNoVGhyZXNob2xkXCIsIGRhdGE6IHsgdHlwZSwgYXJnLCBQcm90b2NvbCB9LCBtZXRob2Q6IFwiUE9TVFwiIH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE5ZGK6K2m6IGU57O75pa55byPXG4gICAqL1xuICBnZXRVc2VyQWxhcm1UZWxzKCkge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PFBpY2s8dXNlclNldHVwLCAnbWFpbHMnIHwgJ3RlbHMnPj4oeyB1cmw6ICdnZXRVc2VyQWxhcm1UZWxzJywgZGF0YToge30gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva7nlKjmiLfnmoTlkYrorabogZTns7vmlrnlvI9cbiAgICogQHBhcmFtIHRlbHMgXG4gICAqIEBwYXJhbSBtYWlscyBcbiAgICovXG4gIHNldFVzZXJTZXR1cENvbnRhY3QodGVsczogc3RyaW5nW10sIG1haWxzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PGFueT4oeyB1cmw6ICdzZXRVc2VyU2V0dXBDb250YWN0JywgZGF0YTogeyB0ZWxzLCBtYWlscyB9LCBtZXRob2Q6IFwiUE9TVFwiIH0pXG4gIH1cblxuICAvKipcbiAgICog5re75YqgRFRV5oyC6L296K6+5aSHXG4gICAqIEBwYXJhbSBEZXZNYWMgXG4gICAqIEBwYXJhbSBUeXBlIFxuICAgKiBAcGFyYW0gbW91bnREZXYgXG4gICAqIEBwYXJhbSBwcm90b2NvbCBcbiAgICogQHBhcmFtIHBpZCBcbiAgICovXG4gIGFkZFRlcm1pbmFsTW91bnREZShEZXZNYWM6IHN0cmluZywgVHlwZTogc3RyaW5nLCBtb3VudERldjogc3RyaW5nLCBwcm90b2NvbDogc3RyaW5nLCBwaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PGFueT4oeyB1cmw6ICdhZGRUZXJtaW5hbE1vdW50RGV2JywgZGF0YTogeyBEZXZNYWMsIFR5cGUsIG1vdW50RGV2LCBwcm90b2NvbCwgcGlkIH0sIG1ldGhvZDogXCJQT1NUXCIgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTnu4jnq6/mjILovb3orr7lpIdcbiAgICogQHBhcmFtIERldk1hYyDorr7lpIdtYWNcbiAgICogQHBhcmFtIG1vdW50RGV2IOaMgui9veiuvuWkh1xuICAgKiBAcGFyYW0gcGlkIFxuICAgKi9cbiAgZGVsVGVybWluYWxNb3VudERldihEZXZNYWM6IHN0cmluZywgbW91bnREZXY6IHN0cmluZywgcGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDxhbnk+KHsgdXJsOiAnZGVsVGVybWluYWxNb3VudERldicsIGRhdGE6IHsgRGV2TWFjLCBtb3VudERldiwgcGlkIH0sIG1ldGhvZDogXCJQT1NUXCIgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTnlKjmiLfnu4jnq6/nu5HlrppcbiAgICogQHBhcmFtIG1hYyBcbiAgICovXG4gIGRlbFVzZXJUZXJtaW5hbChtYWM6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PGFueT4oeyB1cmw6ICdkZWxVc2VyVGVybWluYWwnLCBkYXRhOiB7IG1hYyB9IH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6K6+5aSH57G75Z6LXG4gICAqIEBwYXJhbSBUeXBlIOiuvuWkh+exu+Wei+Wkp+exu1xuICAgKi9cbiAgRGV2VHlwZXMoVHlwZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8RGV2c1R5cGVbXT4oeyB1cmw6ICdEZXZUeXBlcycsIGRhdGE6IHsgVHlwZSB9IH0pXG4gIH1cblxuICAvKipcbiAgICog5L+u5pS555So5oi35L+h5oGvXG4gICAqIEBwYXJhbSB0eXBlIOS/ruaUueexu+Wei1xuICAgKiBAcGFyYW0gdmFsdWUg5YC8XG4gICAqL1xuICBtb2RpZnlVc2VySW5mbyh0eXBlOiAndGVsJyB8ICdtYWlsJyB8ICduYW1lJywgdmFsdWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PGFueT4oeyB1cmw6ICdtb2RpZnlVc2VySW5mbycsIGRhdGE6IHsgdHlwZSwgdmFsdWUgfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlmdwc+WumuS9jeeahOivpue7huWcsOWdgFxuICAgKiBAcGFyYW0gbG9jYXRpb24gXG4gICAqL1xuICBnZXRHUFNhZGRyZXNzKGxvY2F0aW9uOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDx0ZW5jZXRNYXA+KHsgdXJsOiAnZ2V0R1BTYWRkcmVzcycsIGRhdGE6IHsgbG9jYXRpb24gfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOazqOmUgOW+ruS/oVxuICAgKi9cbiAgYXN5bmMgY2FuY2Vsd3goKSB7XG4gICAgY29uc3QgZWwgPSBhd2FpdCB0aGlzLlJlcXVlc3RVYXJ0PHN0cmluZz4oeyB1cmw6ICdjYW5jZWx3eCcsIGRhdGE6IHt9IH0pXG4gICAgdGhpcy50b2tlbiA9IFwiXCJcbiAgICByZXR1cm4gZWxcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfmiYvmnLrlj7fnoIFcbiAgICovXG4gIGdldFVzZXJUZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8c3RyaW5nPih7IHVybDogJ2dldFVzZXJUZWwnLCBkYXRhOiB7fSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOWPkemAgeefreS/oemqjOivgeeggVxuICAgKi9cbiAgc2VuZFZhbGlkYXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8c3RyaW5nPih7IHVybDogJ3NlbmRWYWxpZGF0aW9uJywgZGF0YToge30gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDmo4Dpqoznn63kv6Hpqozor4HnoIFcbiAgICogQHBhcmFtIGNvZGUg6aqM6K+B56CBXG4gICAqL1xuICBWYWxpZGF0aW9uQ29kZShjb2RlOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDxzdHJpbmc+KHsgdXJsOiAnVmFsaWRhdGlvbkNvZGUnLCBkYXRhOiB7IGNvZGUgfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluiKgueCueWIl+ihqFxuICAgKi9cbiAgZ2V0Tm9kZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8Tm9kZUNsaWVudFtdPih7IHVybDogJ2dldE5vZGVzJywgZGF0YToge30gfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/ms6jlhoxEVFVcbiAgICogQHBhcmFtIG5vZGUg6IqC54K55ZCN56ewXG4gICAqIEBwYXJhbSBkdHVzIGR0dU1hY+aVsOe7hFxuICAgKi9cbiAgYmFjdGhSZWdpc3RlckRUVShub2RlOiBzdHJpbmcsIGR0dXM6IHN0cmluZ1tdKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8c3RyaW5nPih7IHVybDogJ2JhY3RoUmVnaXN0ZXJEVFUnLCBkYXRhOiB7IG5vZGUsIGR0dXMgfSwgbWV0aG9kOiBcIlBPU1RcIiB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOa3u+WKoOiZmuaLn+iuvuWkh1xuICAgKi9cbiAgYWRkVm0oKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8VGVybWluYWxbXT4oeyB1cmw6ICdhZGRWbScsIGRhdGE6IHt9IH0pXG4gIH1cblxuICAvKipcbiAgICog5L+u5pS5RFRV5ZCN56ewXG4gICAqIEBwYXJhbSBkdHUgbWFjXG4gICAqIEBwYXJhbSBuYW1lIOaWsOeahOWQjeensFxuICAgKi9cbiAgbW9kaWZ5RFRVTmFtZShkdHU6IHN0cmluZywgbmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8c3RyaW5nPih7IHVybDogJ21vZGlmeURUVU5hbWUnLCBkYXRhOiB7IGR0dSwgbmFtZSB9IH0pXG4gIH1cblxuICAvKipcbiAgICog5pu05pawZHR15a6a5L2NXG4gICAqIEBwYXJhbSBkdHUgZHR1TWFjXG4gICAqIEBwYXJhbSBqdyDnu4/nuqzluqZcbiAgICovXG4gIHVwZGF0ZUdwcyhkdHU6IHN0cmluZywganc6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLlJlcXVlc3RVYXJ0PHN0cmluZz4oeyB1cmw6ICd1cGRhdGVHcHMnLCBkYXRhOiB7IGR0dSwgancgfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIHdlYueZu+W9lVxuICAgKiBAcGFyYW0gY29kZSB0b2tlblxuICAgKi9cbiAgd2ViTG9naW4oY29kZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuUmVxdWVzdFVhcnQ8c3RyaW5nPih7IHVybDogJ3dlYkxvZ2luJywgZGF0YTogeyBjb2RlLCB0b2tlbjogdGhpcy50b2tlbiB9IH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+WZHR16L+c56iL6LCD6K+V572R5Z2AXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqL1xuICBpb3RSZW1vdGVVcmwobWFjOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5SZXF1ZXN0VWFydDxzdHJpbmc+KHsgdXJsOiAnaW90UmVtb3RlVXJsJywgZGF0YTogeyBtYWMgfSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXBp6YCa55SocmVxdXN05pa55rOVXG4gICAqIEBwYXJhbSBvYmplY3QgXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIFJlcXVlc3RVYXJ0PFQ+KG9iamVjdDogeyB1cmw6IHVybCwgZGF0YTogT2JqZWN0LCBtZXRob2Q/OiBcIkdFVFwiIHwgXCJQT1NUXCIgfSkge1xuICAgIC8vd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+ato+WcqOafpeivoicgfSlcbiAgICAvLyB3eC5zaG93TmF2aWdhdGlvbkJhckxvYWRpbmcoKVxuICAgIGNvbnN0IHRva2VuOiBzdHJpbmcgPSB0aGlzLnRva2VuIHx8IGF3YWl0IHd4LmdldFN0b3JhZ2UoeyBrZXk6ICd0b2tlbicgfSkudGhlbihlbCA9PiBlbC5kYXRhKS5jYXRjaCgoKSA9PiBcIlwiKVxuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxBcG9sbG9Nb25nb1Jlc3VsdDxUPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgd3gucmVxdWVzdCh7XG4gICAgICAgIHRpbWVvdXQ6IDEwMDAgKiA2MCxcbiAgICAgICAgdXJsOiB0aGlzLnVybCArIG9iamVjdC51cmwsXG4gICAgICAgIGRhdGE6IG9iamVjdC5kYXRhLC8vT2JqZWN0LmFzc2lnbih7IHRva2VuOiB0b2tlbiB9LCBvYmplY3QuZGF0YSksXG4gICAgICAgIG1ldGhvZDogb2JqZWN0Lm1ldGhvZCB8fCBcIkdFVFwiLFxuICAgICAgICBoZWFkZXI6IHsgdG9rZW46IHRva2VuIH0sXG4gICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAvLyB3eC5oaWRlTG9hZGluZygpXG4gICAgICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlICE9PSAyMDApIHtcbiAgICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgIHRpdGxlOiBTdHJpbmcocmVzLnN0YXR1c0NvZGUpLFxuICAgICAgICAgICAgICBjb250ZW50OiByZXMuZGF0YS50b1N0cmluZygpIHx8IHJlcy5lcnJNc2csXG4gICAgICAgICAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgd3gucmVMYXVuY2goeyB1cmw6ICcvcGFnZXMvaW5kZXgvaW5kZXgnIH0pXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZWplY3QocmVzKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXMuZGF0YSBhcyBhbnkpXG4gICAgICAgICAgICB9LCAwKVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZSA9PiB7XG4gICAgICAgICAgd3guc2hvd01vZGFsKHsgdGl0bGU6ICfmnI3liqHlmajplJnor68nLCBjb250ZW50OiBlLmVyck1zZyB9KVxuICAgICAgICAgIC8vIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgICByZWplY3QoZSlcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAvLyB3eC5oaWRlTmF2aWdhdGlvbkJhckxvYWRpbmcoKVxuICAgICAgICAgIC8vIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBhcGkoKVxuIl19