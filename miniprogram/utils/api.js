"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("../config");
class api {
    constructor() {
        this.token = "";
        this.wsEventMap = new Map();
    }
    setToken(token) {
        this.token = token;
        wx.setBackgroundFetchToken({
            token
        });
        if (this.ws) {
            this.ws.close({});
        }
        this.ws = wx.connectSocket({
            url: config_1.urlWs,
            header: {
                'content-type': 'application/json',
                token
            },
            success: (res) => {
                console.log({ res });
            },
            fail(err) {
                console.log({ err });
            }
        });
        this.ws.onOpen(() => {
            this.ws.send({
                data: JSON.stringify({ token: token })
            });
        });
        this.ws.onMessage(res => {
            if (/^{.*}$/.test(res.data)) {
                const { type, data } = JSON.parse(res.data);
                const fun = this.wsEventMap.get(type);
                if (fun) {
                    fun(data);
                }
            }
        });
        this.onMessage('info', msg => {
            wx.showModal({
                content: msg,
                title: 'info'
            });
        });
        this.onMessage('alarm', (data) => {
            wx.showModal({
                content: data.msg,
                title: '设备告警提醒',
                success() {
                    wx.switchTab({
                        url: '/pages/index/alarm/alarm'
                    });
                }
            });
        });
    }
    onMessage(event, fun) {
        if (!this.wsEventMap.has(event)) {
            this.wsEventMap.set(event, fun);
        }
    }
    offWs(event) {
        this.wsEventMap.delete(event);
    }
    async login(data) {
        const el = await this.fetch("auth/code2Session", data, "GET");
        if (el.code) {
            this.setToken(el.data.token);
        }
        return el;
    }
    async userlogin(data) {
        const el = await this.fetch('auth/wplogin', data);
        if (el.code) {
            this.setToken(el.data.token);
        }
        return el;
    }
    updateAvanter(nickName, avanter) {
        return this.fetch('updateAvanter', { nickName, avanter });
    }
    async unbindwx() {
        const el = await this.fetch('unbindwx');
        this.token = "";
        return el;
    }
    getphonenumber(data) {
        return this.fetch("auth/getphonenumber", data);
    }
    registerUser(data) {
        return this.fetch("auth/wxRegister", data);
    }
    bindDev(mac) {
        return this.fetch('bindDev', { mac });
    }
    getAlarmunconfirmed() {
        return this.fetch('getAlarmunconfirmed');
    }
    getGPSaddress(location) {
        return this.fetch('getGPSaddress', { location });
    }
    async cancelwx() {
        const el = await this.fetch('cancelwx');
        this.token = "";
        return el;
    }
    addVm() {
        return this.fetch('addVm');
    }
    modifyDTUName(dtu, name) {
        return this.fetch('modifyDTUName', { dtu, name });
    }
    updateGps(mac, jw) {
        return this.fetch('updateGps', { mac, jw });
    }
    webLogin(code) {
        return this.fetch('webLogin', { code, token: this.token });
    }
    addUser(name, user, passwd, tel, mail, company) {
        return this.fetch("guest/addUser", { name, user, passwd, tel, mail, company });
    }
    resetPasswdValidation(user) {
        return this.fetch("guest/resetPasswdValidation", { user });
    }
    resetUserPasswd(user, passwd, code) {
        return this.fetch("guest/resetUserPasswd", { user, passwd, code });
    }
    wxlogin(code, state) {
        return this.fetch("auth/wxlogin", { code, state });
    }
    crc(data) {
        return this.fetch("open//crc", { data });
    }
    BindDev() {
        return this.fetch("BindDev");
    }
    userInfo() {
        return this.fetch("userInfo");
    }
    getAlarm(start = new Date().toLocaleDateString().replace(/\//g, "-") + " 0:00:00", end = new Date().toLocaleDateString().replace(/\//g, "-") + " 23:59:59") {
        return this.fetch("loguartterminaldatatransfinites", { start, end });
    }
    confrimAlarm(id) {
        return this.fetch("confrimAlarm", { id });
    }
    getTerminalOnline(mac) {
        return this.fetch("getTerminalOnline", { mac });
    }
    modifyTerminal(mac, name) {
        return this.fetch('modifyTerminal', { mac, name });
    }
    addUserTerminal(mac) {
        return this.fetch("addUserTerminal", { mac });
    }
    delUserTerminal(mac) {
        return this.fetch("delUserTerminal", { mac });
    }
    getDevTypes(Type) {
        return this.fetch("getDevTypes", { Type });
    }
    delTerminalMountDev(mac, pid) {
        return this.fetch("delTerminalMountDev", { mac, pid });
    }
    addTerminalMountDev(mac, mountDev) {
        return this.fetch("addTerminalMountDev", { mac, mountDev });
    }
    getUserAlarmSetup() {
        return this.fetch("getUserAlarmSetup");
    }
    modifyUserAlarmSetupTel(tels, mails) {
        return this.fetch("modifyUserAlarmSetupTel", { tels, mails });
    }
    modifyUserInfo(data) {
        return this.fetch("modifyUserInfo", { data });
    }
    mpTicket() {
        return this.fetch("mpTicket");
    }
    wpTicket() {
        return this.fetch("wpTicket");
    }
    getUserAlarmProtocol(protocol) {
        return this.fetch("getUserAlarmProtocol", { protocol });
    }
    getAlarmProtocol(protocol) {
        return this.fetch("getAlarmProtocol", { protocol });
    }
    getTerminalData(mac, pid) {
        return this.fetch("getTerminalData", { mac, pid });
    }
    getTerminalDatas(mac, pid, name, datetime) {
        return this.fetch("getTerminalDatas", { mac, pid, name, datetime });
    }
    refreshDevTimeOut(mac, pid) {
        return this.fetch("refreshDevTimeOut", { mac, pid });
    }
    SendProcotolInstructSet(query, item) {
        return this.fetch("SendProcotolInstructSet", { query, item });
    }
    getProtocol(protocol) {
        return this.fetch("getProtocol", { protocol });
    }
    setUserSetupProtocol(protocol, type, arg) {
        return this.fetch("setUserSetupProtocol", { protocol, type, arg });
    }
    setAlias(mac, pid, protocol, name, alias) {
        return this.fetch("setAlias", { mac, pid, protocol, name, alias });
    }
    getTerminal(mac) {
        return this.fetch("getTerminal", { mac });
    }
    getUserLayout(id) {
        return this.fetch("getUserLayout", { id });
    }
    getAggregation(id) {
        return this.fetch("getAggregation", { id });
    }
    addAggregation(name, aggs) {
        return this.fetch("addAggregation", { name, aggs });
    }
    deleteAggregation(id) {
        return this.fetch("deleteAggregation", { id });
    }
    setUserLayout(id, type, bg, Layout) {
        return this.fetch("setUserLayout", { id, type, bg, Layout });
    }
    V2_API_Aamp_gps2autoanvi(locations, coordsys = "gps") {
        return this.fetch('util/AMap/GPS2autonavi', { coordsys, locations: Array.isArray(locations) ? locations.join("|") : locations });
    }
    V2_API_Aamp_ip2local(ip) {
        return this.fetch("util/AMap/IP2loction", { ip });
    }
    iotRemoteUrl(mac) {
        return this.fetch('root/iotRemoteUrl', { mac });
    }
    Nodes() {
        return this.fetch("root/Nodes");
    }
    addRegisterTerminal(DevMac, mountNode) {
        return this.fetch("root/addRegisterTerminal", { DevMac, mountNode });
    }
    getRootTerminal(mac) {
        return this.fetch("getTerminal", { mac });
    }
    addRegisterDev(ids, mountDev) {
        return this.fetch("root/addRegisterDev", { ids, mountDev });
    }
    getRegisterDev(id) {
        return this.fetch("getRegisterDev", { id });
    }
    delRegisterDev(id) {
        return this.fetch("root/delRegisterDev", { id });
    }
    getRegisterDevs() {
        return this.fetch("root/getRegisterDevs");
    }
    sendATInstruct(mac, content) {
        return this.fetch("root/sendATInstruct", { mac, content });
    }
    initTerminal(mac) {
        return this.fetch("root/initTerminal", { mac }, "POST", 1000 * 60 * 5);
    }
    qr(code) {
        return this.fetch("qr", { code });
    }
    async trial(data) {
        const el = await this.fetch("auth/trial", data, "GET");
        if (el.code) {
            this.setToken(el.data.token);
        }
        return el;
    }
    async fetch(url, data = {}, method = "POST", timeout = 1000 * 60) {
        const token = this.token || await wx.getStorage({ key: 'token' }).then(el => el.data).catch(() => "");
        return await new Promise((resolve, reject) => {
            wx.request({
                timeout,
                url: config_1.urlRequest + "/api/" + url,
                data,
                method,
                enableHttp2: true,
                header: { token, type: 'wp' },
                success: res => {
                    if (res.data.code === 201) {
                        wx.navigateTo({
                            url: '/pages/util/smsValidation/smsValidation',
                            events: {
                                code: (code) => {
                                    this.fetch('smsCodeValidation', { code }).then(codeValidation => {
                                        if (codeValidation.code) {
                                            this.fetch(url, data, method).then(res => {
                                                resolve(res.data);
                                            });
                                        }
                                        else {
                                            wx.showModal({
                                                title: 'error',
                                                content: '短信校验错误'
                                            });
                                            throw new Error();
                                        }
                                    });
                                }
                            }
                        });
                    }
                    else if (res.data.code === 0 && res.data.data === 'token null') {
                        wx.switchTab({
                            url: '/pages/index/index'
                        });
                    }
                    else
                        resolve(res.data);
                },
                fail: e => {
                    console.log({ e });
                    wx.showToast({ title: '服务器错误', content: e.errMsg });
                    wx.hideLoading();
                    reject(e);
                }
            });
        });
    }
}
exports.default = new api();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTZDO0FBd0I3QyxNQUFNLEdBQUc7SUFVUDtRQUNFLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFBO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO0lBQzdCLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYTtRQUNwQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNsQixFQUFFLENBQUMsdUJBQXVCLENBQUM7WUFDekIsS0FBSztTQUNOLENBQUMsQ0FBQTtRQUVGLElBQUcsSUFBSSxDQUFDLEVBQUUsRUFBQztZQUNULElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1NBQ2xCO1FBRUQsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDO1lBQ3pCLEdBQUcsRUFBRSxjQUFLO1lBQ1YsTUFBTSxFQUFFO2dCQUNOLGNBQWMsRUFBRSxrQkFBa0I7Z0JBQ2xDLEtBQUs7YUFDTjtZQUNELE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBR3ZCLENBQUM7WUFDRCxJQUFJLENBQUMsR0FBRztnQkFDTixPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUN2QixDQUFDO1NBQ0YsQ0FBQyxDQUFBO1FBRUYsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ2xCLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO2dCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDO2FBQ3ZDLENBQUMsQ0FBQTtRQUNKLENBQUMs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QUMsSUFBVyxLQUFLLFlBQVksRUFBRTt3QkFDdkUsRUFBRSxDQUFDLFNBQVMsQ0FBQzs0QkFDWCxHQUFHLEVBQUUsb0JBQW9CO3lCQUMxQixDQUFDLENBQUE7cUJBQ0g7O3dCQUNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBVyxDQUFDLENBQUE7Z0JBQzVCLENBQUM7Z0JBQ0QsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFO29CQUNSLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNuQixFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7b0JBQ25ELEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtvQkFDaEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUNYLENBQUM7YUFDRixDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRjtBQUVELGtCQUFlLElBQUksR0FBRyxFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1cmxSZXF1ZXN0LCB1cmxXcyB9IGZyb20gXCIuLi9jb25maWdcIlxuXG5leHBvcnQgaW50ZXJmYWNlIHRlbmNldE1hcCB7XG4gIC8qIOeKtuaAgeegge+8jDDkuLrmraPluLgsXG4zMTDor7fmsYLlj4LmlbDkv6Hmga/mnInor6/vvIxcbjMxMUtleeagvOW8j+mUmeivryxcbjMwNuivt+axguacieaKpOaMgeS/oeaBr+ivt+ajgOafpeWtl+espuS4sixcbjExMOivt+axguadpea6kOacquiiq+aOiOadgyAqL1xuICBzdGF0dXM6IG51bWJlcixcbiAgcmVxdWVzdF9pZDogc3RyaW5nLFxuICBtZXNzYWdlOiBzdHJpbmdcbiAgcmVzdWx0OiBhbnlcbn1cblxuaW50ZXJmYWNlIHJlc3VsdDxUID0gYW55PiB7XG4gIGNvZGU6IG51bWJlclxuICBkYXRhOiBUXG4gIG1zZzogc3RyaW5nXG4gIFt4OiBzdHJpbmddOiBhbnlcbn1cblxuLyoqXG4gKiBAY2xhc3Mgd3DlrqLmiLfnq6/nu5/kuIDor7fmsYJhcGlcbiAqL1xuY2xhc3MgYXBpIHtcbiAgdG9rZW46IHN0cmluZ1xuICB3cyE6IFdlY2hhdE1pbmlwcm9ncmFtLlNvY2tldFRhc2tcblxuXG4gIC8qKlxuICAgKiB3c+S6i+S7tuaUtumbhizpgb/lhY3ph43lpI3ms6jlhoznm5HlkKzlr7nosaFcbiAgICovXG4gIHdzRXZlbnRNYXA6IE1hcDxzdHJpbmcsIChlOiBhbnkpID0+IHZvaWQ+XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50b2tlbiA9IFwiXCJcbiAgICB0aGlzLndzRXZlbnRNYXAgPSBuZXcgTWFwKClcbiAgfVxuXG4gIHNldFRva2VuKHRva2VuOiBzdHJpbmcpIHtcbiAgICB0aGlzLnRva2VuID0gdG9rZW5cbiAgICB3eC5zZXRCYWNrZ3JvdW5kRmV0Y2hUb2tlbih7XG4gICAgICB0b2tlblxuICAgIH0pXG5cbiAgICBpZih0aGlzLndzKXtcbiAgICAgIHRoaXMud3MuY2xvc2Uoe30pXG4gICAgfVxuXG4gICAgdGhpcy53cyA9IHd4LmNvbm5lY3RTb2NrZXQoe1xuICAgICAgdXJsOiB1cmxXcyxcbiAgICAgIGhlYWRlcjoge1xuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB0b2tlblxuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coeyByZXMgfSk7XG5cblxuICAgICAgfSxcbiAgICAgIGZhaWwoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHsgZXJyIH0pO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLndzLm9uT3BlbigoKSA9PiB7XG4gICAgICB0aGlzLndzLnNlbmQoe1xuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7IHRva2VuOiB0b2tlbiB9KVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgdGhpcy53cy5vbk1lc3NhZ2UocmVzID0+IHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHsgcmVzIH0pO1xuICAgICAgaWYgKC9eey4qfSQvLnRlc3QocmVzLmRhdGEgYXMgc3RyaW5nKSkge1xuICAgICAgICBjb25zdCB7IHR5cGUsIGRhdGEgfTogeyB0eXBlOiBzdHJpbmcsIGRhdGE6IGFueSB9ID0gSlNPTi5wYXJzZShyZXMuZGF0YSBhcyBzdHJpbmcpXG4gICAgICAgIGNvbnN0IGZ1biA9IHRoaXMud3NFdmVudE1hcC5nZXQodHlwZSlcbiAgICAgICAgaWYgKGZ1bikge1xuICAgICAgICAgIGZ1bihkYXRhKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuXG4gICAgdGhpcy5vbk1lc3NhZ2UoJ2luZm8nLCBtc2cgPT4ge1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgY29udGVudDogbXNnLFxuICAgICAgICB0aXRsZTogJ2luZm8nXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICB0aGlzLm9uTWVzc2FnZTxVYXJ0LnVhcnRBbGFybU9iamVjdD4oJ2FsYXJtJywgKGRhdGEpID0+IHtcbiAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgIGNvbnRlbnQ6IChkYXRhIGFzIFVhcnQudWFydEFsYXJtT2JqZWN0KS5tc2csXG4gICAgICAgIHRpdGxlOiAn6K6+5aSH5ZGK6K2m5o+Q6YaSJyxcbiAgICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgICB3eC5zd2l0Y2hUYWIoe1xuICAgICAgICAgICAgdXJsOiAnL3BhZ2VzL2luZGV4L2FsYXJtL2FsYXJtJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIG9uTWVzc2FnZTxUID0gYW55PihldmVudDogc3RyaW5nLCBmdW46IChkYXRhPzogVCkgPT4gdm9pZCkge1xuICAgIGlmICghdGhpcy53c0V2ZW50TWFwLmhhcyhldmVudCkpIHtcbiAgICAgIHRoaXMud3NFdmVudE1hcC5zZXQoZXZlbnQsIGZ1bilcbiAgICB9XG4gIH1cblxuICBvZmZXcyhldmVudDogc3RyaW5nKSB7XG4gICAgdGhpcy53c0V2ZW50TWFwLmRlbGV0ZShldmVudClcbiAgfVxuXG5cblxuICAvKipcbiAgICog55m75b2VLSDln5/lkI1cbiAgICogQHBhcmFtIGRhdGEgXG4gICAqL1xuICBhc3luYyBsb2dpbihkYXRhOiB7IGpzX2NvZGU6IHN0cmluZywgc2NlbmU/OiBzdHJpbmcgfSkge1xuICAgIGNvbnN0IGVsID0gYXdhaXQgdGhpcy5mZXRjaDx7IHRva2VuOiBzdHJpbmcgfT4oXCJhdXRoL2NvZGUyU2Vzc2lvblwiLCBkYXRhLCBcIkdFVFwiKVxuICAgIGlmIChlbC5jb2RlKSB7XG4gICAgICB0aGlzLnNldFRva2VuKGVsLmRhdGEudG9rZW4pXG4gICAgfVxuICAgIHJldHVybiBlbFxuICB9XG5cbiAgLyoqXG4gICAqIOeZu+W9lS3nlKjkuo7lsI/nqIvluo/nmbvlvZXpobXpnaLnmbvlvZVcbiAgICogQHBhcmFtIGRhdGEgXG4gICAqL1xuICBhc3luYyB1c2VybG9naW4oZGF0YTogeyBvcGVuaWQ6IHN0cmluZywgdW5pb25pZDogc3RyaW5nLCBhdmFudGVyOiBzdHJpbmcsIHVzZXI6IHN0cmluZywgcGFzc3dkOiBzdHJpbmcgfSkge1xuICAgIGNvbnN0IGVsID0gYXdhaXQgdGhpcy5mZXRjaDx7IHRva2VuOiBzdHJpbmcgfT4oJ2F1dGgvd3Bsb2dpbicsIGRhdGEpXG4gICAgaWYgKGVsLmNvZGUpIHtcbiAgICAgIHRoaXMuc2V0VG9rZW4oZWwuZGF0YS50b2tlbilcbiAgICB9XG4gICAgcmV0dXJuIGVsXG4gIH1cblxuICAvKipcbiAgICog5pu05paw55So5oi35aS05YOP5ZKM5pi156ewXG4gICAqIEBwYXJhbSBuaWNrTmFtZSDmmLXnp7BcbiAgICogQHBhcmFtIGF2YW50ZXIg5aS05YOP6ZO+5o6lXG4gICAqL1xuICB1cGRhdGVBdmFudGVyKG5pY2tOYW1lOiBzdHJpbmcsIGF2YW50ZXI6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoKCd1cGRhdGVBdmFudGVyJywgeyBuaWNrTmFtZSwgYXZhbnRlciB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOeUqOS6juino+e7keW+ruS/oeWSjOmAj+S8oOi0puWPt+eahOe7keWumuWFs+ezu1xuICAgKi9cbiAgYXN5bmMgdW5iaW5kd3goKSB7XG4gICAgY29uc3QgZWwgPSBhd2FpdCB0aGlzLmZldGNoKCd1bmJpbmR3eCcpXG4gICAgdGhpcy50b2tlbiA9IFwiXCJcbiAgICByZXR1cm4gZWxcbiAgfVxuXG4gIC8qKlxuICAgKiDop6Plr4bnlLXor53lrZfnrKbkuLJcbiAgICogQHBhcmFtIGRhdGEgXG4gICAqL1xuICBnZXRwaG9uZW51bWJlcihkYXRhOiB7IG9wZW5pZDogc3RyaW5nLCBlbmNyeXB0ZWREYXRhOiBzdHJpbmcsIGl2OiBzdHJpbmcgfSkge1xuICAgIHJldHVybiB0aGlzLmZldGNoPHsgcGhvbmVOdW1iZXI6IHN0cmluZyB9PihcImF1dGgvZ2V0cGhvbmVudW1iZXJcIiwgZGF0YSlcbiAgfVxuXG4gIC8qKlxuICAgKiDms6jlhoxcbiAgICogQHBhcmFtIGRhdGEgXG4gICAqL1xuICByZWdpc3RlclVzZXIoZGF0YTogeyB1c2VyOiBzdHJpbmcsIG9wZW5pZDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIHRlbDogc3RyaW5nLCBhdmFudGVyOiBzdHJpbmcgfSkge1xuICAgIHJldHVybiB0aGlzLmZldGNoKFwiYXV0aC93eFJlZ2lzdGVyXCIsIGRhdGEpXG4gIH1cblxuICAvKipcbiAgICog57uR5a6aRFRVXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqL1xuICBiaW5kRGV2KG1hYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8YW55PignYmluZERldicsIHsgbWFjIH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pyq56Gu6K6k5ZGK6K2m5pWw6YePXG4gICAqL1xuICBnZXRBbGFybXVuY29uZmlybWVkKCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoPG51bWJlcj4oJ2dldEFsYXJtdW5jb25maXJtZWQnKVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlmdwc+WumuS9jeeahOivpue7huWcsOWdgFxuICAgKiBAcGFyYW0gbG9jYXRpb24gXG4gICAqL1xuICBnZXRHUFNhZGRyZXNzKGxvY2F0aW9uOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxhbnk+KCdnZXRHUFNhZGRyZXNzJywgeyBsb2NhdGlvbiB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOazqOmUgOW+ruS/oVxuICAgKi9cbiAgYXN5bmMgY2FuY2Vsd3goKSB7XG4gICAgY29uc3QgZWwgPSBhd2FpdCB0aGlzLmZldGNoPHN0cmluZz4oJ2NhbmNlbHd4JylcbiAgICB0aGlzLnRva2VuID0gXCJcIlxuICAgIHJldHVybiBlbFxuICB9XG5cblxuXG4gIC8qKlxuICAgKiDmt7vliqDomZrmi5/orr7lpIdcbiAgICovXG4gIGFkZFZtKCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuVGVybWluYWxbXT4oJ2FkZFZtJylcbiAgfVxuXG4gIC8qKlxuICAgKiDkv67mlLlEVFXlkI3np7BcbiAgICogQHBhcmFtIGR0dSBtYWNcbiAgICogQHBhcmFtIG5hbWUg5paw55qE5ZCN56ewXG4gICAqL1xuICBtb2RpZnlEVFVOYW1lKGR0dTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxzdHJpbmc+KCdtb2RpZnlEVFVOYW1lJywgeyBkdHUsIG5hbWUgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrBkdHXlrprkvY1cbiAgICogQHBhcmFtIGR0dSBkdHVNYWNcbiAgICogQHBhcmFtIGp3IOe7j+e6rOW6plxuICAgKi9cbiAgdXBkYXRlR3BzKG1hYzogc3RyaW5nLCBqdzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8c3RyaW5nPigndXBkYXRlR3BzJywgeyBtYWMsIGp3IH0pXG4gIH1cblxuICAvKipcbiAgICogd2Vi55m75b2VXG4gICAqIEBwYXJhbSBjb2RlIHRva2VuXG4gICAqL1xuICB3ZWJMb2dpbihjb2RlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxzdHJpbmc+KCd3ZWJMb2dpbicsIHsgY29kZSwgdG9rZW46IHRoaXMudG9rZW4gfSlcbiAgfVxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gIC8qKlxuICAgKiDmt7vliqDnlKjmiLdcbiAgICogQHBhcmFtIG5hbWUgXG4gICAqIEBwYXJhbSB1c2VyIFxuICAgKiBAcGFyYW0gcGFzc3dkIFxuICAgKiBAcGFyYW0gdGVsIHhcbiAgICogQHBhcmFtIG1haWwgXG4gICAqIEBwYXJhbSBjb21wYW55IFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIGFkZFVzZXIobmFtZTogc3RyaW5nLCB1c2VyOiBzdHJpbmcsIHBhc3N3ZDogc3RyaW5nLCB0ZWw6IHN0cmluZywgbWFpbDogc3RyaW5nLCBjb21wYW55OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcImd1ZXN0L2FkZFVzZXJcIiwgeyBuYW1lLCB1c2VyLCBwYXNzd2QsIHRlbCwgbWFpbCwgY29tcGFueSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOmHjee9ruWvhueggeWIsOWPkemAgemqjOivgeeggVxuICAgKiBAcGFyYW0gdXNlciBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICByZXNldFBhc3N3ZFZhbGlkYXRpb24odXNlcjogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJndWVzdC9yZXNldFBhc3N3ZFZhbGlkYXRpb25cIiwgeyB1c2VyIH0pXG4gIH1cblxuICAvKipcbiAgICog6YeN572u55So5oi35a+G56CBXG4gICAqIEBwYXJhbSB1c2VyIFxuICAgKiBAcGFyYW0gcGFzc3dkIFxuICAgKiBAcGFyYW0gY29kZSBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICByZXNldFVzZXJQYXNzd2QodXNlcjogc3RyaW5nLCBwYXNzd2Q6IHN0cmluZywgY29kZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJndWVzdC9yZXNldFVzZXJQYXNzd2RcIiwgeyB1c2VyLCBwYXNzd2QsIGNvZGUgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDlvq7kv6HnmbvlvZVcbiAgICogQHBhcmFtIGNvZGUgXG4gICAqIEBwYXJhbSBzdGF0ZSBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICB3eGxvZ2luKGNvZGU6IHN0cmluZywgc3RhdGU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoKFwiYXV0aC93eGxvZ2luXCIsIHsgY29kZSwgc3RhdGUgfSlcbiAgfVxuXG4gIGNyYyhkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxzdHJpbmc+KFwib3Blbi8vY3JjXCIsIHsgZGF0YSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlueUqOaIt+e7keWumuiuvuWkh1xuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIEJpbmREZXYoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC5CaW5kRGV2aWNlPihcIkJpbmREZXZcIilcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfkv6Hmga9cbiAgICogQHJldHVybnMgXG4gICAqL1xuICB1c2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LlVzZXJJbmZvPihcInVzZXJJbmZvXCIpXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi35ZGK6K2mXG4gICAqIEBwYXJhbSBzdGFydCBcbiAgICogQHBhcmFtIGVuZCBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBnZXRBbGFybShzdGFydDogc3RyaW5nID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoKS5yZXBsYWNlKC9cXC8vZywgXCItXCIpICsgXCIgMDowMDowMFwiLCBlbmQ6IHN0cmluZyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkucmVwbGFjZSgvXFwvL2csIFwiLVwiKSArIFwiIDIzOjU5OjU5XCIpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDwoVWFydC51YXJ0QWxhcm1PYmplY3QgJiB7IHRpbWU6IHN0cmluZyB9KVtdPihcImxvZ3VhcnR0ZXJtaW5hbGRhdGF0cmFuc2Zpbml0ZXNcIiwgeyBzdGFydCwgZW5kIH0pXG4gIH1cblxuICAvKipcbiAgICog56Gu6K6k55So5oi35ZGK6K2mXG4gICAqIEBwYXJhbSBpZCBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBjb25mcmltQWxhcm0oaWQ/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcImNvbmZyaW1BbGFybVwiLCB7IGlkIH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5oyH5a6a5LiU5Zyo57q/55qE57uI56uvXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgZ2V0VGVybWluYWxPbmxpbmUobWFjOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LlRlcm1pbmFsIHwgbnVsbD4oXCJnZXRUZXJtaW5hbE9ubGluZVwiLCB7IG1hYyB9KVxuICB9XG5cbiAgLyoqXG4gICog5L+u5pS555So5oi36K6+5aSH5Yir5ZCNXG4gICogQHBhcmFtIG1hYyBcbiAgKiBAcGFyYW0gbmFtZSBcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgbW9kaWZ5VGVybWluYWwobWFjOiBzdHJpbmcsIG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoKCdtb2RpZnlUZXJtaW5hbCcsIHsgbWFjLCBuYW1lIH0pXG4gIH1cblxuICAvKipcbiAgKiDmt7vliqDnu5Hlrprorr7lpIdcbiAgKiBAcGFyYW0gbWFjIFxuICAqL1xuICBhZGRVc2VyVGVybWluYWwobWFjOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcImFkZFVzZXJUZXJtaW5hbFwiLCB7IG1hYyB9KVxuICB9XG5cbiAgLyoqXG4gICog5Yig6Zmk57uR5a6a6K6+5aSHXG4gICogQHBhcmFtIG1hYyBcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgZGVsVXNlclRlcm1pbmFsKG1hYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJkZWxVc2VyVGVybWluYWxcIiwgeyBtYWMgfSlcbiAgfVxuXG4gIC8qKlxuICAqIOiOt+WPluiuvuWkh+exu+Wei1xuICAqIEBwYXJhbSBUeXBlIFxuICAqIEByZXR1cm5zIFxuICAqL1xuICBnZXREZXZUeXBlcyhUeXBlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LkRldnNUeXBlW10+KFwiZ2V0RGV2VHlwZXNcIiwgeyBUeXBlIH0pXG4gIH1cblxuICAvKipcbiAgKiDliKDpmaTnu4jnq6/mjILovb3orr7lpIdcbiAgKiBAcGFyYW0gbWFjIFxuICAqIEBwYXJhbSBwaWQgXG4gICovXG4gIGRlbFRlcm1pbmFsTW91bnREZXYobWFjOiBzdHJpbmcsIHBpZDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJkZWxUZXJtaW5hbE1vdW50RGV2XCIsIHsgbWFjLCBwaWQgfSlcbiAgfVxuXG4gIC8qKlxuICAqIMKgwqDmt7vliqDnlKjmiLfnu4jnq6/mjILovb3orr7lpIdcbiAgKiBAcGFyYW0gbWFjIFxuICAqIEBwYXJhbSBwYXJhbTIgXG4gICogQHJldHVybnMgXG4gICovXG4gIGFkZFRlcm1pbmFsTW91bnREZXYobWFjOiBzdHJpbmcsIG1vdW50RGV2OiBVYXJ0LlRlcm1pbmFsTW91bnREZXZzKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJhZGRUZXJtaW5hbE1vdW50RGV2XCIsIHsgbWFjLCBtb3VudERldiB9KVxuICB9XG5cbiAgLyoqXG4gICog6I635Y+W55So5oi35ZGK6K2m6YWN572uXG4gICogQHBhcmFtIHVzZXIgXG4gICogQHBhcmFtIGZpbHRlciBcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgZ2V0VXNlckFsYXJtU2V0dXAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC51c2VyU2V0dXA+KFwiZ2V0VXNlckFsYXJtU2V0dXBcIilcbiAgfVxuXG4gIC8qKlxuICAqIOS/ruaUueeUqOaIt+WRiuitpumFjee9ruiBlOezu+aWueW8j1xuICAqIEBwYXJhbSB0ZWxzIOiBlOezu+eUteivnVxuICAqIEBwYXJhbSBtYWlscyDogZTns7vpgq7nrrFcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgbW9kaWZ5VXNlckFsYXJtU2V0dXBUZWwodGVsczogc3RyaW5nW10sIG1haWxzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmZldGNoKFwibW9kaWZ5VXNlckFsYXJtU2V0dXBUZWxcIiwgeyB0ZWxzLCBtYWlscyB9KVxuICB9XG5cbiAgLyoqXG4gICog5L+u5pS555So5oi35L+h5oGvXG4gICogQHBhcmFtIHVzZXIgXG4gICogQHBhcmFtIGRhdGEgXG4gICogQHJldHVybnMgXG4gICovXG4gIG1vZGlmeVVzZXJJbmZvKGRhdGE6IFBhcnRpYWw8VWFydC5Vc2VySW5mbz4pIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcIm1vZGlmeVVzZXJJbmZvXCIsIHsgZGF0YSB9KVxuICB9XG5cbiAgLyoqXG4gICog6I635Y+W5YWs5LyX5Y+35LqM57u056CBXG4gICogQHBhcmFtIHVzZXIgXG4gICogQHJldHVybnMgXG4gICovXG4gIG1wVGlja2V0KCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoKFwibXBUaWNrZXRcIilcbiAgfVxuXG4gIC8qKlxuICAqIOiOt+WPluWwj+eoi+W6j+S6jOe7tOeggVxuICAqIEBwYXJhbSB1c2VyIFxuICAqIEByZXR1cm5zIFxuICAqL1xuICB3cFRpY2tldCgpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcIndwVGlja2V0XCIpXG4gIH1cblxuXG4gIC8qKlxuICAqIOiOt+WPlueUqOaIt+WNleS4quWNj+iuruWRiuitpumFjee9rlxuICAqIEBwYXJhbSBwcm90b2NvbCBcbiAgKi9cbiAgZ2V0VXNlckFsYXJtUHJvdG9jb2wocHJvdG9jb2w6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuUHJvdG9jb2xDb25zdGFudFRocmVzaG9sZD4oXCJnZXRVc2VyQWxhcm1Qcm90b2NvbFwiLCB7IHByb3RvY29sIH0pXG4gIH1cblxuICAvKipcbiAgKiDojrflj5bljZXkuKrljY/orq7lkYrorabphY3nva5cbiAgKiBAcGFyYW0gcHJvdG9jb2wgXG4gICovXG4gIGdldEFsYXJtUHJvdG9jb2wocHJvdG9jb2w6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuUHJvdG9jb2xDb25zdGFudFRocmVzaG9sZD4oXCJnZXRBbGFybVByb3RvY29sXCIsIHsgcHJvdG9jb2wgfSlcbiAgfVxuXG4gIC8qKlxuICAqIOiOt+WPlueUqOaIt+iuvuWkh+i/kOihjOaVsOaNrlxuICAqIEBwYXJhbSBtYWMgXG4gICogQHBhcmFtIHBpZCBcbiAgKi9cbiAgZ2V0VGVybWluYWxEYXRhKG1hYzogc3RyaW5nLCBwaWQ6IG51bWJlciB8IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQucXVlcnlSZXN1bHRTYXZlPihcImdldFRlcm1pbmFsRGF0YVwiLCB7IG1hYywgcGlkIH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi36K6+5aSH5Y6G5Y+y6L+Q6KGM5pWw5o2uXG4gICAqIEBwYXJhbSBtYWMgXG4gICAqIEBwYXJhbSBwaWQgXG4gICAqIEBwYXJhbSBuYW1lIFxuICAgKiBAcGFyYW0gZGF0ZXRpbWUgXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgZ2V0VGVybWluYWxEYXRhcyhtYWM6IHN0cmluZywgcGlkOiBudW1iZXIgfCBzdHJpbmcsIG5hbWU6IHN0cmluZywgZGF0ZXRpbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQucXVlcnlSZXN1bHRTYXZlW10+KFwiZ2V0VGVybWluYWxEYXRhc1wiLCB7IG1hYywgcGlkLCBuYW1lLCBkYXRldGltZSB9KVxuICB9XG5cbiAgLyoqXG4gICog6YeN572u6K6+5aSH6LaF5pe254q25oCBXG4gICogQHBhcmFtIG1hYyBcbiAgKiBAcGFyYW0gcGlkIFxuICAqL1xuICByZWZyZXNoRGV2VGltZU91dChtYWM6IHN0cmluZywgcGlkOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcInJlZnJlc2hEZXZUaW1lT3V0XCIsIHsgbWFjLCBwaWQgfSlcbiAgfVxuXG4gIC8qKlxuICAqIOWbuuWumuWPkemAgeiuvuWkh+aTjeS9nOaMh+S7pFxuICAqIEBwYXJhbSBxdWVyeSBcbiAgKiBAcGFyYW0gaXRlbSBcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgU2VuZFByb2NvdG9sSW5zdHJ1Y3RTZXQocXVlcnk6IFVhcnQuaW5zdHJ1Y3RRdWVyeUFyZywgaXRlbTogVWFydC5PcHJhdGVJbnN0cnVjdCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuQXBvbGxvTW9uZ29SZXN1bHQ+KFwiU2VuZFByb2NvdG9sSW5zdHJ1Y3RTZXRcIiwgeyBxdWVyeSwgaXRlbSB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaMh+WumuWNj+iurlxuICAgKiBAcGFyYW0gcHJvdG9jb2wgXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgZ2V0UHJvdG9jb2wocHJvdG9jb2w6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQucHJvdG9jb2w+KFwiZ2V0UHJvdG9jb2xcIiwgeyBwcm90b2NvbCB9KVxuICB9XG5cbiAgLyoqXG4gICog6K6+572u55So5oi36Ieq5a6a5LmJ6K6+572uKOWNj+iurumFjee9rilcbiAgKiBAcGFyYW0gUHJvdG9jb2wg5Y2P6K6uXG4gICogQHBhcmFtIHR5cGUg5pON5L2c57G75Z6LXG4gICogQHBhcmFtIGFyZyDlj4LmlbBcbiAgKiBAcmV0dXJucyBcbiAgKi9cbiAgc2V0VXNlclNldHVwUHJvdG9jb2wocHJvdG9jb2w6IHN0cmluZywgdHlwZTogVWFydC5Db25zdGFudFRocmVzaG9sZFR5cGUsIGFyZzogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJzZXRVc2VyU2V0dXBQcm90b2NvbFwiLCB7IHByb3RvY29sLCB0eXBlLCBhcmcgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7lpIforr7lpIfliKvlkI1cbiAgICogQHBhcmFtIG1hYyBcbiAgICogQHBhcmFtIHBpZCBcbiAgICogQHBhcmFtIHByb3RvY29sIFxuICAgKiBAcGFyYW0gbmFtZSBcbiAgICogQHBhcmFtIGFsaWFzIFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHNldEFsaWFzKG1hYzogc3RyaW5nLCBwaWQ6IG51bWJlciwgcHJvdG9jb2w6IHN0cmluZywgbmFtZTogc3RyaW5nLCBhbGlhczogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJzZXRBbGlhc1wiLCB7IG1hYywgcGlkLCBwcm90b2NvbCwgbmFtZSwgYWxpYXMgfSlcbiAgfVxuXG4gIC8qKlxuICAqIOiOt+WPlue7iOerr+S/oeaBr1xuICAqIEBwYXJhbSBtYWMgXG4gICogQHJldHVybnMgXG4gICovXG4gIGdldFRlcm1pbmFsKG1hYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC5UZXJtaW5hbD4oXCJnZXRUZXJtaW5hbFwiLCB7IG1hYyB9KVxuICB9XG5cbiAgLyoqXG4gICogIOiOt+WPlueUqOaIt+W4g+WxgOmFjee9rlxuICAqIEBwYXJhbSBpZCBcbiAgKi9cbiAgZ2V0VXNlckxheW91dChpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC51c2VyTGF5b3V0PihcImdldFVzZXJMYXlvdXRcIiwgeyBpZCB9KVxuICB9XG5cbiAgLyoqXG4gICogIOiOt+WPlueUqOaIt+W4g+WxgOmFjee9rlxuICAqIEBwYXJhbSBpZCBcbiAgKi9cbiAgZ2V0QWdncmVnYXRpb24oaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuQWdncmVnYXRpb24+KFwiZ2V0QWdncmVnYXRpb25cIiwgeyBpZCB9KVxuICB9XG5cbiAgLyoqXG4gICog5re75Yqg6IGa5ZCI6K6+5aSHXG4gICogQHBhcmFtIG5hbWUgXG4gICogQHBhcmFtIGFnZ3MgXG4gICogQHJldHVybnMgXG4gICovXG4gIGFkZEFnZ3JlZ2F0aW9uKG5hbWU6IHN0cmluZywgYWdnczogVWFydC5BZ2dyZWdhdGlvbkRldltdKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJhZGRBZ2dyZWdhdGlvblwiLCB7IG5hbWUsIGFnZ3MgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTogZrlkIjorr7lpIdcbiAgICogQHBhcmFtIHVzZXIgXG4gICAqIEBwYXJhbSBpZCBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBkZWxldGVBZ2dyZWdhdGlvbihpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJkZWxldGVBZ2dyZWdhdGlvblwiLCB7IGlkIH0pXG4gIH1cblxuICAvKipcbiAgKiDorr7nva7nlKjmiLfluIPlsYDphY3nva5cbiAgKiBAcGFyYW0gaWQgXG4gICogQHBhcmFtIHR5cGUgXG4gICogQHBhcmFtIGJnIFxuICAqIEBwYXJhbSBMYXlvdXQgXG4gICovXG4gIHNldFVzZXJMYXlvdXQoaWQ6IHN0cmluZywgdHlwZTogc3RyaW5nLCBiZzogc3RyaW5nLCBMYXlvdXQ6IFVhcnQuQWdncmVnYXRpb25MYXlvdXROb2RlW10pIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LkFwb2xsb01vbmdvUmVzdWx0PihcInNldFVzZXJMYXlvdXRcIiwgeyBpZCwgdHlwZSwgYmcsIExheW91dCB9KVxuICB9XG5cblxuICAvLyBWMiBncHPovazpq5jlvrdncHNcbiAgVjJfQVBJX0FhbXBfZ3BzMmF1dG9hbnZpKGxvY2F0aW9uczogc3RyaW5nIHwgc3RyaW5nW10sIGNvb3Jkc3lzOiAnZ3BzJyB8ICdtYXBiYXInIHwgJ2JhaWR1JyA9IFwiZ3BzXCIpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxzdHJpbmcgfCBzdHJpbmdbXT4oJ3V0aWwvQU1hcC9HUFMyYXV0b25hdmknLCB7IGNvb3Jkc3lzLCBsb2NhdGlvbnM6IEFycmF5LmlzQXJyYXkobG9jYXRpb25zKSA/IGxvY2F0aW9ucy5qb2luKFwifFwiKSA6IGxvY2F0aW9ucyB9KVxuICB9XG5cbiAgLy8gVjIgaXDovaxncHNcbiAgVjJfQVBJX0FhbXBfaXAybG9jYWwoaXA6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPHN0cmluZz4oXCJ1dGlsL0FNYXAvSVAybG9jdGlvblwiLCB7IGlwIH0pXG4gIH1cblxuXG5cblxuXG5cblxuXG5cblxuXG4gIC8qKlxuICAqIOiOt+WPlmR0dei/nOeoi+iwg+ivlee9keWdgFxuICAqIEBwYXJhbSBtYWMgXG4gICovXG4gIGlvdFJlbW90ZVVybChtYWM6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPHN0cmluZz4oJ3Jvb3QvaW90UmVtb3RlVXJsJywgeyBtYWMgfSlcbiAgfVxuXG4gIC8qKlxuICAgICAqIOiOt+WPluaJgOacieiKgueCuVxuICAgICAqIEBwYXJhbSBuYW1lIFxuICAgICAqL1xuICBOb2RlcygpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0Lk5vZGVDbGllbnRbXT4oXCJyb290L05vZGVzXCIsKVxuICB9XG5cbiAgLyoqXG4gICAgICog5re75Yqg55m76K6w6K6+5aSHXG4gICAgICogQHBhcmFtIERldk1hYyBcbiAgICAgKiBAcGFyYW0gbW91bnROb2RlIFxuICAgICAqIEByZXR1cm5zIFxuICAgICAqL1xuICBhZGRSZWdpc3RlclRlcm1pbmFsKERldk1hYzogc3RyaW5nLCBtb3VudE5vZGU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoKFwicm9vdC9hZGRSZWdpc3RlclRlcm1pbmFsXCIsIHsgRGV2TWFjLCBtb3VudE5vZGUgfSlcbiAgfVxuXG4gIC8qKlxuICAqIOiOt+WPlue7iOerr+S/oeaBr1xuICAqIEBwYXJhbSBtYWMgXG4gICogQHJldHVybnMgXG4gICovXG4gIGdldFJvb3RUZXJtaW5hbChtYWM6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZldGNoPFVhcnQuVGVybWluYWw+KFwiZ2V0VGVybWluYWxcIiwgeyBtYWMgfSlcbiAgfVxuXG5cbiAgLyoqXG4gICAgICog5rOo5YaM6K6+5aSHXG4gICAgICogQHBhcmFtIGRhdGEgXG4gICAgICovXG4gIGFkZFJlZ2lzdGVyRGV2KGlkczogc3RyaW5nW10sIG1vdW50RGV2OiBVYXJ0LlRlcm1pbmFsTW91bnREZXZzKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC5yZWdpc3RlckRldltdPihcInJvb3QvYWRkUmVnaXN0ZXJEZXZcIiwgeyBpZHMsIG1vdW50RGV2IH0pXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5oyH5a6a5rOo5YaM6K6+5aSHXG4gICAqIEBwYXJhbSBpZCBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBnZXRSZWdpc3RlckRldihpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2g8VWFydC5yZWdpc3RlckRldj4oXCJnZXRSZWdpc3RlckRldlwiLCB7IGlkIH0pXG4gIH1cblxuICAvKipcbiAgICAgKiDliKDpmaTmjIflrprms6jlhozorr7lpIdcbiAgICAgKiBAcGFyYW0gaWQgXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gIGRlbFJlZ2lzdGVyRGV2KGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaChcInJvb3QvZGVsUmVnaXN0ZXJEZXZcIiwgeyBpZCB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaMh+WumuaJgOacieiuvuWkh1xuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIGdldFJlZ2lzdGVyRGV2cygpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LnJlZ2lzdGVyRGV2W10+KFwicm9vdC9nZXRSZWdpc3RlckRldnNcIilcbiAgfVxuXG5cbiAgLyoqXG4gICAgICAgICAqIOWbuuWumuWPkemAgURUVSBBVOaMh+S7pFxuICAgICAgICAgKiBAcmV0dXJucyBcbiAgICAgICAgICovXG4gIHNlbmRBVEluc3RydWN0KG1hYzogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxVYXJ0LkFwb2xsb01vbmdvUmVzdWx0PihcInJvb3Qvc2VuZEFUSW5zdHJ1Y3RcIiwgeyBtYWMsIGNvbnRlbnQgfSlcbiAgfVxuXG5cbiAgLyoqXG4gICAqIOWIneWni+WMlmR0dVxuICAgKiBAcGFyYW0gbWFjIFxuICAgKi9cbiAgaW5pdFRlcm1pbmFsKG1hYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goXCJyb290L2luaXRUZXJtaW5hbFwiLCB7IG1hYyB9LCBcIlBPU1RcIiwgMTAwMCAqIDYwICogNSlcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5Zjb2Rl5a+55bqU55qEYmFzZTY0UVLlm77niYfmlbDmja5cbiAgICogQHBhcmFtIGNvZGUgXG4gICAqL1xuICBxcihjb2RlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaDxzdHJpbmc+KFwicXJcIiwgeyBjb2RlIH0pXG4gIH1cblxuXG4gIC8qKlxuICAgKiDliIfmjaLmtYvor5XotKblj7for5XnlKhcbiAgICovXG4gIGFzeW5jIHRyaWFsKGRhdGE6IHsganNfY29kZTogc3RyaW5nIH0pIHtcbiAgICBjb25zdCBlbCA9IGF3YWl0IHRoaXMuZmV0Y2g8eyB0b2tlbjogc3RyaW5nIH0+KFwiYXV0aC90cmlhbFwiLCBkYXRhLCBcIkdFVFwiKVxuICAgIGlmIChlbC5jb2RlKSB7XG4gICAgICB0aGlzLnNldFRva2VuKGVsLmRhdGEudG9rZW4pXG4gICAgfVxuICAgIHJldHVybiBlbFxuICB9XG5cblxuICAvKipcbiAgICogQG1ldGhvZCBhcGnpgJrnlKhyZXF1c3Tmlrnms5VcbiAgICogQHBhcmFtIG9iamVjdCBcbiAgICovXG4gIGFzeW5jIGZldGNoPFQ+KHVybDogc3RyaW5nLCBkYXRhOiBPYmplY3QgPSB7fSwgbWV0aG9kOiBcIkdFVFwiIHwgXCJQT1NUXCIgPSBcIlBPU1RcIiwgdGltZW91dDogbnVtYmVyID0gMTAwMCAqIDYwKSB7XG4gICAgY29uc3QgdG9rZW46IHN0cmluZyA9IHRoaXMudG9rZW4gfHwgYXdhaXQgd3guZ2V0U3RvcmFnZSh7IGtleTogJ3Rva2VuJyB9KS50aGVuKGVsID0+IGVsLmRhdGEpLmNhdGNoKCgpID0+IFwiXCIpXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHJlc3VsdDxUPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgd3gucmVxdWVzdDxyZXN1bHQ8VD4+KHtcbiAgICAgICAgdGltZW91dCxcbiAgICAgICAgdXJsOiB1cmxSZXF1ZXN0ICsgXCIvYXBpL1wiICsgdXJsLFxuICAgICAgICBkYXRhLFxuICAgICAgICBtZXRob2QsXG4gICAgICAgIGVuYWJsZUh0dHAyOiB0cnVlLFxuICAgICAgICBoZWFkZXI6IHsgdG9rZW4sIHR5cGU6ICd3cCcgfSxcbiAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMjAxKSB7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgICAgdXJsOiAnL3BhZ2VzL3V0aWwvc21zVmFsaWRhdGlvbi9zbXNWYWxpZGF0aW9uJyxcbiAgICAgICAgICAgICAgZXZlbnRzOiB7XG4gICAgICAgICAgICAgICAgY29kZTogKGNvZGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5mZXRjaCgnc21zQ29kZVZhbGlkYXRpb24nLCB7IGNvZGUgfSkudGhlbihjb2RlVmFsaWRhdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlVmFsaWRhdGlvbi5jb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZXRjaCh1cmwsIGRhdGEsIG1ldGhvZCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXMuZGF0YSBhcyBhbnkpXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAn55+t5L+h5qCh6aqM6ZSZ6K+vJ1xuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSBlbHNlIGlmIChyZXMuZGF0YS5jb2RlID09PSAwICYmIHJlcy5kYXRhLmRhdGEgYXMgYW55ID09PSAndG9rZW4gbnVsbCcpIHtcbiAgICAgICAgICAgIHd4LnN3aXRjaFRhYih7XG4gICAgICAgICAgICAgIHVybDogJy9wYWdlcy9pbmRleC9pbmRleCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICByZXNvbHZlKHJlcy5kYXRhIGFzIGFueSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coeyBlIH0pO1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7IHRpdGxlOiAn5pyN5Yqh5Zmo6ZSZ6K+vJywgY29udGVudDogZS5lcnJNc2cgfSlcbiAgICAgICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICAgICAgcmVqZWN0KGUpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBuZXcgYXBpKClcbiJdfQ==